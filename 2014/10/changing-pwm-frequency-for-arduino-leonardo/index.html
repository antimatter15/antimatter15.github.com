<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" href="http://localhost:8080/feed.xml" type="application/rss+xml" title="somewhere to talk about ideas and projects and stuff like everyone else">
    <link rel="stylesheet" href="/style/main.css">
    <title>Changing PWM Frequency for Arduino Leonardo</title>
  </head>
  <body>
    <div class="whitebox">
      <div class="graybar top">
        <header class="top">
          <div class="slogan">somewhere to talk about random ideas and projects like everyone else</div><a href="/">
            <h1 class="logo">
              stuff
               <span class="byline">by antimatter15</span>
            </h1></a>
        </header>
      </div>
      <div id="main">
        <div class="sidebar">
          <div class="about">
            <p class="emph">
              Hi. I’m <b>Kevin Kwok</b>, and I’m currently a sophomore at <b>MIT</b>, 
              and this is my obligatory online presence or whatever.  
            </p>
            <p>
              I regularly updated this site from 2007, when I started it in elementary school, 
              to summer 2014, when it was unwittingly absorbed into an international phishing ring.
            </p>
            <p>
              But like a phoenix, hydra or the national deficit, the site is back 
              again bigger than ever (after a rather long gestation period).
            </p>
            <p>
              For more obnoxious autobiographical content 
              blended with bits of nostalgia for the old PHP-on-sketchy-free-webhosting days, click here.
            </p>
          </div><br>
          <section class="archive"><a href="/archive">
              <h2>Archive</h2></a>
            <ul>
              <li>
                <ul>
                  <li><a href="/2015/04"><span class="month">April</span> <span class="year">2015</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2014/12"><span class="month">December</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/06"><span class="month">June</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/05"><span class="month">May</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/04"><span class="month">April</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/03"><span class="month">March</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/02"><span class="month">February</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/01"><span class="month">January</span> <span class="year">2014</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2013/12"><span class="month">December</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/11"><span class="month">November</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/10"><span class="month">October</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/09"><span class="month">September</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/08"><span class="month">August</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/07"><span class="month">July</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/06"><span class="month">June</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/05"><span class="month">May</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/04"><span class="month">April</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/03"><span class="month">March</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/02"><span class="month">February</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/01"><span class="month">January</span> <span class="year">2013</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2012/12"><span class="month">December</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/11"><span class="month">November</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/10"><span class="month">October</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/09"><span class="month">September</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/08"><span class="month">August</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/07"><span class="month">July</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/06"><span class="month">June</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/05"><span class="month">May</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/04"><span class="month">April</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/03"><span class="month">March</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/02"><span class="month">February</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/01"><span class="month">January</span> <span class="year">2012</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2011/12"><span class="month">December</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/11"><span class="month">November</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/10"><span class="month">October</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/09"><span class="month">September</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/08"><span class="month">August</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/07"><span class="month">July</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/06"><span class="month">June</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/05"><span class="month">May</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/04"><span class="month">April</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/03"><span class="month">March</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/02"><span class="month">February</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/01"><span class="month">January</span> <span class="year">2011</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2010/12"><span class="month">December</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/11"><span class="month">November</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/10"><span class="month">October</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/09"><span class="month">September</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/08"><span class="month">August</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/07"><span class="month">July</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/06"><span class="month">June</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/05"><span class="month">May</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/04"><span class="month">April</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/03"><span class="month">March</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/02"><span class="month">February</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/01"><span class="month">January</span> <span class="year">2010</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2009/12"><span class="month">December</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/11"><span class="month">November</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/10"><span class="month">October</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/09"><span class="month">September</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/08"><span class="month">August</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/07"><span class="month">July</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/06"><span class="month">June</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/05"><span class="month">May</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/04"><span class="month">April</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/03"><span class="month">March</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/01"><span class="month">January</span> <span class="year">2009</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2008/12"><span class="month">December</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/11"><span class="month">November</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/10"><span class="month">October</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/09"><span class="month">September</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/08"><span class="month">August</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/07"><span class="month">July</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/06"><span class="month">June</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/05"><span class="month">May</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/04"><span class="month">April</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/01"><span class="month">January</span> <span class="year">2008</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2007/12"><span class="month">December</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/11"><span class="month">November</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/10"><span class="month">October</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/09"><span class="month">September</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/08"><span class="month">August</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/05"><span class="month">May</span> <span class="year">2007</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2006/09"><span class="month">September</span> <span class="year">2006</span></a></li>
                  <li><a href="/2006/08"><span class="month">August</span> <span class="year">2006</span></a></li>
                </ul><br>
              </li>
            </ul>
          </section>
          <div class="tags">
            <h2>Tags</h2><a href="/tag/3D" style="font-size: 13px">3D </a><a href="/tag/actionscript" style="font-size: 11px">actionscript </a><a href="/tag/ajax" style="font-size: 20px">ajax </a><a href="/tag/ajax animator" style="font-size: 20px">ajax animator </a><a href="/tag/animation" style="font-size: 11px">animation </a><a href="/tag/api" style="font-size: 13px">api </a><a href="/tag/apple" style="font-size: 20px">apple </a><a href="/tag/art" style="font-size: 11px">art </a><a href="/tag/awesome" style="font-size: 13px">awesome </a><a href="/tag/blog" style="font-size: 19px">blog </a><a href="/tag/browser" style="font-size: 20px">browser </a><a href="/tag/bugfix" style="font-size: 15px">bugfix </a><a href="/tag/canvas" style="font-size: 15px">canvas </a><a href="/tag/change" style="font-size: 15px">change </a><a href="/tag/chrome" style="font-size: 20px">chrome </a><a href="/tag/chrome extension" style="font-size: 11px">chrome extension </a><a href="/tag/chrome os" style="font-size: 11px">chrome os </a><a href="/tag/chromebook" style="font-size: 11px">chromebook </a><a href="/tag/code" style="font-size: 13px">code </a><a href="/tag/color" style="font-size: 11px">color </a><a href="/tag/colors" style="font-size: 11px">colors </a><a href="/tag/css" style="font-size: 11px">css </a><a href="/tag/design" style="font-size: 19px">design </a><a href="/tag/elitist" style="font-size: 20px">elitist </a><a href="/tag/evil" style="font-size: 19px">evil </a><a href="/tag/experiment" style="font-size: 15px">experiment </a><a href="/tag/export" style="font-size: 11px">export </a><a href="/tag/extension" style="font-size: 20px">extension </a><a href="/tag/ExtJS" style="font-size: 20px">ExtJS </a><a href="/tag/facebook" style="font-size: 11px">facebook </a><a href="/tag/fast" style="font-size: 20px">fast </a><a href="/tag/features" style="font-size: 15px">features </a><a href="/tag/firefox" style="font-size: 20px">firefox </a><a href="/tag/flash" style="font-size: 17px">flash </a><a href="/tag/function" style="font-size: 13px">function </a><a href="/tag/future" style="font-size: 15px">future </a><a href="/tag/GAE" style="font-size: 13px">GAE </a><a href="/tag/github" style="font-size: 15px">github </a><a href="/tag/google" style="font-size: 20px">google </a><a href="/tag/google code" style="font-size: 11px">google code </a><a href="/tag/google wave" style="font-size: 20px">google wave </a><a href="/tag/graphics" style="font-size: 15px">graphics </a><a href="/tag/history" style="font-size: 11px">history </a><a href="/tag/hosting" style="font-size: 19px">hosting </a><a href="/tag/html5" style="font-size: 19px">html5 </a><a href="/tag/idea" style="font-size: 13px">idea </a><a href="/tag/images" style="font-size: 11px">images </a><a href="/tag/interface" style="font-size: 11px">interface </a><a href="/tag/internet exploder" style="font-size: 20px">internet exploder </a><a href="/tag/ipad" style="font-size: 17px">ipad </a><a href="/tag/javascript" style="font-size: 20px">javascript </a><a href="/tag/json" style="font-size: 15px">json </a><a href="/tag/library" style="font-size: 11px">library </a><a href="/tag/lines" style="font-size: 13px">lines </a><a href="/tag/linux" style="font-size: 17px">linux </a><a href="/tag/login" style="font-size: 15px">login </a><a href="/tag/mac" style="font-size: 11px">mac </a><a href="/tag/magical" style="font-size: 15px">magical </a><a href="/tag/math" style="font-size: 11px">math </a><a href="/tag/meta" style="font-size: 13px">meta </a><a href="/tag/microsoft" style="font-size: 13px">microsoft </a><a href="/tag/microwave" style="font-size: 15px">microwave </a><a href="/tag/mirror" style="font-size: 11px">mirror </a><a href="/tag/multitouch" style="font-size: 13px">multitouch </a><a href="/tag/new" style="font-size: 19px">new </a><a href="/tag/nostalgia" style="font-size: 11px">nostalgia </a><a href="/tag/ocr" style="font-size: 11px">ocr </a><a href="/tag/offline" style="font-size: 17px">offline </a><a href="/tag/old" style="font-size: 17px">old </a><a href="/tag/onlypaths" style="font-size: 17px">onlypaths </a><a href="/tag/pi" style="font-size: 19px">pi </a><a href="/tag/processing" style="font-size: 11px">processing </a><a href="/tag/prototype" style="font-size: 13px">prototype </a><a href="/tag/python" style="font-size: 20px">python </a><a href="/tag/raphael" style="font-size: 19px">raphael </a><a href="/tag/release" style="font-size: 13px">release </a><a href="/tag/retrospective" style="font-size: 11px">retrospective </a><a href="/tag/rewrite" style="font-size: 13px">rewrite </a><a href="/tag/security" style="font-size: 15px">security </a><a href="/tag/shiny" style="font-size: 20px">shiny </a><a href="/tag/ShinyTouch" style="font-size: 13px">ShinyTouch </a><a href="/tag/simple" style="font-size: 11px">simple </a><a href="/tag/site" style="font-size: 13px">site </a><a href="/tag/small" style="font-size: 19px">small </a><a href="/tag/speed" style="font-size: 11px">speed </a><a href="/tag/SVG" style="font-size: 15px">SVG </a><a href="/tag/text" style="font-size: 11px">text </a><a href="/tag/touch" style="font-size: 13px">touch </a><a href="/tag/update" style="font-size: 20px">update </a><a href="/tag/upload" style="font-size: 17px">upload </a><a href="/tag/user interface" style="font-size: 11px">user interface </a><a href="/tag/vector" style="font-size: 13px">vector </a><a href="/tag/vectoreditor" style="font-size: 19px">vectoreditor </a><a href="/tag/version" style="font-size: 13px">version </a><a href="/tag/video" style="font-size: 15px">video </a><a href="/tag/vX JS" style="font-size: 19px">vX JS </a><a href="/tag/wave" style="font-size: 20px">wave </a><a href="/tag/wikify" style="font-size: 20px">wikify </a><a href="/tag/wikipedia" style="font-size: 17px">wikipedia </a><a href="/tag/wordpress" style="font-size: 20px">wordpress </a>
          </div>
        </div>
        <div id="content"><a href="/2014/10/changing-pwm-frequency-for-arduino-leonardo/">
            <h2>Changing PWM Frequency for Arduino Leonardo <span title="Sat Oct 25 2014 14:14:37 GMT-0400 (EDT)" class="subtitle">25 October 2014</span>
            </h2></a>
          <article class="article">
            <section class="content"><h1 id="notes-">Notes:</h1>
<p>What does it prevent? loud annoying motor&nbsp;noise</p>
<p>What&nbsp;else?</p>
<h1 id="ardumoto">Ardumoto</h1>
<blockquote>
<p> This is a motor shield for Arduino that will control two <span class="caps">DC</span> motors. Based on the L298 H-bridge, the Ardumoto can drive up to 2 amps per&nbsp;channel.</p>
<p> Control for motor attached to <span class="caps">OUT1</span>/2 is connected to digital line 12 (direction A) and digital line 3 (PWM A). Control for motor attached to OUT3/4 is connected to digital line 13 (direction B) and digital line 11 (PWM&nbsp;B).</p>
</blockquote>
<p>For Ardumoto, digital lines 3 and 11 used for <span class="caps">PWM</span> for motors A, B&nbsp;respectively. </p>
<p>On Arduino Uno, digital lines 3 and 11 are connected to Timer 2 (cycle length 510, so 15Mhz / 510 = 31.37kHz is the maximum possible frequency — also of 8 bit resolution, so up to 256 different possible duty&nbsp;cycles). </p>
<blockquote>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Divisor</th>
<th>Frequency</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0x01</code></td>
<td>1</td>
<td>31372.55</td>
</tr>
<tr>
<td><code>0x02</code></td>
<td>8</td>
<td>3921.16</td>
</tr>
<tr>
<td><code>0x03</code></td>
<td>32</td>
<td>980.39</td>
</tr>
<tr>
<td><code>0x04</code></td>
<td>64</td>
<td>490.20</td>
<td>(<span class="caps">DEFAULT</span>)</td>
</tr>
<tr>
<td><code>0x05</code></td>
<td>128</td>
<td>245.10</td>
</tr>
<tr>
<td><code>0x06</code></td>
<td>256</td>
<td>122.55</td>
</tr>
<tr>
<td><code>0x07</code></td>
<td>1024</td>
<td>30.64</td>
</tr>
</tbody>
</table>
</blockquote>
<pre><code><span style='display:none' detected-language='x86asm'></span><span class="caps">TCCR2B</span> = TCCR2B <span class="amp">&amp;</span> <span class="hljs-number">0b11111000</span> | &lt;setting&gt;<span class="hljs-comment">;</span>

All frequencies are <span class="hljs-keyword">in</span> Hz <span class="hljs-keyword">and</span> <span class="hljs-preprocessor">assume</span> a <span class="hljs-number">16000000</span> Hz system clock.
</code></pre><p>On Arduino Leonardo, digital lines 3 and 11 are connected to Timer 0, but the Arduino Library uses Timer 0 for the operation of <code>millis()</code> and <code>delay()</code>, so changing Timer 0 isn’t really a valid&nbsp;option. </p>
<p>Arduino Leonardo’s ATmega32u4 microcontroller includes a new timer, Timer 4, which is connected to pins 6 and 13, and operates at a whopping&nbsp;64MHz. </p>
<blockquote>
<p>If you change <span class="caps">TCCR0B</span>, it affects millis() and delay(). They will count time faster or slower than normal if you change the TCCR0B settings. Below is the adjustment factor to maintain consistent behavior of these&nbsp;functions:</p>
</blockquote>
<p>My&nbsp;Code:</p>
<pre><code><span style='display:none' detected-language='cs'></span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
  pinMode(pwm_b, <span class="caps">OUTPUT</span>);
  pinMode(dir_b, OUTPUT);
  TCCR4B = TCCR4B <span class="amp">&amp;</span> <span class="hljs-number">0</span>b11111000 | <span class="hljs-number">0x01</span>;      
}
</code></pre><p><a href="http://provideyourown.com/2012/arduino-leonardo-versus-uno-whats-new/">http://provideyourown.com/2012/arduino-leonardo-versus-uno-whats-new/</a></p>
<blockquote>
<p>Timer 0
  bits = 8
  Clock speed = 16 MHz (system clock speed)
  Default prescale = 64
  Pins D3 <span class="amp">&amp;</span>&nbsp;D11</p>
<p>Timers 1 and 3
  bits = 16
  Clock speed = 16 MHz (system clock speed)
  Default prescale = 64
  Pins D5, D9 <span class="amp">&amp;</span> D10
  Pin D11 can also be set to use timer 1 output (<span class="caps">OC1C</span>), but the Arduino library uses it for timer 0 (8-bit). To use it on timer 1, it must be done by setting the appropriate&nbsp;registers.</p>
<p>Timer 4
  bits = 10
  Clock speed = 64 MHz
  Default prescale = 64
  Pins D6, D13
  Pin D10 (<span class="caps">PB6</span>) also has a timer 4 output (OC4B), but the Arduino library uses it for timer 1 (16-bit). To use it on timer 4, it must with the&nbsp;registers.</p>
</blockquote>
<p><a href="http://arduino-info.wikispaces.com/Arduino-PWM-Frequency">http://arduino-info.wikispaces.com/Arduino-<span class="caps">PWM</span>-Frequency</a></p>
<p><a href="http://www.instructables.com/id/Step-by-Step-Guide-to-the-Arduino-Leonardo/step2/Extra-PWM-pin/">http://www.instructables.com/id/Step-by-Step-Guide-to-the-Arduino-Leonardo/step2/Extra-<span class="caps">PWM</span>-pin/</a></p>
<p><a href="http://harizanov.com/2013/04/crazy-high-frequency-pwm-with-atmega32u4/">http://harizanov.com/2013/04/crazy-high-frequency-pwm-with-atmega32u4/</a></p>
<p><a href="http://academy.cba.mit.edu/classes/embedded_programming/doc7766.pdf">http://academy.cba.mit.edu/classes/embedded_programming/doc7766.pdf</a></p>
<h2 id="for-uno-">For&nbsp;Uno:</h2>
<pre><code><span style='display:none' detected-language='cs'></span><span class="hljs-comment">/**
 * Divides a given <span class="caps">PWM</span> pin frequency by a divisor.
 * 
 * The resulting frequency is equal to the base frequency divided by
 * the given divisor:
 *   - Base frequencies:
 *      o The base frequency for pins 3, 9, 10, and 11 is 31250 Hz.
 *      o The base frequency for pins 5 and 6 is 62500 Hz.
 *   - Divisors:
 *      o The divisors available on pins 5, 6, 9 and 10 are: 1, 8, 64,
 *        256, and 1024.
 *      o The divisors available on pins 3 and 11 are: 1, 8, 32, 64,
 *        128, 256, and 1024.
 * 
 * PWM frequencies are tied together in pairs of pins. If one in a
 * pair is changed, the other is also changed to match:
 *   - Pins 5 and 6 are paired on timer0
 *   - Pins 9 and 10 are paired on timer1
 *   - Pins 3 and 11 are paired on timer2
 * 
 * Note that this function will have side effects on anything else
 * that uses timers:
 *   - Changes on pins 3, 5, 6, or 11 may cause the delay() and
 *     millis() functions to stop working. Other timing-related
 *     functions may also be affected.
 *   - Changes on pins 9 or 10 will cause the Servo library to function
 *     incorrectly.
 * 
 * Thanks to macegr of the Arduino forums for his documentation of the
 * PWM frequency divisors. His post can be viewed at:
 *   http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1235060559/0#4
 */</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setPwmFrequency</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pin, <span class="hljs-keyword">int</span> divisor)</span> </span>{
  <span class="hljs-keyword">byte</span> mode;
  <span class="hljs-keyword">if</span>(pin == <span class="hljs-number">5</span> || pin == <span class="hljs-number">6</span> || pin == <span class="hljs-number">9</span> || pin == <span class="hljs-number">10</span>) {
    <span class="hljs-keyword">switch</span>(divisor) {
      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: mode = <span class="hljs-number">0x01</span>; <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>: mode = <span class="hljs-number">0x02</span>; <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">64</span>: mode = <span class="hljs-number">0x03</span>; <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">256</span>: mode = <span class="hljs-number">0x04</span>; <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">1024</span>: mode = <span class="hljs-number">0x05</span>; <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">if</span>(pin == <span class="hljs-number">5</span> || pin == <span class="hljs-number">6</span>) {
      <span class="caps">TCCR0B</span> = TCCR0B <span class="amp">&amp;</span> <span class="hljs-number">0</span>b11111000 | mode;
    } <span class="hljs-keyword">else</span> {
      <span class="caps">TCCR1B</span> = TCCR1B <span class="amp">&amp;</span> <span class="hljs-number">0</span>b11111000 | mode;
    }
  } <span class="hljs-function"><span class="hljs-keyword">else</span> <span class="hljs-title">if</span><span class="hljs-params">(pin == <span class="hljs-number">3</span> || pin == <span class="hljs-number">11</span>)</span> </span>{
    <span class="hljs-keyword">switch</span>(divisor) {
      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: mode = <span class="hljs-number">0x01</span>; <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>: mode = <span class="hljs-number">0x02</span>; <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">32</span>: mode = <span class="hljs-number">0x03</span>; <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">64</span>: mode = <span class="hljs-number">0x04</span>; <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">128</span>: mode = <span class="hljs-number">0x05</span>; <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">256</span>: mode = <span class="hljs-number">0x06</span>; <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">1024</span>: mode = <span class="hljs-number">0x7</span>; <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span>;
    }
    <span class="caps">TCCR2B</span> = TCCR2B <span class="amp">&amp;</span> <span class="hljs-number">0</span>b11111000 | mode;
  }
}
</code></pre></section>
          </article>
          <div style="text-align: right">
            <ul class="tags">
              <li><a href="/tag/arduino" style="font-size: 10.474258731775668px">#arduino</a> </li>
              <li><a href="/tag/retrospective" style="font-size: 11.192029220221176px">#retrospective</a> </li>
            </ul>
          </div><br>
          <div class="splitter">
            <hr>related
          </div>
          <div class="hand"><a href="/project/icosahedron/" class="thumb">
              <div class="caption">
                <h2>Icosahedron</h2>
                <div class="sub">contrary to popular belief, this is in fact not a dodecahedron</div>
              </div><img src="/img/projects/ico-medium.jpg"></a><a href="/project/dorm-weather/" class="thumb">
              <div class="caption">
                <h2>Dorm Weather</h2>
                <div class="sub">the art of collecting data and totally forgetting about it</div>
              </div><img src="/img/projects/weather-medium.jpg"></a><a href="/project/droste-dorm/" class="thumb">
              <div class="caption">
                <h2>Droste Dorm</h2>
                <div class="sub">a poster on my wall, of my wall, featuring a particular poster
</div>
              </div><img src="/img/projects/droste-medium.jpg"></a><a href="/project/pedant/" class="thumb">
              <div class="caption">
                <h2>Pedant</h2>
                <div class="sub">augmented reality for your feet
</div>
              </div><img src="/img/projects/pedant-medium.jpg"></a><a href="/project/gestures/" class="thumb">
              <div class="caption">
                <h2>Gestures</h2>
                <div class="sub">A light pen gesture recognizer inspired by Palm's Graffiti
</div>
              </div><img src="/img/projects/gesture-medium.jpg"></a><a href="/project/auto-scan/" class="thumb">
              <div class="caption">
                <h2>Auto Scan</h2>
                <div class="sub">automatically scan documents on lid close using arduino</div>
              </div><img src="/img/projects/scan-medium.jpg"></a><a href="/project/lifx-music/" class="thumb">
              <div class="caption">
                <h2>LIFX + Music</h2>
                <div class="sub">moozik</div>
              </div><img src="/img/projects/lifx-medium.jpg"></a>
          </div>
          <div class="splitter">
            <hr>comments
          </div><br><div id="disqus_thread"></div>
          <script>
            var disqus_shortname = 'antimatter15',
                disqus_title = 'Changing PWM Frequency for Arduino Leonardo',
                disqus_url = 'https://antimatter15.com/2014/10/changing-pwm-frequency-for-arduino-leonardo/';
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
          </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
        </div>
      </div>
    </div>
    <script>
      function squish(){
        document.getElementById("squishfoot").className += "squish"
      }
    </script>
    <style>
      .squish { font-size: 9px }
      .squishsquish { font-size: 8px }
      .squishsquishsquish { font-size: 7px }
      .squishsquishsquishsquish { font-size: 6px }
      .squishsquishsquishsquishsquish { font-size: 5px }
      .squishsquishsquishsquishsquishsquish { font-size: 4px }
      .squishsquishsquishsquishsquishsquishsquish { visibility: hidden }
    </style>
    <div class="graybar bottom">
      <footer>
        <div id="squishfoot">I'm a tiny footer, please don't <a href="javascript:squish()">squish</a> me</div>
      </footer>
    </div>
  </body>
</html>