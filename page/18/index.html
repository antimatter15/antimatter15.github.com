<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" href="http://localhost:8080/feed.xml" type="application/rss+xml" title="somewhere to talk about ideas and projects and stuff like everyone else">
    <link rel="stylesheet" href="/style/main.css">
  </head>
  <body>
    <div class="whitebox">
      <div class="graybar top">
        <header class="top">
          <div class="slogan">somewhere to talk about random ideas and projects like everyone else</div><a href="/">
            <h1 class="logo">
              stuff
               <span class="byline">by antimatter15</span>
            </h1></a>
        </header>
      </div>
      <div id="main">
        <div class="sidebar">
          <div class="about">
            <p class="emph">
              Hi. I’m <b>Kevin Kwok</b>, and I’m currently a sophomore at <b>MIT</b>, 
              and this is my obligatory online presence or whatever.  
            </p>
            <p>
              I regularly updated this site from 2007, when I started it in elementary school, 
              to summer 2014, when it was unwittingly absorbed into an international phishing ring.
            </p>
            <p>
              But like a phoenix, hydra or the national deficit, the site is back 
              again bigger than ever (after a rather long gestation period).
            </p>
            <p>
              For more obnoxious autobiographical content 
              blended with bits of nostalgia for the old PHP-on-sketchy-free-webhosting days, click here.
            </p>
          </div><br>
          <section class="archive"><a href="/archive">
              <h2>Archive</h2></a>
            <ul>
              <li>
                <ul>
                  <li><a href="/2015/04"><span class="month">April</span> <span class="year">2015</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2014/05"><span class="month">May</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/04"><span class="month">April</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/03"><span class="month">March</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/02"><span class="month">February</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/01"><span class="month">January</span> <span class="year">2014</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2013/12"><span class="month">December</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/11"><span class="month">November</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/10"><span class="month">October</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/09"><span class="month">September</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/08"><span class="month">August</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/07"><span class="month">July</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/06"><span class="month">June</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/05"><span class="month">May</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/04"><span class="month">April</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/03"><span class="month">March</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/02"><span class="month">February</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/01"><span class="month">January</span> <span class="year">2013</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2012/12"><span class="month">December</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/11"><span class="month">November</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/10"><span class="month">October</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/09"><span class="month">September</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/08"><span class="month">August</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/07"><span class="month">July</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/06"><span class="month">June</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/05"><span class="month">May</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/04"><span class="month">April</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/03"><span class="month">March</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/02"><span class="month">February</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/01"><span class="month">January</span> <span class="year">2012</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2011/12"><span class="month">December</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/11"><span class="month">November</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/10"><span class="month">October</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/09"><span class="month">September</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/08"><span class="month">August</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/07"><span class="month">July</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/06"><span class="month">June</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/05"><span class="month">May</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/04"><span class="month">April</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/03"><span class="month">March</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/02"><span class="month">February</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/01"><span class="month">January</span> <span class="year">2011</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2010/12"><span class="month">December</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/11"><span class="month">November</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/10"><span class="month">October</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/09"><span class="month">September</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/08"><span class="month">August</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/07"><span class="month">July</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/06"><span class="month">June</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/05"><span class="month">May</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/04"><span class="month">April</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/03"><span class="month">March</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/02"><span class="month">February</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/01"><span class="month">January</span> <span class="year">2010</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2009/12"><span class="month">December</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/11"><span class="month">November</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/10"><span class="month">October</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/09"><span class="month">September</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/08"><span class="month">August</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/07"><span class="month">July</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/06"><span class="month">June</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/05"><span class="month">May</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/04"><span class="month">April</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/03"><span class="month">March</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/01"><span class="month">January</span> <span class="year">2009</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2008/12"><span class="month">December</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/11"><span class="month">November</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/10"><span class="month">October</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/09"><span class="month">September</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/08"><span class="month">August</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/07"><span class="month">July</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/06"><span class="month">June</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/05"><span class="month">May</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/04"><span class="month">April</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/01"><span class="month">January</span> <span class="year">2008</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2007/12"><span class="month">December</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/11"><span class="month">November</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/10"><span class="month">October</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/09"><span class="month">September</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/08"><span class="month">August</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/05"><span class="month">May</span> <span class="year">2007</span></a></li>
                </ul><br>
              </li>
            </ul>
          </section>
          <div class="tags">
            <h2>Tags</h2><a href="/tag/3D" style="font-size: 15px">3D </a><a href="/tag/ajax" style="font-size: 19.998766054240136px">ajax </a><a href="/tag/ajax animator" style="font-size: 19.99983298578152px">ajax animator </a><a href="/tag/api" style="font-size: 15px">api </a><a href="/tag/apple" style="font-size: 19.93307149075715px">apple </a><a href="/tag/art" style="font-size: 12.689414213699951px">art </a><a href="/tag/awesome" style="font-size: 15px">awesome </a><a href="/tag/blog" style="font-size: 17.31058578630005px">blog </a><a href="/tag/browser" style="font-size: 19.93307149075715px">browser </a><a href="/tag/bugfix" style="font-size: 17.31058578630005px">bugfix </a><a href="/tag/canvas" style="font-size: 15px">canvas </a><a href="/tag/change" style="font-size: 17.31058578630005px">change </a><a href="/tag/chrome" style="font-size: 19.999999998973813px">chrome </a><a href="/tag/chrome extension" style="font-size: 12.689414213699951px">chrome extension </a><a href="/tag/chrome os" style="font-size: 12.689414213699951px">chrome os </a><a href="/tag/chromebook" style="font-size: 12.689414213699951px">chromebook </a><a href="/tag/code" style="font-size: 15px">code </a><a href="/tag/color" style="font-size: 12.689414213699951px">color </a><a href="/tag/colors" style="font-size: 12.689414213699951px">colors </a><a href="/tag/css" style="font-size: 12.689414213699951px">css </a><a href="/tag/demo" style="font-size: 12.689414213699951px">demo </a><a href="/tag/design" style="font-size: 18.807970779778824px">design </a><a href="/tag/elitist" style="font-size: 19.820137900379084px">elitist </a><a href="/tag/evil" style="font-size: 19.52574126822433px">evil </a><a href="/tag/experiment" style="font-size: 15px">experiment </a><a href="/tag/export" style="font-size: 12.689414213699951px">export </a><a href="/tag/extension" style="font-size: 19.820137900379084px">extension </a><a href="/tag/ExtJS" style="font-size: 19.820137900379084px">ExtJS </a><a href="/tag/facebook" style="font-size: 12.689414213699951px">facebook </a><a href="/tag/fast" style="font-size: 19.820137900379084px">fast </a><a href="/tag/features" style="font-size: 17.31058578630005px">features </a><a href="/tag/firefox" style="font-size: 19.975273768433652px">firefox </a><a href="/tag/flash" style="font-size: 18.807970779778824px">flash </a><a href="/tag/free" style="font-size: 12.689414213699951px">free </a><a href="/tag/function" style="font-size: 15px">function </a><a href="/tag/future" style="font-size: 17.31058578630005px">future </a><a href="/tag/GAE" style="font-size: 15px">GAE </a><a href="/tag/github" style="font-size: 17.31058578630005px">github </a><a href="/tag/google" style="font-size: 19.999999999999872px">google </a><a href="/tag/google code" style="font-size: 12.689414213699951px">google code </a><a href="/tag/google wave" style="font-size: 19.998766054240136px">google wave </a><a href="/tag/graphics" style="font-size: 15px">graphics </a><a href="/tag/hacking" style="font-size: 12.689414213699951px">hacking </a><a href="/tag/hosting" style="font-size: 19.52574126822433px">hosting </a><a href="/tag/html5" style="font-size: 19.52574126822433px">html5 </a><a href="/tag/idea" style="font-size: 15px">idea </a><a href="/tag/images" style="font-size: 12.689414213699951px">images </a><a href="/tag/internet exploder" style="font-size: 19.820137900379084px">internet exploder </a><a href="/tag/ipad" style="font-size: 18.807970779778824px">ipad </a><a href="/tag/javascript" style="font-size: 19.99999999721053px">javascript </a><a href="/tag/json" style="font-size: 17.31058578630005px">json </a><a href="/tag/library" style="font-size: 12.689414213699951px">library </a><a href="/tag/light" style="font-size: 12.689414213699951px">light </a><a href="/tag/lines" style="font-size: 15px">lines </a><a href="/tag/linux" style="font-size: 18.807970779778824px">linux </a><a href="/tag/login" style="font-size: 17.31058578630005px">login </a><a href="/tag/mac" style="font-size: 12.689414213699951px">mac </a><a href="/tag/magical" style="font-size: 17.31058578630005px">magical </a><a href="/tag/math" style="font-size: 12.689414213699951px">math </a><a href="/tag/meta" style="font-size: 12.689414213699951px">meta </a><a href="/tag/microsoft" style="font-size: 15px">microsoft </a><a href="/tag/microwave" style="font-size: 17.31058578630005px">microwave </a><a href="/tag/mirror" style="font-size: 12.689414213699951px">mirror </a><a href="/tag/multitouch" style="font-size: 15px">multitouch </a><a href="/tag/new" style="font-size: 19.52574126822433px">new </a><a href="/tag/nostalgia" style="font-size: 12.689414213699951px">nostalgia </a><a href="/tag/ocr" style="font-size: 12.689414213699951px">ocr </a><a href="/tag/offline" style="font-size: 18.807970779778824px">offline </a><a href="/tag/old" style="font-size: 18.807970779778824px">old </a><a href="/tag/onlypaths" style="font-size: 18.807970779778824px">onlypaths </a><a href="/tag/pi" style="font-size: 19.52574126822433px">pi </a><a href="/tag/processing" style="font-size: 12.689414213699951px">processing </a><a href="/tag/prototype" style="font-size: 15px">prototype </a><a href="/tag/python" style="font-size: 19.93307149075715px">python </a><a href="/tag/raphael" style="font-size: 19.52574126822433px">raphael </a><a href="/tag/release" style="font-size: 15px">release </a><a href="/tag/rewrite" style="font-size: 15px">rewrite </a><a href="/tag/security" style="font-size: 15px">security </a><a href="/tag/shiny" style="font-size: 19.975273768433652px">shiny </a><a href="/tag/ShinyTouch" style="font-size: 15px">ShinyTouch </a><a href="/tag/site" style="font-size: 15px">site </a><a href="/tag/small" style="font-size: 19.52574126822433px">small </a><a href="/tag/spam" style="font-size: 12.689414213699951px">spam </a><a href="/tag/speed" style="font-size: 12.689414213699951px">speed </a><a href="/tag/SVG" style="font-size: 17.31058578630005px">SVG </a><a href="/tag/touch" style="font-size: 15px">touch </a><a href="/tag/update" style="font-size: 19.999999943972036px">update </a><a href="/tag/upload" style="font-size: 18.807970779778824px">upload </a><a href="/tag/user interface" style="font-size: 12.689414213699951px">user interface </a><a href="/tag/vector" style="font-size: 15px">vector </a><a href="/tag/vectoreditor" style="font-size: 19.52574126822433px">vectoreditor </a><a href="/tag/version" style="font-size: 15px">version </a><a href="/tag/video" style="font-size: 17.31058578630005px">video </a><a href="/tag/vp8" style="font-size: 12.689414213699951px">vp8 </a><a href="/tag/vX JS" style="font-size: 19.52574126822433px">vX JS </a><a href="/tag/wave" style="font-size: 19.99999694097773px">wave </a><a href="/tag/webcam" style="font-size: 12.689414213699951px">webcam </a><a href="/tag/wikify" style="font-size: 19.820137900379084px">wikify </a><a href="/tag/wikipedia" style="font-size: 18.807970779778824px">wikipedia </a><a href="/tag/wordpress" style="font-size: 19.820137900379084px">wordpress </a>
          </div>
        </div>
        <div id="content">
          <article class="article intro">
            <header>
              <h2><a href="/2010/08/dom-indexer-js-compression/">DOM Indexer JS Compression</a> <span class="subtitle">05 August 2010</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2010/DOM%20Indexer%20JS%20Compression/Screenshot.png"><img src="/articles/2010/DOM%20Indexer%20JS%20Compression/Screenshot.png" alt="" title="Screenshot"></a></p>
<p>There’s lots of compression systems for <span class="caps">JS</span> out there. There’s the really smart JS rewriter magical rhino-based ones like Closure and YUI. There’s the string-based ones, packer base62, huffman, and lz77. But of the latter category, they all rely on a sort of dictionary coder, where the dictionary (or huffman tree) needs to be sent alongside the compressed&nbsp;content.</p>
<p>Unlike strings of bits, javascript code often refers to methods on the document object model. If we were to crawl the <span class="caps">DOM</span>, we could get a list of DOM properties and use that as the shared dictionary which doesn’t need to be changed, sent or stored.&nbsp;Ever.</p>
<p>Example:</p>
<pre><code><span style='display:none' detected-language='ruby'></span><span class="hljs-prompt">document.getElementById —&gt;</span> <span class="hljs-variable">$dgEln</span>

<span class="hljs-prompt">document.body.appendChild(s); -&gt;</span> <span class="hljs-variable">$dbaChp</span>(s);
</code></pre><p>And as the dictionary never needs to be stored, it’s dynamically computed based on the default browser <span class="caps">DOM</span>, there is a constant overhead for the indexer. The dictionary does not change size based on the size of the&nbsp;content.</p>
<p>The first prototype relied on recursively indexing properties 2-3 levels from window using the <span class="caps">ES5</span> <code>Object.getOwnPropertyNames</code>.  That feature is only supported on <span class="caps">IE9</span>, Chrome 6, probably the latest versions of Safari and Firefox 4. As such, it severely limits the applicability of the&nbsp;algorithm.</p>
<p>Version two switches it to a simple for..in loop. The problem here is that it’s no loner possible to index certain things. Properties like Math, which are marked DontEnum internally can not be iterated, and thus can not be compressed (Math.cos would have been <code>$Mac8</code>). However, it probably makes up for this by recursively indexing things substrings of the discovered objects. So document.getElementById would be interpreted as the full <code>document.getElementById</code> instead of seperately compressing document and <code>getElementById</code>. It also uses a new hash function which makes the output more readable and the length proportional to the length of the source. length becomes <code>$l6</code>, and <code>document.body.removeChild</code> becomes <code>$dbrChp</code>. However, this also removes the possibility of that nice fallback on things not supported by the browser. (<code>if(document.getElementsByClassName){}else{}</code> would have been translated as d3k2.s93k and back as <code>document.s93k</code> on browsers that dont support it and so browser detection gracefully degrades without blah is not defined&nbsp;errors).</p>
<p>Overall. What is the compression ratio? Not that great. If you do lots and lots of <span class="caps">DOM</span> access then you might get a decent ratio, but the code is slow and the ratios are relatively&nbsp;insignificant.</p>
<p>Minify: <a href="http://antimatter15.com/misc/js-minify/minify.html">http://antimatter15.com/misc/js-minify/minify.html</a></p>
<p>Maxify (decoder): <a href="http://antimatter15.com/misc/js-minify/maxify.html">http://antimatter15.com/misc/js-minify/maxify.html</a></p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/08/jailbreakme-com/">jailbreakme.com</a> <span class="subtitle">01 August 2010</span></h2>
            </header>
            <section class="content"><p>I couldn’t resist looking into the source of it. It is obfuscated a bit, but there are some interesting parts. Example: How it detects device&nbsp;models.</p>
<p>For iPad, well there’s just one iPad so they just search the <span class="caps">UA</span> string for iPad and it’s totally iPad1,1. iPhone 4 is detected by the global devicePixelRatio property, because<a href="http://aralbalkan.com/3331"> the pixel is dying</a>. Differentiating between iPhone models (not just firmware versions) is pretty awesome. They do a speed test. Specifically, <a href="http://www2.webkit.org/perf/sunspider-0.9/sunspider.html">SunSpider</a>. It’s pretty much the de-facto standard web benchmark nowadays, and it was also started by Apple for the Webkit&nbsp;project.</p>
<p>Apart from that, the exploit itself is <span class="caps">PDF</span> based. Which is interesting as Adobe Reader <a href="http://www.computerworld.com/s/article/9157438/Rogue_PDFs_account_for_80_of_all_exploits_says_researcher">accounted for 80% of exploits</a> in 2009. However, iOS’s implementation is probably totally independent, but it’s neat seeing this happen. The exploit is located at <a href="http://jailbreakme.com/_/device_model/device_firmware.pdf">http://jailbreakme.com/_/device_model/device_firmware.pdf</a>. For example, the iPhone 4’s <span class="caps">URL</span> would be <a href="http://jailbreakme.com/_/iPhone3,1/4.0.pdf">http://jailbreakme.com/_/iPhone3,1/4.0.pdf</a>. The resulting file is 12.<span class="caps">9KB</span>. I assume it’s some pretty standard attack code because I’m not a hacker and I know absolutely nothing about&nbsp;that.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/07/javascript-canvas-to-animated-gif/">JavaScript &lt;canvas&gt; to (Animated) GIF</a> <span class="subtitle">23 July 2010</span></h2>
            </header>
            <section class="content"><p><img src="/articles/2010/JavaScript%20canvas%20to%20(Animated)%20GIF/converted_animation.gif" alt="This is the GIF which was generated from the canvas."></p>
<p><img src="/articles/2010/JavaScript%20canvas%20to%20(Animated)%20GIF/raw_canvas.png" alt="This is the raw canvas element saved as a non-animated PNG"></p>
<p>I’ve <a href="/2010/07/javascript-canvas-to-animated-gif/2009/08/webworkers-canvas-glif-gifencoder-client-side-animated-gif-generation/">tried this before</a> but it didn’t work. <code>&lt;canvas&gt;</code> can’t do <code>toDataURL(&#39;image/gif&#39;)</code>, and the primitive <span class="caps">GLIF</span> library couldn’t do much so I never had the opportunity to test my gif-merging code that I had. But I’m at it again, this time, porting it from the AS3GIF library, an awesomely comprehensive bitmap to binary gif encoder that even supports LZW compression (and the patent has luckily expired. Yay!). AS3Gif is supposed to “play and encode animated GIFs”, but since web pages can usually natively play GIFs fine, it’s only a port of the GIFEncoder portions of the library. And it works really well. The rest of this post is copied from the<a href="http://github.com/antimatter15/jsgif"> Github readme</a>. Interesting how the w2_embed/anonybot embed post was a blog post turned into readme, this is a readme turned into blogpost. I’ll start with a link to the Github repo&nbsp;anyway:</p>
<p><a href="http://github.com/antimatter15/jsgif">http://github.com/antimatter15/jsgif</a></p>
<h3 id="basic-usage">Basic&nbsp;Usage</h3>
<p>Since it pretty much <em>is</em> GIFEncoder, you could consult the <a href="http://code.google.com/p/as3gif/wiki/How_to_use#The_GIFEncoder">as3gif how-to&nbsp;page</a></p>
<p>But there are some differences so I’ll cover it here&nbsp;anyway.!</p>
<p><a href="/articles/2010/JavaScript%20canvas%20to%20(Animated)%20GIF/clock.gif">This is the <span class="caps">GIF</span> which was generated from the&nbsp;canvas.</a></p>
<p>You first need to include the <span class="caps">JS</span> files. It’s probably best if you include it in this order, but it shouldnt’ matter too&nbsp;much.</p>
<pre><code><span style='display:none' detected-language='handlebars'></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"LZWEncoder.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"NeuQuant.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"GIFEncoder.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span></span>
</code></pre><p>If you want to render the gif through an inline <code>&lt;img&gt;</code> tag or try to save to disk or send to server or anything that requires conversion into a non-binary string form, you should probably include <code>b64.js</code> too.</p>
<pre><code><span style='display:none' detected-language='handlebars'></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"b64.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span></span>
</code></pre><p>Simple enough right? Now to convert stuff to <span class="caps">GIF</span>, you need to have a working or at least some imageData-esque&nbsp;array.</p>
<pre><code><span style='display:none' detected-language='handlebars'></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">canvas</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"bitmap"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">canvas</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript"> 
  <span class="hljs-keyword">var</span> canvas = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'bitmap'</span>); 
  <span class="hljs-keyword">var</span> context = canvas.getContext(<span class="hljs-string">'2d'</span>); 
  context.fillStyle = <span class="hljs-string">'rgb(255,255,255)'</span>; 
  context.fillRect(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,canvas.width, canvas.height); <span class="hljs-comment">//<span class="caps">GIF</span> can't do transparent so do white </span>
  context.fillStyle = <span class="hljs-string">"rgb(200,0,0)"</span>; 
  context.fillRect (<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">75</span>, <span class="hljs-number">50</span>); <span class="hljs-comment">//draw a little red box</span></span></span>
</code></pre><p>Now we need to init the&nbsp;GIFEncoder.</p>
<pre><code><span style='display:none' detected-language='coffeescript'></span><span class="hljs-reserved">var</span> encoder = <span class="hljs-keyword">new</span> GIFEncoder();
</code></pre><p><em>If</em> you are making an animated gif, you need to add the&nbsp;following</p>
<pre><code><span style='display:none' detected-language='vhdl'></span>encoder.setRepeat(<span class="hljs-number">0</span>); //<span class="hljs-number">0</span> -&gt; <span class="hljs-keyword">loop</span> forever //<span class="hljs-number">1</span>+ -&gt; <span class="hljs-keyword">loop</span> n times <span class="hljs-keyword">then</span> stop 
encoder.setDelay(<span class="hljs-number">500</span>); //go <span class="hljs-keyword">to</span> <span class="hljs-keyword">next</span> frame every n milliseconds
</code></pre><p>Now, you need to tell the magical thing that you’re gonna start inserting frames (even if it’s only&nbsp;one).</p>
<pre><code><span style='display:none' detected-language='dos'></span>encoder.<span class="hljs-built_in">start</span>();
</code></pre><p>And for the part that took the longest to port: adding a real frame.&nbsp;encoder.addFrame(context);</p>
<p>In the GIFEncoder version, it accepts a Bitmap. Well, that doesn’t exist in Javascript (natively, anyway) so instead, I use what I feel is a decent analogue: the canvas context. However, if you’re in a situation where you don’t have a real <code>&lt;canvas&gt;</code> element. That’s <em>okay</em>. You can set the second parameter to true and pass a imageData.data-esque array as your first argument. So in other words, you can do <code>encoder.addFrame(fake_imageData, true)</code>as an alternative. However, you <em>must</em> do an <code>encoder.setSize(width, height);</code> before you do any of the addFrames if you pass a imageData.data-like array. If you pass a canvas context, then that’s all okay, because it will automagically do a setSize with the canvas width/height&nbsp;stuff.</p>
<p>Now the last part is to finalize the animation and get it for&nbsp;display.</p>
<pre><code><span style='display:none' detected-language='coffeescript'></span>encoder.finish(); 
<span class="hljs-reserved">var</span> binary_gif = encoder.stream().getData() <span class="hljs-regexp">//</span>notice <span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> different from the as3gif package! 
<span class="hljs-reserved">var</span> data_url = <span class="hljs-string">'data:image/gif;base64,'</span>+encode64(binary_gif); 
</code></pre><h3 id="docs">Docs</h3>
<p>Each of the files exposes a single global (see, at least it’s considerate!). But since there’s three files, that means that there’s three globals. But two of them are more of supporting libraries that I don’t totally understand or care about enough to document. So I’m just gonna document&nbsp;GIFEncoder.</p>
<p><code>new GIFEncoder()</code> This is super parent function. You really don’t need the <code>new</code> keyword because It’s not really even using any special inheritance pattern. It’s a closure that does some <code>var blah = exports.blah = function blah(){</code> for no good reason. Anyway, it returns an object with a bunch of methods that the section will be devoted to documenting. Note that I’ve never tested more than half of these, so good&nbsp;luck.</p>
<p><code>Boolean start()</code> This writes the <span class="caps">GIF</span> Header and returns <code>false</code> if it&nbsp;fails.</p>
<p><code>Boolean addFrame(CanvasRenderingContext2D context)</code> This is the magical magic behind everything. This adds a&nbsp;frame.</p>
<p><code>Boolean addFrame(CanvasPixelArray image, true)</code> This is the magical magic behind everything. This adds a frame. This time you need
you pass <code>true</code> as the second argument and then magic strikes and it loads your canvas pixel array (which can be a real array, I dont care and I think the program has learned from my constant apathy to also not care). But note that if you do, you must first manually call
<code>setSize</code> which is happily defined just below this&nbsp;one.</p>
<p><code>void setSize(width, height)</code> Sets the canvas size. It’s supposed to be private, but I’m exposing it anyway. Gets called automagically as the size of the first frame if you don’t do that crappy hacky imageData.data&nbsp;hack.</p>
<p><code>void setDelay(int milliseconds)</code> the number of milliseconds to wait on each&nbsp;frame</p>
<p><code>void setDispose(int code)</code> Sets the <span class="caps">GIF</span> frame disposal code for the last added frame and any subsequent frames. Default is 0 if no transparent color has been set, otherwise 2. I have no clue what this means so I just copypasted
it from the actionscript&nbsp;docs.</p>
<p><code>void setFrameRate(Number fps)</code> Sets frame rate in frames per second. Equivalent to <code>setDelay(1000/fps)</code>. I think that’s&nbsp;stupid.</p>
<p><code>void setQuality(int quality)</code> Sets quality of color quantization (conversion of images to the maximum 256 colors allowed by the <span class="caps">GIF</span> specification). Lower values (minimum = 1) produce better colors, but slow processing significantly. 10 is the default, and produces good color mapping at reasonable speeds. Values greater than 20 do not yield significant improvements in speed. BLAH BLAH BLAH.&nbsp;Whatever</p>
<p><code>void setRepeat(int iter)</code> Sets the number of times the set of <span class="caps">GIF</span> frames should be played. Default is 1; 0 means play indefinitely. Must be invoked before the first image is&nbsp;added.</p>
<p><code>void setTransparent(Number color)</code> Sets the transparent color for the last added frame and any subsequent frames. Since all colors are subject to modification in the quantization process, the color in the final palette for each frame closest to the given color becomes the transparent color for that frame. May be set to null to indicate no transparent&nbsp;color.</p>
<p><code>ByteArray finish()</code> Adds final trailer to the <span class="caps">GIF</span> stream, if you don’t call the finish method the GIF stream will not be&nbsp;valid.</p>
<p><code>String stream()</code> Yay the only function that returns a non void/boolean. It’s the magical stream function which should have been a getter which <span class="caps">JS</span> does support but I didnt’ feel like making it a getter because getters are so weird and inconsistent. Like sure there’s the nice pretty <code>get</code> thing but I think <span class="caps">IE9</span>/8 doesn’t implement it because it’s non standard or something and replaced it with a hideously ugly blah blah. So Anyway, it’s a function. It returns a byteArray with three writeByte functions that you wouldn’t care about and a <code>getData()</code> function which returns a binary string with the <span class="caps">GIF</span>. There’s also a <code>.bin</code> attribute which contains an array with the binary stuff that I don’t care&nbsp;about.</p>
<h3 id="webworkers">WebWorkers</h3>
<p>The process isn’t really the fastest thing ever, so you should use WebWorkers for piecing together animations more than a few frames long. You can find the rest of the WebWorkers section on the actual readme, because the rest is just a huge block of code with&nbsp;comments.</p>
<p><a href="http://github.com/antimatter15/jsgif">http://github.com/antimatter15/jsgif</a></p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/07/experiment-ruby-style-function-auto-calling-in-javascript/">Experiment Ruby-style function auto-calling in Javascript</a> <span class="subtitle">22 July 2010</span></h2>
            </header>
            <section class="content"><p>I have no clue what it’s called when ruby automatically runs a function.
After not totally understanding <a href="http://github.com/tobeytailor/def.js">def.js</a> and looking at this <a href="http://github.com/jashkenas/coffee-script/issues/514">coffee-script issu</a>e from the <a href="http://githubissues.heroku.com/#jashkenas/coffee-script/514">cappuccino github issues browser</a>. I had a horrible&nbsp;idea.</p>
<pre><code><span style='display:none' detected-language='javascript'></span><span class="hljs-built_in">Function</span>.prototype.valueOf = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>()}
</code></pre><p>What does it&nbsp;do?</p>
<pre><code><span style='display:none' detected-language='cs'></span><span class="hljs-function">function <span class="hljs-title">getValue</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">42</span>
}
<span class="hljs-keyword">if</span>(getValue == <span class="hljs-number">42</span>){
    alert(<span class="hljs-string">'fortytwo'</span>)
}<span class="hljs-keyword">else</span>{
    alert(<span class="hljs-string">'not fortytwo'</span>)
}
</code></pre><p>Notice notably absent in the if statement are the expected parentheses ‘()’ needed to call them. It gets stranger&nbsp;still.</p>
<pre><code><span style='display:none' detected-language='cs'></span>alert(getValue == <span class="hljs-number">42</span>); <span class="hljs-comment">//true</span>
alert(getValue() == <span class="hljs-number">42</span>); <span class="hljs-comment">//true</span>
alert(getValue() === <span class="hljs-number">42</span>); <span class="hljs-comment">//true</span>
alert(getValue === <span class="hljs-number">42</span>); <span class="hljs-comment">//false</span>
<span class="hljs-function"><span class="hljs-keyword">typeof</span> <span class="hljs-title">getValue</span><span class="hljs-params">()</span> <span class="hljs-comment">//number</span>
<span class="hljs-keyword">typeof</span> getValue <span class="hljs-comment">//function</span>

<span class="hljs-keyword">var</span> sample1 </span>= getValue;
<span class="hljs-keyword">typeof</span>(sample1) <span class="hljs-comment">//function</span>

<span class="hljs-keyword">var</span> sample2 = getValue();
<span class="hljs-keyword">typeof</span>(sample2) <span class="hljs-comment">//number</span>
</code></pre><p>One advantage is that it makes a super hacky/semi-working implementation of getters that <em>should</em> work universally (maybe). Except that it doesn’t. It’s practically&nbsp;useless.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/07/shinytouch-opencv/">ShinyTouch/OpenCV</a> <span class="subtitle">15 July 2010</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2010/ShinyTouchOpenCV/ShinyTouch_0171.png"><img src="/articles/2010/ShinyTouchOpenCV/ShinyTouch_0171.png" alt="" title="ShinyTouch_017"></a></p>
<p>I have yet to give up entirely on <a href="/2010/07/shinytouch-opencv/2009/07/shinytouch-zero-setup-single-touch-surface-retrofitting-technology/">ShinyTouch</a>, my experiment into creating a touch screen input system which requires <strong>virtually no setup</strong>. For people who haven’t read my posts from last year, it works because magically things look shinier when you look at it from an angle. And so if you mount a camera at an angle (It doesn’t need to be as extreme as the screenshot above), you end up seeing a reflection on the surface of the screen (this could be aided by a transparent layer of acrylic or by having a glossy display, but as you can see, mine are matte, but they still work). The other pretty obvious idea of ShinyTouch, is that on a reflective surface, especially observed from a non-direct angle, you can see that the distance from the reflection (I guess my eighth grade science teacher would say the “virtual image”) to the apparent finger, or “real image” is twice the distance from either to the surface of the display.  In other words, the <strong>reflection gets closer to you when you get closer to the mirror</strong>. A webcam usually gives a two-dimensional bitmap of data (and one non-spatial dimension of time). This gives (after a perspective transform) the <strong>X and Y positions</strong> of the finger. But an important aspect of a touchscreen and what this technology is also capable of, a “zero-touch screen”, is a <strong>Z axis: the distance of the finger and the screen</strong>. A touchscreen has a binary Z-axis: touch or no touch. Since you can measure the <strong>distance between the apparent real finger and it’s reflection, you can get the Z-axis</strong>. That’s how ShinyTouch&nbsp;works.</p>
<p>Last year someone was interested and actually contributed some code. Eventually we both agreed that my code was crap so he decided to <a href="http://github.com/ddlshack/shinytouch">rewrite</a> it, this time using less <span class="caps">PIL</span> and pixel manipulation, and instead, opting for more OpenCV so it’s faster. The project died a bit early this year, and with nothing more to do,<a href="http://github.com/antimatter15/shinytouch"> I decided to revive it</a>. His code had some neat&nbsp;features:</p>
<ul>
<li>Better perspective&nbsp;performs</li>
<li>Faster</li>
<li>Less&nbsp;Buggy</li>
<li>Simpler configuration (track bars instead of key combinations and editing <span class="caps">JSON</span>&nbsp;files)</li>
<li><p>Yellow square to indicate which corner to click when callibrating (actually, <a href="http://github.com/ddlshack/shinytouch/commit/9df521a08c8a12e6b8d1aa58d665394faaaac10f">I wrote</a> that feature)
It was left however, at a pretty unfinished state. It couldn’t do anything more than generate config files through a nice <span class="caps">UI</span> and doing a perspective transform on the raw video feed. So in the last few days, I added a few more&nbsp;features.</p>
</li>
<li><p>Convert perspective-transformed code into&nbsp;grayscale</p>
</li>
<li>Apply a 6x6 gaussian blur&nbsp;filter</li>
<li>Apply a binary threshold&nbsp;filter</li>
<li>Copy it over to <span class="caps">PIL</span> and shrink the canvas by 75% for performance&nbsp;reasons</li>
<li>Hack a Python flood-fill function to do blob detection (because I couldn’t compile any python bindings for the opencv blob&nbsp;library)</li>
<li>Filter those blobs (sort of)
Basically, it means ShinyTouch can now do multi-touch. Though the Z-axis processing, which is really what the project is all about still sucks. Like it sucks <em>a lot</em>. But when it does work (on a rare occasion), <strong>you get multitouch</strong> (yay). If <span class="caps">TUIO</span> gets ported (again), it’ll probably be able to interface with all the neat TUIO based&nbsp;apps.</li>
</ul>
<p>Code here: <a href="http://github.com/antimatter15/shinytouch/">http://github.com/antimatter15/shinytouch/</a> Please help, you probably don’t want to try it&nbsp;(yet).</p>

            </section>
          </article>
          <hr>
          <div class="nav"><a href="/page/17/" class="newer">« Newer</a><a href="/page/19/" class="next">Next page »</a>
          </div>
        </div>
      </div>
    </div>
    <script>
      function squish(){
        document.getElementById("squishfoot").className += "squish"
      }
    </script>
    <style>
      .squish { font-size: 9px }
      .squishsquish { font-size: 8px }
      .squishsquishsquish { font-size: 7px }
      .squishsquishsquishsquish { font-size: 6px }
      .squishsquishsquishsquishsquish { font-size: 5px }
      .squishsquishsquishsquishsquishsquish { font-size: 4px }
      .squishsquishsquishsquishsquishsquishsquish { visibility: hidden }
    </style>
    <div class="graybar bottom">
      <footer>
        <div id="squishfoot">I'm a tiny footer, please don't <a href="javascript:squish()">squish</a> me</div>
      </footer>
    </div>
  </body>
</html>