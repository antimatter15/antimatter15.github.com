<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" href="/feed.xml" type="application/rss+xml" title="somewhere to talk about ideas and projects and stuff like everyone else">
    <link rel="stylesheet" href="/style/main.css">
    <title>stuff</title>
  </head>
  <body>
    <div class="whitebox">
      <div class="graybar top">
        <header class="top">
          <div class="slogan">somewhere to talk about random ideas and projects like everyone else</div><a href="/">
            <h1 class="logo">
              stuff
               <span class="byline">by antimatter15</span>
            </h1></a>
        </header>
      </div>
      <div id="main">
        <div class="sidebar">
          <div class="about">
            <p class="emph">
              Hi. I’m <b>Kevin Kwok</b>, and I’m currently a junior at <b>MIT</b>, 
              and this is my obligatory online presence or whatever.  
            </p>
            <p>This is my little corner of the internet, where I talk about random projects and ideas and stuff. </p>
            <p>If you want to contact me or read obnoxiously nostalgic autobiographical trivia, check out the <a href="/about"> about </a>section.</p>
          </div><br>
          <section class="archive"><a href="/archive">
              <h2>Archive</h2></a>
            <ul>
              <li>
                <ul>
                  <li><a href="/2015/12"><span class="month">December</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/08"><span class="month">August</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/06"><span class="month">June</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/05"><span class="month">May</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/04"><span class="month">April</span> <span class="year">2015</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2014/12"><span class="month">December</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/07"><span class="month">July</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/06"><span class="month">June</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/05"><span class="month">May</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/04"><span class="month">April</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/03"><span class="month">March</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/02"><span class="month">February</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/01"><span class="month">January</span> <span class="year">2014</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2013/12"><span class="month">December</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/11"><span class="month">November</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/10"><span class="month">October</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/09"><span class="month">September</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/08"><span class="month">August</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/07"><span class="month">July</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/06"><span class="month">June</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/05"><span class="month">May</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/04"><span class="month">April</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/03"><span class="month">March</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/02"><span class="month">February</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/01"><span class="month">January</span> <span class="year">2013</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2012/12"><span class="month">December</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/11"><span class="month">November</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/10"><span class="month">October</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/09"><span class="month">September</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/08"><span class="month">August</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/07"><span class="month">July</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/06"><span class="month">June</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/05"><span class="month">May</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/04"><span class="month">April</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/03"><span class="month">March</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/02"><span class="month">February</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/01"><span class="month">January</span> <span class="year">2012</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2011/12"><span class="month">December</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/11"><span class="month">November</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/10"><span class="month">October</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/09"><span class="month">September</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/08"><span class="month">August</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/07"><span class="month">July</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/06"><span class="month">June</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/05"><span class="month">May</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/04"><span class="month">April</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/03"><span class="month">March</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/02"><span class="month">February</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/01"><span class="month">January</span> <span class="year">2011</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2010/12"><span class="month">December</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/11"><span class="month">November</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/10"><span class="month">October</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/09"><span class="month">September</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/08"><span class="month">August</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/07"><span class="month">July</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/06"><span class="month">June</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/05"><span class="month">May</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/04"><span class="month">April</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/03"><span class="month">March</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/02"><span class="month">February</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/01"><span class="month">January</span> <span class="year">2010</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2009/12"><span class="month">December</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/11"><span class="month">November</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/10"><span class="month">October</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/09"><span class="month">September</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/08"><span class="month">August</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/07"><span class="month">July</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/06"><span class="month">June</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/05"><span class="month">May</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/04"><span class="month">April</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/03"><span class="month">March</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/01"><span class="month">January</span> <span class="year">2009</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2008/12"><span class="month">December</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/11"><span class="month">November</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/10"><span class="month">October</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/09"><span class="month">September</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/08"><span class="month">August</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/07"><span class="month">July</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/06"><span class="month">June</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/05"><span class="month">May</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/04"><span class="month">April</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/01"><span class="month">January</span> <span class="year">2008</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2007/12"><span class="month">December</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/11"><span class="month">November</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/10"><span class="month">October</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/09"><span class="month">September</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/08"><span class="month">August</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/05"><span class="month">May</span> <span class="year">2007</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2006/09"><span class="month">September</span> <span class="year">2006</span></a></li>
                  <li><a href="/2006/08"><span class="month">August</span> <span class="year">2006</span></a></li>
                </ul><br>
              </li>
            </ul>
          </section>
          <div class="tags">
            <h2>Tags</h2><a href="/tag/3D" style="font-size: 13px">3D </a><a href="/tag/actionscript" style="font-size: 11px">actionscript </a><a href="/tag/ajax" style="font-size: 20px">ajax </a><a href="/tag/ajax animator" style="font-size: 20px">ajax animator </a><a href="/tag/api" style="font-size: 13px">api </a><a href="/tag/apple" style="font-size: 20px">apple </a><a href="/tag/arduino" style="font-size: 11px">arduino </a><a href="/tag/art" style="font-size: 13px">art </a><a href="/tag/awesome" style="font-size: 13px">awesome </a><a href="/tag/blog" style="font-size: 19px">blog </a><a href="/tag/browser" style="font-size: 20px">browser </a><a href="/tag/bugfix" style="font-size: 15px">bugfix </a><a href="/tag/canvas" style="font-size: 15px">canvas </a><a href="/tag/change" style="font-size: 15px">change </a><a href="/tag/chrome" style="font-size: 20px">chrome </a><a href="/tag/code" style="font-size: 13px">code </a><a href="/tag/color" style="font-size: 11px">color </a><a href="/tag/colors" style="font-size: 11px">colors </a><a href="/tag/css" style="font-size: 11px">css </a><a href="/tag/design" style="font-size: 20px">design </a><a href="/tag/doge" style="font-size: 11px">doge </a><a href="/tag/elitist" style="font-size: 20px">elitist </a><a href="/tag/evil" style="font-size: 19px">evil </a><a href="/tag/experiment" style="font-size: 15px">experiment </a><a href="/tag/export" style="font-size: 11px">export </a><a href="/tag/extension" style="font-size: 20px">extension </a><a href="/tag/ExtJS" style="font-size: 20px">ExtJS </a><a href="/tag/fast" style="font-size: 20px">fast </a><a href="/tag/features" style="font-size: 15px">features </a><a href="/tag/firefox" style="font-size: 20px">firefox </a><a href="/tag/flash" style="font-size: 17px">flash </a><a href="/tag/format" style="font-size: 11px">format </a><a href="/tag/function" style="font-size: 13px">function </a><a href="/tag/future" style="font-size: 15px">future </a><a href="/tag/GAE" style="font-size: 13px">GAE </a><a href="/tag/github" style="font-size: 15px">github </a><a href="/tag/google" style="font-size: 20px">google </a><a href="/tag/google code" style="font-size: 11px">google code </a><a href="/tag/google wave" style="font-size: 20px">google wave </a><a href="/tag/graphics" style="font-size: 17px">graphics </a><a href="/tag/hacking" style="font-size: 11px">hacking </a><a href="/tag/hardware" style="font-size: 11px">hardware </a><a href="/tag/hosting" style="font-size: 19px">hosting </a><a href="/tag/html5" style="font-size: 19px">html5 </a><a href="/tag/idea" style="font-size: 13px">idea </a><a href="/tag/image" style="font-size: 11px">image </a><a href="/tag/internet exploder" style="font-size: 20px">internet exploder </a><a href="/tag/ipad" style="font-size: 17px">ipad </a><a href="/tag/javascript" style="font-size: 20px">javascript </a><a href="/tag/json" style="font-size: 15px">json </a><a href="/tag/library" style="font-size: 11px">library </a><a href="/tag/light" style="font-size: 11px">light </a><a href="/tag/lines" style="font-size: 13px">lines </a><a href="/tag/linux" style="font-size: 17px">linux </a><a href="/tag/login" style="font-size: 15px">login </a><a href="/tag/magical" style="font-size: 15px">magical </a><a href="/tag/meta" style="font-size: 13px">meta </a><a href="/tag/microsoft" style="font-size: 15px">microsoft </a><a href="/tag/microwave" style="font-size: 15px">microwave </a><a href="/tag/mirror" style="font-size: 11px">mirror </a><a href="/tag/mit" style="font-size: 11px">mit </a><a href="/tag/multitouch" style="font-size: 13px">multitouch </a><a href="/tag/new" style="font-size: 19px">new </a><a href="/tag/nostalgia" style="font-size: 11px">nostalgia </a><a href="/tag/ocr" style="font-size: 13px">ocr </a><a href="/tag/offline" style="font-size: 17px">offline </a><a href="/tag/old" style="font-size: 17px">old </a><a href="/tag/onlypaths" style="font-size: 17px">onlypaths </a><a href="/tag/pi" style="font-size: 19px">pi </a><a href="/tag/progress" style="font-size: 11px">progress </a><a href="/tag/prototype" style="font-size: 13px">prototype </a><a href="/tag/python" style="font-size: 20px">python </a><a href="/tag/raphael" style="font-size: 19px">raphael </a><a href="/tag/release" style="font-size: 13px">release </a><a href="/tag/rewrite" style="font-size: 13px">rewrite </a><a href="/tag/school" style="font-size: 15px">school </a><a href="/tag/security" style="font-size: 15px">security </a><a href="/tag/shiny" style="font-size: 20px">shiny </a><a href="/tag/ShinyTouch" style="font-size: 13px">ShinyTouch </a><a href="/tag/simple" style="font-size: 11px">simple </a><a href="/tag/site" style="font-size: 13px">site </a><a href="/tag/small" style="font-size: 20px">small </a><a href="/tag/speed" style="font-size: 11px">speed </a><a href="/tag/SVG" style="font-size: 15px">SVG </a><a href="/tag/touch" style="font-size: 13px">touch </a><a href="/tag/update" style="font-size: 20px">update </a><a href="/tag/upload" style="font-size: 17px">upload </a><a href="/tag/user interface" style="font-size: 11px">user interface </a><a href="/tag/vector" style="font-size: 13px">vector </a><a href="/tag/vectoreditor" style="font-size: 19px">vectoreditor </a><a href="/tag/version" style="font-size: 13px">version </a><a href="/tag/video" style="font-size: 15px">video </a><a href="/tag/vision" style="font-size: 11px">vision </a><a href="/tag/vp8" style="font-size: 11px">vp8 </a><a href="/tag/vX JS" style="font-size: 19px">vX JS </a><a href="/tag/wave" style="font-size: 20px">wave </a><a href="/tag/webcam" style="font-size: 11px">webcam </a><a href="/tag/wikify" style="font-size: 20px">wikify </a><a href="/tag/wikipedia" style="font-size: 17px">wikipedia </a><a href="/tag/wordpress" style="font-size: 20px">wordpress </a>
          </div>
        </div>
        <div id="content">
          <article class="article intro">
            <header>
              <h2><a href="/2015/12/methods-and-functions/">Methods and Functions</a> <span class="subtitle">16 December 2015</span></h2>
            </header>
            <section class="content"><p>I watched a recording of Rob Pike’s talk <a href="http://www.thedotpost.com/2015/11/rob-pike-simplicity-is-complicated">Simplicity is Complicated</a> a few weeks ago, and I was struck by his sentiment that many popular languages seem to be converging by adding popular features from other&nbsp;languages. </p>
<p>In particular, it seems that many popular languages combine aspects of object-oriented and functional programming— support for classes, high-order functions, and reduction. Sometimes this leads to situations where the distinction between methods and functions are confusing or&nbsp;inconsistent.</p>
<p>In Javascript, you find the length of an array or string using a getter method <code>&quot;blah&quot;.length</code> but in Python[^2], it’s done through a function invocation <code>len(&quot;blah&quot;)</code>. </p>
<p>This dichotomy is more evident when operations get chained in sequence to process some stream of data. Here’s an example in <a href="https://docs.oracle.com/javase/tutorial/collections/streams/reduction.html">Java 8</a> of the object-oriented approach where methods are&nbsp;chained[^1]:</p>
<pre><code class="lang-java"><span class="hljs-keyword">double</span> average = roster.stream()
    .filter(p -&gt; p.getGender() == Person.Sex.<span class="caps">MALE</span>)
    .mapToInt(Person::getAge)
    .average()
</code></pre>
<p>An alternative way to write the code is by thinking about it as function composition— as you can do in&nbsp;Haskell: </p>
<pre><code class="lang-haskell">(sum (map sqrt (filter (&gt;<span class="hljs-number">3</span>) [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>])))
</code></pre>
<p>An interesting exercise is to pay attention how your eyes move as you scan through snippets of code to figure out what it&nbsp;does. </p>
<p>To do that, let’s abstract away the slightly different syntax for these different languages and imagine a hypothetical language where <code>x.y.z</code> is syntactic sugar for <code>z(y(x))</code>. That is, when a function name is suffixed after a <code>.</code> behind some expression, it is equivalent to wrapping the entire expression and using it as the first&nbsp;argument.</p>
<p>More concretely, <code>32.double</code> is equivalent to <code>double(32)</code>, and <code>49.divide(7)</code> is equivalent to <code>divide(49, 7)</code>. </p>
<p>For a more complex&nbsp;example:</p>
<pre><code class="lang-text">range(0, 20).map(x: sqrt(x)).filter(x: x &gt; 3).sort.sum

sum(sort(filter(map(range(0, 20), x: sqrt(x)), x: x &gt; 3)))
</code></pre>
<p>With the first code snippet, the process can be read left-to-right, and you can imagine it as the story of a little chunk of data flowing through the&nbsp;system. </p>
<p>With the second code snippet, you instead read the function from the inside-out. To a certain extent, it’s right-to-left, but you have to check the other side to make sure you aren’t forgetting any extra&nbsp;arguments. </p>
<p>Let’s try to visualize&nbsp;this:</p>
<pre><code class="lang-text">sum(sort(filter(map(range(0, 20), x: sqrt(x)), x: x &gt; 3)))
                    ------------
                ----            ------------
         -------                             ----------
    ----                                               -
---                                                      -
</code></pre>
<p>You can see here that interpreting the behavior with the functional style[^3] begins in the middle and approaches the beginning right-to-left. But when you reach some new function name, you have to zig-zag to the opposite side to visually inspect whether or not the method has any additional&nbsp;arguments. </p>
<pre><code class="lang-text">range(0, 20).map(x: sqrt(x)).filter(x: x &gt; 3).sort.sum
------------
            ----------------
                            -----------------
                                             -----
                                                  ----
</code></pre>
<p>The method chaining approach (read: <span class="caps">OOP</span> style) is nice because it fits the conceptual model of data flowing through a sequence of transformations, and it doesn’t disrupt the typical western left-to-right reading&nbsp;order. </p>
<p>To me, this seems much easier both to read and to write (for I am not so blessed as to use Paredit and must carefully tread a vast sea of syntax to manually close my parens) and I’ve always been mildly infuriated trying to learn Haskell[^4] because function composition feels much less&nbsp;natural[^5]. </p>
<p>One of the stated reasons for why Python uses <code>len</code> is that you can’t glance at the type of the expression by looking at its head. When you’re scanning through a line and you see that the outermost function is “len”, you can immediately tell that the output is a number. When length is determined in postfix, you can’t determine the final type of an expression until you look at the end of the&nbsp;expression. </p>
<p>Another problem is that this linearized sequential syntax only helps when the the structure of an expression is relatively linear. Imagine instead that you have an expression&nbsp;like</p>
<pre><code class="lang-text">sum(range(floor(sqrt(multiply(3, 4))), divide(square(5), 2)))
                     --------------           
                -----              -          ---------
          ------                    -  -------         ----
    ------                           --                    -
----                                                        -
</code></pre>
<p>In this case, both <code>multiply(3, 4)</code> and <code>square(5)</code> are of relatively similar depth which gives it the humps making it look like a <a href="http://imgur.com/NcFt9E7">snake eating an elephant</a>. </p>
<p>Flattening it with the <code>.</code> syntax then forces <code>range</code> into a little invisible spot in the middle and that makes it a lot harder to interpret the behavior of the&nbsp;program. </p>
<pre><code class="lang-text">3.multiply(4).sqrt.floor.range(5.square.divide(2)).sum
</code></pre>
<p>In fact this dot stuff is beginning to look a lot like the postfix notation in stack-based programming languages like <a href="https://en.wikipedia.org/wiki/Forth_(programming_language"><span class="caps">FORTH</span></a>) (read: similarly&nbsp;unreadable). </p>
<p>That actually leads to the nifty realization that it’s kind of like <a href="https://en.wikipedia.org/wiki/Tail_call">tail call optimization</a> for the human&nbsp;mind.</p>
<p>When reading some code composed of nested function application, you end up having to keep track of how many level within the function you are. There’s an idea in psychology that human working memory can contain up to <a href="https://en.wikipedia.org/wiki/The_Magical_Number_Seven,_Plus_or_Minus_Two">7 ± 2</a> items. So reading some deeply nested set of expressions is naturally&nbsp;difficult. </p>
<p>But if the expression tree naturally represents a sequence of actions transforming a piece of data— you can reorganize it in such a way that depth of your mental stack doesn’t keep growing and objects can be substituted in&nbsp;place. </p>
<hr>
<p>Passing objects as the first argument isn’t really all that strange. The way classes are implemented in python, methods are just functions with an implicit <code>self</code> argument. </p>
<pre><code><span style='display:none' detected-language='python'></span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dog</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">talk</span><span class="hljs-params">(self, text)</span>:</span>
        <span class="hljs-keyword">print</span> <span class="hljs-string">"woof!"</span>, text, <span class="hljs-string">"bark!"</span>

shibe = Dog()
shibe.talk(<span class="hljs-string">"wow! such speak!"</span>)
</code></pre><p>So with the code above, <code>shibe.talk(&quot;wow! such speak!&quot;)</code> is really just shorthand for <code>Dog.talk(shibe, &quot;wow! such speak!&quot;)</code>.</p>
<p>Neither is it particularly strange to access method properties through function calls. This seems to be quite typical for accessing fields of <a href="http://learnyouahaskell.com/making-our-own-types-and-typeclasses">typeclasses in Haskell</a>.</p>
<pre><code><span style='display:none' detected-language='haskell'></span><span class="hljs-typedef"><span class="hljs-keyword">data</span> <span class="hljs-type">Car</span> = <span class="hljs-type">Car</span> <span class="hljs-container">{
    <span class="hljs-title">company</span> :: <span class="hljs-type">String</span>, 
    <span class="hljs-title">model</span> :: <span class="hljs-type">String</span>, 
    <span class="hljs-title">year</span> :: <span class="hljs-type">Int</span>
}</span></span>
<span class="hljs-title">let</span> <span class="hljs-type">WusTangClan</span> = <span class="hljs-type">Car</span> {company=<span class="hljs-string">"Ford"</span>, model=<span class="hljs-string">"Wustang"</span>, year=<span class="hljs-number">1967</span>}
<span class="hljs-title">model</span>(<span class="hljs-type">WusTangClan</span>) <span class="hljs-comment">-- "Wustang"</span>
</code></pre><hr>
<p>[^3]: Note that while I’m characterizing this as the functional style, many functional languages such as <a href="http://theburningmonk.com/2011/09/fsharp-pipe-forward-and-pipe-backward/">F#</a> have a “pipe-forward” operator “|&gt;” which has a similar effect. Haskell seems to have a convention where the data is passed as the <a href="http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:map">last argument</a> rather than the first argument, which makes implementing this particular strategy a bit&nbsp;clumsy.</p>
<p>[^2]: In the Python <span class="caps">FAQ</span> <a href="http://effbot.org/pyfaq/why-does-python-use-methods-for-some-functionality-e-g-list-index-but-functions-for-other-e-g-len-list.htm">Guido</a> describes the rationale behind the “len” function as opposed to using a method on strings and lists. Interestingly more <a href="https://docs.python.org/2/faq/design.html#why-does-python-use-methods-for-some-functionality-e-g-list-index-but-functions-for-other-e-g-len-list">recent revisions</a> of the <span class="caps">FAQ</span> make it sound as if it were some mistake rendered unfixable by&nbsp;history.</p>
<p>[^1]: Something analogous to this sort of chained-method style is also used in popular frameworks like <a href="http://d3js.org">d3</a> and <a href="https://jquery.com/">jQuery</a>. </p>
<p>[^4]: Well, there’s also that incident where I tried installing some Hello World example with Cabal and ended up, through a far more infuriating series of events, rendering my Macbook&nbsp;unbootable.</p>
<p>[^5]: In similar vein, I’d like there to be a “@\” in Mathemath so that I can do <em>data</em> \@ <em>transformation 1</em> rather than the other way around with the existing <a href="https://reference.wolfram.com/language/ref/Map.html">“/@”</a>&nbsp;operator</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2015/12/recovering-deleted-data-from-leveldb/">Recovering Deleted Data from LevelDB</a> <span class="subtitle">02 December 2015</span></h2>
            </header>
            <section class="content"><p><div class="pic md right" style="width: 300px" ><img alt=""  src="/articles/2015/LevelDB%20Recovery/hex-medium.jpg" ></div></p>
<p>It was 4am this morning, and I did something stupid. I was trying to write something which would automatically delete all empty documents. Within a few seconds of running it, all my precious data was gone.&nbsp;Oops.</p>
<p>There’s probably some grander lesson to be learned about keeping routine backups and not being an idiot. But the strength of that parable is somewhat weakened because I did manage to get the data&nbsp;back. </p>
<h2 id="how-leveldb-works">How LevelDB&nbsp;Works</h2>
<p><a href="http://leveldb.org/">LevelDB</a>, developed by Sanjay Ghemawat and Jeff Dean of Google, is a fast key-value store based on a <a href="http://paperhub.s3.amazonaws.com/18e91eb4db2114a06ea614f0384f2784.pdf">log-structured merge tree</a>. </p>
<p>It’s not a relational database. It can’t do complex <span class="caps">SQL</span> queries. In fact, the only type of query that one can do is to ask for the set of entries whose keys fit lexicographically in some range. Think of it as a list of entities perpetually sorted by a key, where you can quickly read out any entry (or contiguous range) with a simple <a href="https://en.wikipedia.org/wiki/Binary_search_algorithm">binary search</a>. </p>
<p>It’s not just a metaphor— the basic primitive underlying LevelDB is literally called an SSTable (Sorted String Table). If you have a big arbitrarily large sorted list, the task of locating any single entity in a sorted list can be done in O(log n) time, which is nice because hopping around the big spinning metal hard disk platter is glacially slow in computer&nbsp;time. </p>
<!-- What's worse— inserting some new entry or deleting an old one may involve rewriting the whole file! -->

<p>In <span class="caps">RAM</span>, hopping around is pretty fast. It’s part of the name— Random Access Memory. In RAM you can maintain a balanced <a href="https://en.wikipedia.org/wiki/Binary_search_tree">binary search tree</a>, so that you can search, insert, delete, or update the contents of any entry in O(log n) time— all while keeping the contents&nbsp;sorted. </p>
<p>Computers tend to have a limited amount of <span class="caps">RAM</span> compared to hard disk space, so most databases have to somehow deal with both beasts. To a certain extent, LevelDB plays to the strengths of each while using the other to fill in&nbsp;weaknesses. </p>
<p><div class="pic md" style="" ><img alt=""  src="/articles/2015/LevelDB%20Recovery/sstable-igvita.png" ><div class="caption">Diagram taken from https://www.igvita.com/2012/02/06/sstable-and-log-structured-storage-leveldb/</div></div>  </p>
<p>To add some entry to the key-value store, LevelDB first sticks it into <span class="caps">RAM</span>— in particular some sort of data structure that keeps everything all nice and sorted. But over time, this chunk of memory may grow uncomfortably large, at which point its sorted contents get flushed into a file, and the old chunk of memory is emptied and ready for new&nbsp;data. </p>
<p>Once data is saved to the disk, the saved SSTables are essentially treated as immutable. Otherwise, if you want to keep the data sorted you might have to rewrite the entire file whenever a new entry is added, or an old one is deleted. This immutability property is really what ends up saving me, because it means that in spite of deleting everything— nothing is ever truly&nbsp;lost. </p>
<p>To look up some range of entries, LevelDB first checks <span class="caps">RAM</span> in case something matching the query has been manipulated recently. Then it checks the little immutable chunks which have already been flushed to disk, and merges them all together quickly in a manner similar to <a href="https://en.wikipedia.org/wiki/Merge_sort">merge sort</a>. </p>
<p>There’s some more to it which I haven’t covered, such as an append-only log to aid recovery in the event of some catastrophic power failure or software crash, and the process by which older SSTables get compacted together. But this essentially represents the basic design of an <span class="caps">LSM</span> database, at least enough to understand the principle of recovering deleted&nbsp;files. </p>
<h2 id="leveldb-structure">LevelDB&nbsp;Structure</h2>
<p><div class="pic md right" style="width: 200px" ><img alt=""  src="/articles/2015/LevelDB%20Recovery/files-medium.jpg" ></div></p>
<p>When you save some stuff to a LevelDB database, what you find is actually a directory consisting of a couple of <code>.log</code> files, <code>.ldb</code> files, <code>MANIFEST</code>, <code>CURRENT</code>, <code>LOG</code> and <code>LOCK</code>. As far as I’m aware the log files are temporary and kept in case the database is interrupted before it has an opportunity to write things down into a sorted table. Thus I’ll pretend that after having cleanly exited the database (following accidentally deleting lots of stuff), all the content which might possibly be interesting is within the <code>.ldb</code> files. </p>
<p>If you try to open up an <code>.ldb</code> in a hex editor, you’ll notice bits which look tantalizingly like the data you might want to recover, albeit subtly mangled by the Snappy compression&nbsp;algorithm. </p>
<h2 id="recovery">Recovery</h2>
<p>While you might imagine that being able to access previous versions of the data would be a natural and obvious affordance for a log-structured immutable append-only key-value store, I couldn’t find any APIs for accessing deleted&nbsp;data. </p>
<p>A good first step might be figuring out some way to parse those <code>.ldb</code> files. Fortunately, it’s <a href="https://leveldb.googlecode.com/svn/trunk/doc/table_format.txt">well-documented enough</a> that there are actually <a href="https://github.com/golang/leveldb/blob/master/table/table.go">third-party implementations</a>. And from the looks of it’s actually pretty&nbsp;simple.</p>
<p>That golang leveldb repo is particularly cool because it includes a helper tool <code>ldbdump</code> which reads in an <code>.ldb</code> file and dumps its contents. In fact the whole process of using it was surprisingly rather painless. I just ran <code>go get github.com/golang/leveldb</code>, navigated to the <code>cmd/ldbdump</code> directory and ran <code>go build -o ldbdump main.go</code>. I then wrote a little Python script which would call that program for all the <code>.ldb</code> files in a particular directory and parse it into a more canonical <span class="caps">JSON</span>&nbsp;form. </p>
<pre><code><span style='display:none' detected-language='processing'></span>base = <span class="hljs-string">"test-stuff copy"</span>

<span class="hljs-keyword">import</span> os
from subprocess <span class="hljs-keyword">import</span> Popen, <span class="caps">PIPE</span>
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> ast
<span class="hljs-keyword">for</span> f in os.listdir(base):
  <span class="hljs-keyword">if</span> f.endswith(<span class="hljs-string">".ldb"</span>):
    process = Popen([<span class="hljs-string">"ldbdump"</span>, os.path.<span class="hljs-built_in">join</span>(base, f)], stdout=<span class="caps">PIPE</span>)
    (output, err) = process.communicate()
    exit_code = process.wait()
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">line</span> in (output.<span class="hljs-built_in">split</span>(<span class="hljs-string">"\n"</span>)[<span class="hljs-number">1</span>:]):
      <span class="hljs-keyword">if</span> <span class="hljs-built_in">line</span>.strip() == <span class="hljs-string">""</span>: <span class="hljs-keyword">continue</span>
      parsed = ast.literal_eval(<span class="hljs-string">"{"</span> + <span class="hljs-built_in">line</span> + <span class="hljs-string">"}"</span>)
      <span class="hljs-variable">key</span> = parsed.keys()[<span class="hljs-number">0</span>]
      <span class="hljs-built_in">print</span> json.dumps({ <span class="hljs-string">"key"</span>: <span class="hljs-variable">key</span>.encode(<span class="hljs-string">'string-escape'</span>), <span class="hljs-string">"value"</span>: parsed[<span class="hljs-variable">key</span>] })
</code></pre><p>Out of this I got a <span class="caps">73MB</span> JSON file, which seemed to have all the contents in some form but unfortunately ordered by the key. This is bad because it conflates different versions of a particular key— an object may have been changed, deleted, and created&nbsp;again.  </p>
<pre><code><span style='display:none' detected-language='tex'></span><span class="hljs-special">{</span>"value": "<span class="hljs-special">{</span><span class="hljs-command">\"</span>id<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>Whole Earth Catalog<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>type<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>text<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>parent<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>__root__<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>created<span class="hljs-command">\"</span>:1447821578094,<span class="hljs-command">\"</span>list<span class="hljs-command">\"</span>:<span class="hljs-special">[</span><span class="hljs-command">\"</span><span class="caps">MI11NZ</span><span class="hljs-command">\"</span><span class="hljs-special">]</span><span class="hljs-special">}</span>", "key": "!entities/aleph!Whole Earth Catalog<span class="hljs-command">\\</span>x01RI<span class="hljs-command">\\</span>x05<span class="hljs-command">\\</span>x00<span class="hljs-command">\\</span>x00<span class="hljs-command">\\</span>x00<span class="hljs-command">\\</span>x00"<span class="hljs-special">}</span>
<span class="hljs-special">{</span>"value": "<span class="hljs-special">{</span><span class="hljs-command">\"</span>id<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>Wikia<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>type<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>text<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>parent<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>__root__<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>created<span class="hljs-command">\"</span>:1447821578094,<span class="hljs-command">\"</span>list<span class="hljs-command">\"</span>:<span class="hljs-special">[</span><span class="hljs-command">\"</span><span class="caps">XB8UAU</span><span class="hljs-command">\"</span><span class="hljs-special">]</span><span class="hljs-special">}</span>", "key": "!entities/aleph!Wikia<span class="hljs-command">\\</span>x01UI<span class="hljs-command">\\</span>x05<span class="hljs-command">\\</span>x00<span class="hljs-command">\\</span>x00<span class="hljs-command">\\</span>x00<span class="hljs-command">\\</span>x00"<span class="hljs-special">}</span>
<span class="hljs-special">{</span>"value": "<span class="hljs-special">{</span><span class="hljs-command">\"</span>id<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>Will Ferrell<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>type<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>text<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>parent<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>__root__<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>created<span class="hljs-command">\"</span>:1447841260204,<span class="hljs-command">\"</span>list<span class="hljs-command">\"</span>:<span class="hljs-special">[</span><span class="hljs-command">\"</span><span class="caps">AKVVBF</span><span class="hljs-command">\"</span><span class="hljs-special">]</span><span class="hljs-special">}</span>", "key": "!entities/aleph!Will Ferrell<span class="hljs-command">\\</span>x01=N<span class="hljs-command">\\</span>x05<span class="hljs-command">\\</span>x00<span class="hljs-command">\\</span>x00<span class="hljs-command">\\</span>x00<span class="hljs-command">\\</span>x00"<span class="hljs-special">}</span>
</code></pre><p>One curious thing I noticed was the presence of some strange binary digits after the end of each key. After a little bit of experimentation it turns out that if you convert that binary string into a number, and sort the entire database by it, sticks all the changes in the proper chronological&nbsp;order!</p>
<pre><code><span style='display:none' detected-language='processing'></span><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> ast 
<span class="hljs-keyword">import</span> binascii

things = []
<span class="hljs-keyword">for</span> <span class="hljs-built_in">line</span> in sys.stdin:
  obj = json.loads(<span class="hljs-built_in">line</span>)
  halves = obj[<span class="hljs-string">'key'</span>].<span class="hljs-built_in">split</span>(<span class="hljs-string">"\\x"</span>, <span class="hljs-number">1</span>)
  <span class="hljs-variable">key</span> = ast.literal_eval(<span class="hljs-string">"'\\x"</span> + halves[<span class="hljs-number">1</span>].replace(<span class="hljs-string">"\\\\u00"</span>, <span class="hljs-string">"\\x"</span>) + <span class="hljs-string">"'"</span>)
  <span class="hljs-keyword">if</span> len(<span class="hljs-variable">key</span>) == <span class="hljs-number">8</span>:
    time = <span class="hljs-built_in">int</span>(binascii.hexlify(<span class="hljs-variable">key</span>[<span class="hljs-number">1</span>:][::-<span class="hljs-number">1</span>]), <span class="hljs-number">16</span>)
    things.<span class="hljs-built_in">append</span>((time, halves[<span class="hljs-number">0</span>], obj[<span class="hljs-string">'value'</span>]))

<span class="hljs-keyword">for</span> x in sorted(things, <span class="hljs-variable">key</span> = lambda k: k[<span class="hljs-number">0</span>]):
  <span class="hljs-built_in">print</span> json.dumps(x)
</code></pre><p>And my precious data is now saved! Or well, rather, it always was— but now I finally have access to it in some reasonable&nbsp;form. </p>
<p>I could see the first few entries, which happened to be some particularly fecal test&nbsp;data</p>
<pre><code><span style='display:none' detected-language='json'></span>[<span class="hljs-number">1</span>, <span class="hljs-string">"!changes/wumbo/!00000001448849217216"</span>, <span class="hljs-string">"poop"</span>]
[<span class="hljs-number">2</span>, <span class="hljs-string">"!entities/wumbo/!00000001448849471307"</span>, <span class="hljs-string">"poop"</span>]
[<span class="hljs-number">3</span>, <span class="hljs-string">"!changes/wumbo/!00000001448849471308"</span>, <span class="hljs-string">"poop"</span>]
</code></pre><p>Then some data in the middle with an imported movie&nbsp;database</p>
<pre><code><span style='display:none' detected-language='json'></span>[<span class="hljs-number">2435</span>, <span class="hljs-string">"!changes/merp!000000014488557172160000001163"</span>, <span class="hljs-string">"Deja Vu"</span>]
[<span class="hljs-number">2437</span>, <span class="hljs-string">"!changes/merp!000000014488557172160000001164"</span>, <span class="hljs-string">"Gattaca"</span>]
[<span class="hljs-number">2439</span>, <span class="hljs-string">"!changes/merp!000000014488557172170000001165"</span>, <span class="hljs-string">"Sunshine"</span>]
</code></pre><p>And of course, the part of it where I accidentally deleted&nbsp;everything</p>
<pre><code><span style='display:none' detected-language='json'></span>[<span class="hljs-number">394061</span>, <span class="hljs-string">"!entities/aleph!<span class="caps">OYHEDW</span>"</span>, <span class="hljs-string">""</span>]
[<span class="hljs-number">394062</span>, <span class="hljs-string">"!entities/aleph!Gerry Sussman"</span>, <span class="hljs-string">""</span>]
[<span class="hljs-number">394063</span>, <span class="hljs-string">"!entities/aleph!<span class="caps">VSPKP8</span>"</span>, <span class="hljs-string">""</span>]
</code></pre><p>So I guess that’s it! In case you ever get stuck in a rut where you’ve unwittingly deleted the contents of your LevelDB and forgot to keep decent backups, and you’re lucky enough that the changes haven’t been compactified yet, you can possibly get your data&nbsp;back. </p>
<!-- 
There was a bit of a puzzle left, which was whether or not it was a timestamp. The first entry in the database was pretty small— just 78,128. I assumed that the epoch was set at the creation of the database, and from then kept counting. At the end of the file, that prefix number grew quite substantially to an 11 digit number.

    [78128, "!changes/wumbo/!00000001448849217216", "poop"]
    ...
    [26339520816, "!entities/aleph!@WZ1Y8ZF6F7594YEM$", "{\"type\":\"text\",\"id\":\"@WZ1Y8ZF6F7594YEM$\",\"text\":\"Scratchpad 1\",\"parent\":\"2 December 2015\",\"created\":1449050780995,\"list\":[]}"]

I had a few entries in the database that were actually tagged with timestamps, so I figured why not try to plot them against each other to see if there was a linear correspondence. 

![](plotly.png)

So it definitely didn't correspond linearly to a UNIX timestamp, but it did happen to look a lot like my own usage of the database. I had a big import at some point, and sort of slow, peaky interactions since then. I was also little curious what the spacing was. It turns out that each each one was exactly 131,072 apart from each other (which is kind of odd, because counters tend to go in increments of, well, one). A friend noticed 131,072 was 2^17, and so I . 
 -->



<pre><code><span style='display:none' detected-language='x86asm'></span><span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">57</span> <span class="caps">FB</span> <span class="hljs-number">80</span> 8B <span class="hljs-number">24</span> <span class="hljs-number">75</span> <span class="hljs-number">47</span> <span class="hljs-pseudo"><span class="caps">DB</span></span>
</code></pre>
            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2015/08/optimistically-buying-an-excessive-number-of-lg-optimus-exceed-2/">Optimistically Buying an Excessive Number of LG Optimus Exceed 2</a> <span class="subtitle">30 August 2015</span></h2>
            </header>
            <section class="content"><p><div class="pic md right" style="width: 300px" ><img alt=""  src="/articles/2015/Cheap%20Smartphone/all-medium.jpg" ></div></p>
<p>At some point I developed a habit of perusing Slickdeals. I don’t have all that much disposable income, so I’ve been able to generally avoid making particularly embarassing and regrettable purchases. But some time in late August, I just saw a deal that was too good not to blow a hundred dollars&nbsp;on. </p>
<p>Best Buy was having a sale for the <a href="http://slickdeals.net/f/8173166-lg-optimus-exceed-2-no-contract-cell-phone-verizon-wireless-prepaid-7-99?src=SiteSearchV2">prepaid <span class="caps">LG</span> Optimus Exceed 2</a> Android Smartphone. It’s prepaid which means that there’s no service contract involved, and there’s a little <a href="https://en.wikipedia.org/wiki/Konami_Code">Konami-code</a> esque incation to avoid activation (volume up, volume down, back button, home&nbsp;button). </p>
<p>The specs are pretty respectable for something that costs less than a Chipotle burrito bowl. It has a dual-core 1.2GHz processor, 4.5” 800x400 capacitive touchscreen, a <span class="caps">5MP</span> rear camera (no selfiecam, which is a tad unfortunate) with an LED flash, a microSD slot, 4GB of internal flash, 1GB of RAM, Android 4.4.2 KitKat, a 2100mAh battery, WiFi, and Bluetooth 4.0 LE + EDR. It’s carrier-locked to Verizon (it has no SIM card), so it’s better to think of it as an iPod Touch replacement, or as I do— a neat hunk of cheap&nbsp;hardware.</p>
<p>So I bought something like a dozen of them. I ended up selling a couple to friends, so it wasn’t too ridiculously excessive, but I’ve still got a stack of four or so laying around collecting dust. But I’ve been struggling to find things to do with&nbsp;them. </p>
<h2 id="spotify-connect-alarm-clock">Spotify Connect / Alarm&nbsp;Clock</h2>
<p><div class="pic md right" style="width: 200px" ><img alt=""  src="/articles/2015/Cheap%20Smartphone/spotify-medium.jpg" ></div></p>
<p>A first, relatively uncreative thought was to command-strip it to the wall next to my bed. This way I don’t have to fumble around looking for my phone to Google something at 2am. I can use the text-to-speech capabilities of Android to transcribe ideas that I&nbsp;have. </p>
<p>I’ve hooked it up to some speakers that I’ve similarly mounted on the wall (I’m really quite a fan of command strips as a means of affixing objects to surfaces), so I can use the Spotify Connect to play music from my computer on my speakers (it’s slightly cooler than using Bluetooth because I can close my computer’s lid and the music continues&nbsp;playing). </p>
<h2 id="time-lapse-photography">Time Lapse&nbsp;Photography</h2>
<p><div class="pic md right" style="width: 200px" ><img alt=""  src="/articles/2015/Cheap%20Smartphone/fisheye.JPG-medium.jpg" ></div></p>
<p>I’ve taken two of these phones and I’m using them for somewhat longer term time lapse recording projects. To a certain extent, it’s just because I have literally nothing better to do with&nbsp;it. </p>
<p>I got a couple of those cheap $2 fisheye smartphone lens attachments from Amazon. I took one and hot glued it in place on the back of the phone, and stuck it facing my&nbsp;window. </p>
<p>There’s another smartphone perched on a little bit of cardboard with a view of a little&nbsp;houseplant. </p>
<h2 id="teardown-ir-camera-microscopy">Teardown / <span class="caps">IR</span> Camera /&nbsp;Microscopy</h2>
<p><div class="pic md right" style="width: 200px" ><img alt=""  src="/articles/2015/Cheap%20Smartphone/macro.JPG-medium.jpg" ></div></p>
<p>There’s an idea that I’ve been wanting to try for quite some time relating to infrared photography. I’ve been afraid to mess with most my cameras, because most of the cameras that I have aren’t particularly disposable. These phones, on the other hand, are entirely&nbsp;disposable. </p>
<p>So I went and took apart the phone in hopes of removing the <span class="caps">IR</span> filter. Unfortunately, when trying to pry off the outer lens, I was a bit indelicate and ended up smashing the lens into little bits, to the extent that it was no longer possible to take pictures at&nbsp;all. </p>
<p><div class="pic md right" style="width: 200px" ><img alt=""  src="/articles/2015/Cheap%20Smartphone/blob-medium.jpg" ></div></p>
<p>That said, I was able to go into a dark closet and press the button on an <span class="caps">IR</span> remote and the sensor was not only able to detect see the light, but to register the increase in brightness of a scene invisibly lit by the tiny IR&nbsp;led. </p>
<p>I’ve seen other people do microscopy with cheap smartphones by ripping out the lens and putting the sample directly on top of the <span class="caps">CCD</span>. Since I’ve already accidentally ripped out the lens, I figured why not try it out by putting a blob of saliva with a Q-tip on the&nbsp;sensor. </p>
<p>I think if you run the numbers, the resolution is something in the ballpark of 5µm, so that blob is thousands of times larger than a cell. In fact it’s quite unlikely to be able to see or distinguish individual cell features with a phone camera of this&nbsp;resolution. </p>
<h2 id="connecting-to-arduino">Connecting to&nbsp;Arduino</h2>
<p>One of my main reasons for getting this cheap smartphone is that it’s just so much cheaper than an Arduino, and just so much more powerful in comparison. You get all these sensor capabilities— an accelerometer and gyroscope, touchscreen and high resolution display, bluetooth and&nbsp;WiFi. </p>
<p>The problem is that smartphones don’t have <span class="caps">GPIO</span> pins, or even any serial ports. One thing the phone does have, however is&nbsp;an </p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2015/06/eulerian-video-magnification-in-the-browser/">Eulerian Video Magnification in the Browser</a> <span class="subtitle">30 June 2015</span></h2>
            </header>
            <section class="content"><p><div class="pic md" style="" ><img alt=""  src="/articles/2015/EVM/evm.png" ></div></p>
<p>Welcome to the exciting June edition of <em>Tales From The Backlog</em>. This particular entry is from two semesters ago, when I took <a href="http://6.869.csail.mit.edu/fall14/">6.819/6.869 Advances in Computer Vision</a> taught by Professor <a href="https://billf.mit.edu/">Bill Freeman</a> and <a href="http://web.mit.edu/torralba/www/">Antonio Torralba</a>. </p>
<p>For our final project, we had to reproduce some computer vision algorithm from a list. One of them was <a href="http://people.csail.mit.edu/mrub/vidmag/">Eulerian Video Magnification</a>, that cool demo which has made its rounds on Hacker News on several&nbsp;occasions. </p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2015/06/handwriting-recognition-with-microcontrollers/">Handwriting Recognition with Microcontrollers</a> <span class="subtitle">30 June 2015</span></h2>
            </header>
            <section class="content"><p><div class="pic md" style="" ><img alt=""  src="/articles/2015/6.115/IMG_0258.jpg" ></div></p>
<p>For my final project in <a href="http://web.mit.edu/6.115/www/">6.115</a>, a microcomputer electronics class which I (and apparently nobody else) affectionately refer to as “leeblab”, I built a simple gestural input system. At its core lies an ordinary 8x8 <span class="caps">LED</span> matrix hacked into a low-res CCD and display coupled with a gutted expo dry erase marker used as a light pen. And per class requirements, it used a rube goldbergian cascade of TTL logic, an 8051, Cypress PSoC 5, an Arduino Pro Mini to process and massage the signals into USB HID compliant form, so that a computer might be able to use the contraption as a&nbsp;keyboard.</p>
<p><div class="pic md" style="" ><img alt=""  src="/articles/2015/6.115/IMG_0268.JPG" ></div></p>
<p>I had an 8x8 <span class="caps">LED</span> matrix laying around, and ‘twas the season that I had to come up with a final project for 6.115, a microcomputer electronics lab class. I vaguely recalled that an individual LED would generate a potential difference if you pummel it with enough photons. So I figured a cool and somewhat clever thing to do would be to create a display which could simultaneously act as a camera (pretty <a href="https://en.wikipedia.org/wiki/Telescreen">orweillian</a> in&nbsp;retrospect). </p>
<p><div class="pic md right" style="width: 300px" ><img alt=""  src="/articles/2015/6.115/matrix-pinout-medium.jpg" ><div class="caption">I&#39;m not totally sure about this, but I think this was the pinout of the <span class="caps">LED</span> matrix that I had. Notice that there doesn&#39;t seem to be any sensible mapping between spatial position and the corresponding pins</div></div></p>
<p>The <span class="caps">LED</span> matrix was something like <a href="https://www.adafruit.com/products/455">this one</a>. It’s wired using a technique called <a href="https://en.wikipedia.org/wiki/Charlieplexing">charlieplexing</a>, where there’s a long wire along each row that connects the anodes of the LEDs, and another long weire along each column which connects the cathodes (modulo&nbsp;dyslexia). </p>
<p>You can imagine taking a battery and a few clips and touching one point along the row wires and another point on the column wires and see a single pixel light up at the intersection of those columns and&nbsp;rows. </p>

            </section>
          </article>
          <hr>
          <div class="nav"><a href="/archive" class="newer">« Archives</a><a href="/page/2/" class="next">Next page »</a>
          </div>
        </div>
      </div>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-1367972-3', 'auto');
      ga('send', 'pageview');
      
    </script>
    <script>
      function squish(){
        document.getElementById("squishfoot").className += "squish"
      }
    </script>
    <style>
      .squish { font-size: 9px }
      .squishsquish { font-size: 8px }
      .squishsquishsquish { font-size: 7px }
      .squishsquishsquishsquish { font-size: 6px }
      .squishsquishsquishsquishsquish { font-size: 5px }
      .squishsquishsquishsquishsquishsquish { font-size: 4px }
      .squishsquishsquishsquishsquishsquishsquish { visibility: hidden }
    </style>
    <div class="graybar bottom">
      <footer>
        <div id="squishfoot">I'm a tiny footer, please don't <a href="javascript:squish()">squish</a> me</div>
      </footer>
    </div>
  </body>
</html>