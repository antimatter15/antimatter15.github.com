<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" href="http://localhost:8080/feed.xml" type="application/rss+xml" title="somewhere to talk about ideas and projects and stuff like everyone else">
    <link rel="stylesheet" href="/style/main.css">
    <title>#javascript</title>
  </head>
  <body>
    <div class="whitebox">
      <div class="graybar top">
        <header class="top">
          <div class="slogan">somewhere to talk about random ideas and projects like everyone else</div><a href="/">
            <h1 class="logo">
              stuff
               <span class="byline">by antimatter15</span>
            </h1></a>
        </header>
      </div>
      <div id="main">
        <div class="sidebar">
          <div class="about">
            <p class="emph">
              Hi. I’m <b>Kevin Kwok</b>, and I’m currently a sophomore at <b>MIT</b>, 
              and this is my obligatory online presence or whatever.  
            </p>
            <p>
              I regularly updated this site from 2007, when I started it in elementary school, 
              to summer 2014, when it was unwittingly absorbed into an international phishing ring.
            </p>
            <p>
              But like a phoenix, hydra or the national deficit, the site is back 
              again bigger than ever (after a rather long gestation period).
            </p>
            <p>
              For more obnoxious autobiographical content 
              blended with bits of nostalgia for the old PHP-on-sketchy-free-webhosting days, click here.
            </p>
          </div><br>
          <section class="archive"><a href="/archive">
              <h2>Archive</h2></a>
            <ul>
              <li>
                <ul>
                  <li><a href="/2015/04"><span class="month">April</span> <span class="year">2015</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2014/12"><span class="month">December</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/06"><span class="month">June</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/05"><span class="month">May</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/04"><span class="month">April</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/03"><span class="month">March</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/02"><span class="month">February</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/01"><span class="month">January</span> <span class="year">2014</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2013/12"><span class="month">December</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/11"><span class="month">November</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/10"><span class="month">October</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/09"><span class="month">September</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/08"><span class="month">August</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/07"><span class="month">July</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/06"><span class="month">June</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/05"><span class="month">May</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/04"><span class="month">April</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/03"><span class="month">March</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/02"><span class="month">February</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/01"><span class="month">January</span> <span class="year">2013</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2012/12"><span class="month">December</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/11"><span class="month">November</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/10"><span class="month">October</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/09"><span class="month">September</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/08"><span class="month">August</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/07"><span class="month">July</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/06"><span class="month">June</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/05"><span class="month">May</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/04"><span class="month">April</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/03"><span class="month">March</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/02"><span class="month">February</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/01"><span class="month">January</span> <span class="year">2012</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2011/12"><span class="month">December</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/11"><span class="month">November</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/10"><span class="month">October</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/09"><span class="month">September</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/08"><span class="month">August</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/07"><span class="month">July</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/06"><span class="month">June</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/05"><span class="month">May</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/04"><span class="month">April</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/03"><span class="month">March</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/02"><span class="month">February</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/01"><span class="month">January</span> <span class="year">2011</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2010/12"><span class="month">December</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/11"><span class="month">November</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/10"><span class="month">October</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/09"><span class="month">September</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/08"><span class="month">August</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/07"><span class="month">July</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/06"><span class="month">June</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/05"><span class="month">May</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/04"><span class="month">April</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/03"><span class="month">March</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/02"><span class="month">February</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/01"><span class="month">January</span> <span class="year">2010</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2009/12"><span class="month">December</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/11"><span class="month">November</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/10"><span class="month">October</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/09"><span class="month">September</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/08"><span class="month">August</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/07"><span class="month">July</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/06"><span class="month">June</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/05"><span class="month">May</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/04"><span class="month">April</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/03"><span class="month">March</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/01"><span class="month">January</span> <span class="year">2009</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2008/12"><span class="month">December</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/11"><span class="month">November</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/10"><span class="month">October</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/09"><span class="month">September</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/08"><span class="month">August</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/07"><span class="month">July</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/06"><span class="month">June</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/05"><span class="month">May</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/04"><span class="month">April</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/01"><span class="month">January</span> <span class="year">2008</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2007/12"><span class="month">December</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/11"><span class="month">November</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/10"><span class="month">October</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/09"><span class="month">September</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/08"><span class="month">August</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/05"><span class="month">May</span> <span class="year">2007</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2006/09"><span class="month">September</span> <span class="year">2006</span></a></li>
                  <li><a href="/2006/08"><span class="month">August</span> <span class="year">2006</span></a></li>
                </ul><br>
              </li>
            </ul>
          </section>
          <div class="tags">
            <h2>Tags</h2><a href="/tag/3D" style="font-size: 13px">3D </a><a href="/tag/actionscript" style="font-size: 11px">actionscript </a><a href="/tag/ajax" style="font-size: 20px">ajax </a><a href="/tag/ajax animator" style="font-size: 20px">ajax animator </a><a href="/tag/animation" style="font-size: 11px">animation </a><a href="/tag/api" style="font-size: 13px">api </a><a href="/tag/apple" style="font-size: 20px">apple </a><a href="/tag/art" style="font-size: 11px">art </a><a href="/tag/awesome" style="font-size: 13px">awesome </a><a href="/tag/blog" style="font-size: 19px">blog </a><a href="/tag/browser" style="font-size: 20px">browser </a><a href="/tag/bugfix" style="font-size: 15px">bugfix </a><a href="/tag/canvas" style="font-size: 15px">canvas </a><a href="/tag/change" style="font-size: 15px">change </a><a href="/tag/chrome" style="font-size: 20px">chrome </a><a href="/tag/chrome extension" style="font-size: 11px">chrome extension </a><a href="/tag/chrome os" style="font-size: 11px">chrome os </a><a href="/tag/chromebook" style="font-size: 11px">chromebook </a><a href="/tag/code" style="font-size: 13px">code </a><a href="/tag/color" style="font-size: 11px">color </a><a href="/tag/colors" style="font-size: 11px">colors </a><a href="/tag/css" style="font-size: 11px">css </a><a href="/tag/design" style="font-size: 19px">design </a><a href="/tag/elitist" style="font-size: 20px">elitist </a><a href="/tag/evil" style="font-size: 19px">evil </a><a href="/tag/experiment" style="font-size: 15px">experiment </a><a href="/tag/export" style="font-size: 11px">export </a><a href="/tag/extension" style="font-size: 20px">extension </a><a href="/tag/ExtJS" style="font-size: 20px">ExtJS </a><a href="/tag/facebook" style="font-size: 11px">facebook </a><a href="/tag/fast" style="font-size: 20px">fast </a><a href="/tag/features" style="font-size: 15px">features </a><a href="/tag/firefox" style="font-size: 20px">firefox </a><a href="/tag/flash" style="font-size: 17px">flash </a><a href="/tag/function" style="font-size: 13px">function </a><a href="/tag/future" style="font-size: 15px">future </a><a href="/tag/GAE" style="font-size: 13px">GAE </a><a href="/tag/github" style="font-size: 15px">github </a><a href="/tag/google" style="font-size: 20px">google </a><a href="/tag/google code" style="font-size: 11px">google code </a><a href="/tag/google wave" style="font-size: 20px">google wave </a><a href="/tag/graphics" style="font-size: 15px">graphics </a><a href="/tag/history" style="font-size: 11px">history </a><a href="/tag/hosting" style="font-size: 19px">hosting </a><a href="/tag/html5" style="font-size: 19px">html5 </a><a href="/tag/idea" style="font-size: 13px">idea </a><a href="/tag/images" style="font-size: 11px">images </a><a href="/tag/interface" style="font-size: 11px">interface </a><a href="/tag/internet exploder" style="font-size: 20px">internet exploder </a><a href="/tag/ipad" style="font-size: 17px">ipad </a><a href="/tag/javascript" style="font-size: 20px">javascript </a><a href="/tag/json" style="font-size: 15px">json </a><a href="/tag/library" style="font-size: 11px">library </a><a href="/tag/lines" style="font-size: 13px">lines </a><a href="/tag/linux" style="font-size: 17px">linux </a><a href="/tag/login" style="font-size: 15px">login </a><a href="/tag/mac" style="font-size: 11px">mac </a><a href="/tag/magical" style="font-size: 15px">magical </a><a href="/tag/math" style="font-size: 11px">math </a><a href="/tag/meta" style="font-size: 13px">meta </a><a href="/tag/microsoft" style="font-size: 13px">microsoft </a><a href="/tag/microwave" style="font-size: 15px">microwave </a><a href="/tag/mirror" style="font-size: 11px">mirror </a><a href="/tag/multitouch" style="font-size: 13px">multitouch </a><a href="/tag/new" style="font-size: 19px">new </a><a href="/tag/nostalgia" style="font-size: 11px">nostalgia </a><a href="/tag/ocr" style="font-size: 11px">ocr </a><a href="/tag/offline" style="font-size: 17px">offline </a><a href="/tag/old" style="font-size: 17px">old </a><a href="/tag/onlypaths" style="font-size: 17px">onlypaths </a><a href="/tag/pi" style="font-size: 19px">pi </a><a href="/tag/processing" style="font-size: 11px">processing </a><a href="/tag/prototype" style="font-size: 13px">prototype </a><a href="/tag/python" style="font-size: 20px">python </a><a href="/tag/raphael" style="font-size: 19px">raphael </a><a href="/tag/release" style="font-size: 13px">release </a><a href="/tag/retrospective" style="font-size: 11px">retrospective </a><a href="/tag/rewrite" style="font-size: 13px">rewrite </a><a href="/tag/security" style="font-size: 15px">security </a><a href="/tag/shiny" style="font-size: 20px">shiny </a><a href="/tag/ShinyTouch" style="font-size: 13px">ShinyTouch </a><a href="/tag/simple" style="font-size: 11px">simple </a><a href="/tag/site" style="font-size: 13px">site </a><a href="/tag/small" style="font-size: 19px">small </a><a href="/tag/speed" style="font-size: 11px">speed </a><a href="/tag/SVG" style="font-size: 15px">SVG </a><a href="/tag/text" style="font-size: 11px">text </a><a href="/tag/touch" style="font-size: 13px">touch </a><a href="/tag/update" style="font-size: 20px">update </a><a href="/tag/upload" style="font-size: 17px">upload </a><a href="/tag/user interface" style="font-size: 11px">user interface </a><a href="/tag/vector" style="font-size: 13px">vector </a><a href="/tag/vectoreditor" style="font-size: 19px">vectoreditor </a><a href="/tag/version" style="font-size: 13px">version </a><a href="/tag/video" style="font-size: 15px">video </a><a href="/tag/vX JS" style="font-size: 19px">vX JS </a><a href="/tag/wave" style="font-size: 20px">wave </a><a href="/tag/wikify" style="font-size: 20px">wikify </a><a href="/tag/wikipedia" style="font-size: 17px">wikipedia </a><a href="/tag/wordpress" style="font-size: 20px">wordpress </a>
          </div>
        </div>
        <div id="content">
          <h1>#javascript</h1>
          <article class="article intro">
            <header>
              <h2><a href="/2014/01/heapqueue-js/">HeapQueue.JS</a> <span class="subtitle">28 January 2014</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2014/HeapQueue.JS/heap.png"><div class="pic md" style="" ><img src="/articles/2014/HeapQueue.JS/heap-300x222.png" alt="heap" ></div></a></p>
<p>I have a <a href="https://github.com/antimatter15/ocrad.js">habit</a> of writing blog posts in <a href="http://www.sublimetext.com/3">Sublime Text</a> in lieu of legitimate READMEs. This <a href="https://github.com/antimatter15/heapqueue.js">project</a> was simple and short enough that I think I did manage to write something with a passable semblance to a<a href="https://github.com/antimatter15/heapqueue.js/blob/master/README.md"> functional <span class="caps">README</span></a> before initiating this quest to craft a blog&nbsp;post.</p>
<p>This is hardly a project that I’d expect to go down in the annals of my blog as particularly interesting or notable. Instead, it’s a rather boring low-level <a href="http://en.wikipedia.org/wiki/Heap_(data_structure">computer sciencey thingy</a>) who would feel perfectly comfortable amidst homework&nbsp;assignments.</p>
<p>In fact, it’s virtually assured that documenting this endeavor– the combination of writing the words which comprise this post and the documentation already written on how to use this rather simple library– will inevitably consume more of my time than actual coding (people who are more familiar with highly intricate professional software tapestries may claim that such is merely the ideal and typical experience of a&nbsp;programmer).</p>
<p>Notice that I’ve managed to spend three paragraphs (well, my paragraphs are on the order of two sentences, so it doesn’t even qualify for the fourth-grade definition for what a paragraph is) talking about the uninteresting character of the project, its relative diminutive size, and the process of writing about the subject, without actually describing what exactly the project is. This, more than perhaps any other project of mine deserves such a diversion, for it is unlikely to yield<a href="/articles/2014/HeapQueue.JS/vQvAaGW.jpg"> “much amaze”</a> or even a modest <a href="/articles/2014/HeapQueue.JS/tumblr_mtsg23ehsy1sjf3who1_500.jpg">“such wow”</a>.</p>
<p>It is a binary heap priority queue, a teensy bit shy of 50 lines, a mere kilobyte minified. It’s very loosely based off of Adam Hooper’s <a href="https://github.com/adamhooper/js-priority-queue">js-priority-queue</a> but considerably&nbsp;smaller.</p>
<p>Now that I’ve gotten the actual informative and useful part of the blog post off my shoulders, I can take you along for the unproductive plunge into the rather lame backstory for the project. I was working on a port of the <a href="http://iwi.eldoc.ub.rug.nl/FILES/root/2004/JGraphToolsTelea/2004JGraphToolsTelea.pdf">Telea</a> <a href="http://en.wikipedia.org/wiki/Inpainting">inpainting</a> algorithm and needed a <a href="http://en.wikipedia.org/wiki/Priority_queue">priority queue</a>, because the little incremental<a href="http://en.wikipedia.org/wiki/Insertion_sort"> insertion sort</a> that I hacked together in two lines was taking a few orders of magnitude longer than was&nbsp;acceptable.</p>
<p>With my considerable Google-Fu, I searched “javascript heap queue” and found <a href="https://github.com/adamhooper/js-priority-queue">js-priority-queue</a> as well as <a href="https://github.com/STRd6/priority_queue/tree/master">PriorityQueue.js</a>. They both happened to be implemented in <a href="http://coffeescript.org/">CoffeeScript</a>, which <a href="https://github.com/neotenic/protobowl">I love</a>, except not really. I like the syntax, but creating a project using it usually involves setting up some compilation pipeline in order to get it to do the things that I want it to do. Overall, it’s a bit too much of a hassle for little&nbsp;projects.</p>
<p>I couldn’t actually find the source code for PriorityQueue.js so I settled for js-priority-queue. It was a bit annoying in that it required <a href="http://requirejs.org/">require.js</a> to function and included several storage strategies that were totally useless. So I copied and pasted a few files together and stripped it of its <a href="http://requirejs.org/docs/whyamd.html"><span class="caps">AMD</span></a> dependencies and created a somewhat dieted&nbsp;version.</p>
<p>But as 9th grade World History teaches us, <a href="http://en.wikipedia.org/wiki/Appeasement">appeasement</a> never works, and this purely pragmatic minification leads inexorably to an irrational <a href="http://en.wikipedia.org/wiki/Code_golf">code golfing</a>. At that point, I was overcome by this undeniable urge to cleanse it further, perhaps blinded by <a href="http://en.wikipedia.org/wiki/Not_invented_here">not-invented-here syndrome</a> and software anorexia. Minutes later the file had been laid waste and in its place there existed its <a href="https://github.com/antimatter15/heapqueue.js/blob/master/heapqueue.js">bare skeletal remains</a>.</p>
<p>Now all I need to do is push it to <a href="https://github.com/antimatter15/heapqueue.js">github</a> and write a blog&nbsp;post…</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2013/12/ocrad-js-pure-javascript-ocr-via-emscripten/">Ocrad.js Pure Javascript OCR via Emscripten</a> <span class="subtitle">31 December 2013</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2013/OCRAD.js%20Pure%20Javascript%20OCR%20via%20Emscripten/doge.png"><div class="pic md" style="" ><img src="/articles/2013/OCRAD.js%20Pure%20Javascript%20OCR%20via%20Emscripten/doge.png" alt="doge" ></div></a></p>
<p>As with any minor stepping stone on the road to hell relentless trajectory of     <link />Atwood’s Law, I probably don’t need to justify the existence of yet another “x, but now in Javascript!”, but I might as well try. After all, we all would like to think that there’s some ulterior motive to fulfilling that&nbsp;prophesy.</p>
<p>On tablet or other touchscreen devices- of which there are quite a number of nowadays (as the New Year’s Eve post, I am obliged to include conjecture about the technological zeitgeist), a library such as Ocrad.js might be used to add handwriting input in a device and operating system agnostic manner. Oftentimes, capturing the strokes and sending them over to a server to process might entail unacceptably high latency. Maybe you’re working on an offline-capable note-taking app, or a browser extension which indexes all the doge memes that you stumble upon while prowling the dark corners of the&nbsp;internet.</p>
<p>If you’ve been following my trail of blog posts recently, you’d probably be able to tell that I’ve been scrambling to finish the program that I prototyped many months ago overnight at a Hackathon. The idea of the extension was kind of simple and also kind of magical: a browser extension that allowed users to highlight, copy, and paste text from any image as if it were plain text. Of course the implementation is a bit difficult and actually relies on the advent of a number of newfangled&nbsp;technologies.</p>
<p>If you try to search for some open source text recognition engine, the first thing that comes up is Tesseract. That isn’t a mistake, because it turns out that the competition is worlds away in terms of accuracy. It’s actually pretty sad that the state of the art hasn’t progressed substantially since the&nbsp;mid-nineties.</p>
<p>A month ago, I tried compiling Tesseract using Emscripten. Perhaps it was a bad thing to try first, but soon I learned that even if it did work out, it probably wouldn’t have been practical anyway. I had figured that all <span class="caps">OCR</span> engines had been powered by artificial neural networks, support vector machines, k-nearest-neighbors and their machine learning kin. It turns out that this is hardly the norm except in the realm of the actually-accurate, whose open source provinces live under the protection of Lord&nbsp;Tesseract.</p>
<p><span class="caps">GOCR</span> and Ocrad are essentially the only other open source OCR engines (there’s technically also Cuneiform, but the source code is in a really really big zip file from some website in Russian and its also really slow according to benchmarks). And something I didn’t realize until I had peered into the source code is that they are powered by (presumably) painstakingly written rules for each and every detectable glyph and variation. This kind of blew my&nbsp;mind.</p>
<p>Anyway, I tried to compile <span class="caps">GOCR</span> first and was immediately struck by how easy and painless it had been. I was on a roll, and decided to do Ocrad as well. It wasn’t particularly hard- sure it was slightly more involved but still hardly&nbsp;anything.</p>
<p><span class="caps">GOCR</span> and Ocrad both only operate on NetPBM files (supporting other files is done in typical unix fashion by piping the outputs from programs that convert file formats). Nobody really uses NetPBM anymore, so in order to handle a typical use case, I’d need some means of converting from raw pixel values into the format. I Googled around for Javascript implementations of PBM/PGM/PNM, finding nothing. I opened the Wikipedia page on the format and was pleased to found out why: the format is dirt&nbsp;simple.</p>
<p>If you know me in person, you’ll probably know that I’m not a terribly decisive person. Oftentimes, I’ll delay the decision until there isn’t a choice left for me to make. Anyway, serially-indecisive-me strikes again, so I alternated between the development of <span class="caps">GOCR</span>.js and Ocrad.js, leading up to a simultaneous&nbsp;release.</p>
<p>But in the back of my mind, I knew that eventually I would have to pick one for building my image highlighting project. I had been leaning toward Ocrad the whole time because it seemed to be a bit faster and more accurate when it came to&nbsp;handwriting.</p>
<p>Anyway, I spent a while building the demo page. It’s pretty simple but I wouldn’t describe it as ugly. There’s a canvas in the center which can be drawn to in arbitrary fonts pulled via the Google Font <span class="caps">API</span>. There’s a neat little thing which lets you draw things on the canvas. And to round out the experience, you can run the OCR engine on your own images, by loading the image file onto canvas to support any file the browser does (JPG, GIF, BMP, WebP, PNG, SVG) or by directly feeding the engine in its native NetPBM&nbsp;formats.</p>
<p>What consistently amazes me about Optical Character Recognition isn’t its astonishing quality or lack thereof. Rather, it’s how utterly unpredictable the results can be. Sometimes there’ll be some barely legible block of text that comes through absolutely pristine, and some other time there will be a perfectly clean input which outputs complete garbage. Maybe this is a testament to the sheer difficulty of computer vision or the incredible and under-appreciated abilities of the human visual&nbsp;cortex.</p>
<p>At one point, I was talking to someone and I distinctly remembered (I know, all the best stories start this way) a sense of surprise when the person indicated that he had heard of Tesseract, the open source <span class="caps">OCR</span> engine. I had appraised it as somewhat more obscure than it evidently was. Some time later, I confided about the incident with a friend, and he said something along the lines of “OCR is one of those fields that everyone comes across&nbsp;once”.</p>
<p>I guess I’ve kind of held onto that thought for a while now, and it certainly seems to have at least a grain of truth. Text embedded into the physical world is more or less our primary means we have for communication and expression. Technology is about building tools that augment human capacity and inevitably entails supplanting some human capability. Data input is a huge bottleneck, and while we’re kind of sidestepping the problem with things like <span class="caps">QR</span> codes by bringing the digital world into the physical. OCR is just one of those fundamental enabling technologies which ought to be as broad in scope as the set of humans who have interacted with a&nbsp;keyboard.</p>
<p>I can’t help but feel that the rather large set of people who have interacted with the problem character recognition have surveyed the available tools and reached the same conclusion as your miniature Magic 8 Ball desk ornament: “Try again later”. It doesn’t take long for one to discover an instance of perfectly crisp and legible type which results in line noise of such entropy that it’d give DUAL_EC_DRBG a run for its money. “No, there really isn’t any way for this to be the state of the art.” “Well, I guess if it is, then maybe it’ll improve in a few years- technology improves quickly,&nbsp;right?”</p>
<p>You would think that some analogue of Linus’s Law would hold true: “given enough eyeballs, all bugs are shallow”- especially if you’re dealing with literal eyeballs reading letters. But incidentally, the engine that absolutely everyone uses was developed three decades ago (It’s older than I am!), abandoned for a decade before being acquired and released to the world (by our favorite benevolent overlords,&nbsp;Google).</p>
<p>In fact, what’s absolutely stunning is the sheer universality of Tesseract. Just about everything which claims to have text recognition as a feature is backed by it. At one point, I was hoping that Mathematica had some clever routine using morphology and symbolic new kinds of sciences and evolved automata pattern recognition. Nope! Nestled deep within the gigabytes of code lies the Chuck Testa of textadermies:&nbsp;Tesseract.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2013/06/array-addition-and-other-fun-javascript-hacks/">Array Addition and Other Fun Javascript Hacks</a> <span class="subtitle">30 June 2013</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2013/Array%20Addition%20and%20Other%20Fun%20Javascript%20Hacks/untitled.png"><div class="pic md" style="" ><img src="/articles/2013/Array%20Addition%20and%20Other%20Fun%20Javascript%20Hacks/untitled.png" alt="fun hacks" ></div></a></p>
<p>It’s times like these that I’m reminded of my favorite childhood <span class="caps">TV</span> show (actually it’s kind of a close contest between this and Spongebob), Mythbusters, and that perennial warning: “don’t try this at home”. But this isn’t actually dangerous in any physically life-damaging way, it’s just dangerous in that it’s a very bad idea. The whole thing started with a friend who was irked by a few Javascript oddities, one of them being the inability for arrays or tuples of numbers to&nbsp;add.</p>
<p>I actually came across an idea some time ago while reading about <a href="http://jeremiahgrossman.blogspot.com/2006/01/advanced-web-attack-techniques-using.html">cross-site <span class="caps">JSON</span> exploits</a>. But the premise for adding arrays is rather simple: since the language only supports subtracting and adding numbers, the javascript engine will try to convert an array to a number by calling its valueOf method. There really isn’t a numeric representation of an array so valueOf usually just returns <tt>NaN</tt>, which isn’t tremendously useful. However, we can override the valueOf function to return any number we&nbsp;want.</p>
<p>We can create a <tt>valueOf</tt> function which assigns numbers to arrays according to a specific pattern, such that the resultant number can reveal (without much ambiguity) which arrays were involved, and whether they were added or subtracted. There are probably a myriad of ways to construct numbers like that, but one of the simplest (or at least the first one that I could come up with) is to raise some given radix (at least 3) to a unique number that increments every time valueOf is called. You can understand it pretty simply in base&nbsp;10.</p>
<p>Lets say our first array is <tt>[1, 2, 3]</tt>  and our second array is <tt>[5, 4, 3]</tt>. Every time the instance’s <tt>valueOf</tt> is called, we plop it onto a temporary global array and record the index. In this case, lets assign the first array index 1, and the second array index 2. If we raise the radix 10 to that index, we can get the respective unique numbers: 10 and 100.  Now these numbers can be added or subtracted, leading to 110 or 90 or -90 (or unaltered, leaving 10 and 100). To find out what operations and what numbers are involved in the operation, we can first add 1000 which is 10 raised to the size of the global array, which has the useful effect of making everything positive. Now we’re left with <tt>1110</tt>, <tt>1090</tt>, <tt>0910</tt>, <tt>1010</tt>, and <tt>1100</tt>. We can ignore the first and last digits, and each digit can be either a 1, a 0 or a 9 (if it’s anything else, this is just a number, not the result of a magical array addition). A 1 tells us the number was added, a 0 tells us the number isn’t used, and a 9 tells us that the number was&nbsp;subtracted.</p>
<p>This leaves a weird problem though, which is how you’re going to convert a number back into that array transparently. And this segues into the more atrocious segment of this hack. If and when Skynet and the other assorted malevolent (uh… I mean, <em>misunderstood</em>) artificial intelligences develop their courts, the fembots and gentledroids of the jury will no doubt consider me guilty of whatever felonious usercrimes may exist. They’ll consider me an equal of <a href="http://en.wikipedia.org/wiki/Norman_Bates">Norman Bytes</a>, butchering idiomatic javascript in the&nbsp;shower.</p>
<p>What exactly makes it such a heinous offence, you may find yourself asking. The answer is simple: the unholy matrimony of <tt>with</tt> and <tt>Object.defineProperty</tt> (also, keep in mind that it isn’t <span class="caps">DOMA</span>’s&nbsp;fault).</p>
<p>The great thing about Object.defineProperty is that it lets you get in the middle of the whole variable assignment process. The problem is that this only works with object properties, not top level variables. But Javascript has a nice (read: wretched) <tt>with</tt> statement which lets you treat variables as if they were object properties. This still leaves a slight problem because there’s no way to define a catch-all property. And if nothing so far has wrought utter terror to your soul, this last critical part may very well do exactly that. Since variables that are called must exist there in name, we can use the Function <tt>toString</tt> method to decompile the source and use a simple regular expression (any symbol which starts with A-z $ or _ followed by any of that or a number) to extract candidate variable tokens, and for each one, we can define a getter and setter on a new object which is subsequently passed as the first argument to the function whose first enclosed statement is a <tt>with</tt>.</p>
<p>The power of intercepting all function calls, variable declarations and retrievals then comes by recursively creating another fake object filled with getters and setters whenever a property is accessed. For method calls to primitive types like strings and numbers, we do the same type of sorcery but directly on their respective <tt>prototype</tt> properties. Whenever a function is passed a number which happens to match the pattern for an array addition or subtraction, we can passively intercept and substitute its value. Any string which matches a certain pattern of <span class="caps">CSS</span> selectors can be then transparently substituted with the NodeList which results from a <tt>document.querySelectorAll</tt>. And we can change all the variable declarations for a for..in loop such that array values are used instead of&nbsp;keys.</p>
<p>And now, four minutes before the end of this month, I’ve successfully yet again managed to eke out a blog post to fulfill my quota. And I guess I don’t have an Humane Society to prove that no humans were harmed in the making of this blog post, but how bad could it possibly be— it’s only <a href="https://github.com/antimatter15/mathemath.js/blob/master/test.js">150 lines</a>.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2013/03/hqx-js-pixel-art-scaling-in-the-browser/">hqx.js - pixel art scaling in the browser</a> <span class="subtitle">31 March 2013</span></h2>
            </header>
            <section class="content"><p><a href="http://antimatter15.github.com/hqx.js/"><div class="pic md" style="" ><img src="/articles/2013/hqx.js%20-%20pixel%20art%20scaling%20in%20the%20browser/Screenshot-2013-03-31-at-5.15.07-PM.png" alt="Screenshot 2013-03-31 at 5.15.07 PM" ></div></a></p>
<p>Every once in a while some gadget has the misfortune of epitomizing the next first world problem. I guess right now, this is owning a Retina (or equivalent) laptop, tablet (arguably phone, but most web pages are scaled out so it’s not that big of a problem) and being irked at the prevalence of badly scaled graphics. So there’s a new buzzword “Retina Ready” for websites, layouts and designs which support higher resolution graphics for devices which support it, often meaning of lots of <a href="http://37signals.com/svn/posts/3271-easy-retina-ready-images-using-scss">new files and new css rules</a>. It’s this trend of high-pixel-density devices (with devices like the <a href="http://www.apple.com/ipad/">iPad 3</a>, <a href="http://www.apple.com/macbook-pro/">Retina Macbook Pro</a>, <a href="http://www.google.com/nexus/10/">Nexus 10</a> and <a href="http://www.google.com/intl/en/chrome/devices/chromebook-pixel/">Chromebook Pixel</a> - though I for one don’t currently have any of them, just this old glitchy-albeit-functional first generation Chromebook) that is <a href="https://github.com/twitter/bootstrap/pull/6342">driving people</a> to vector <a href="http://fortawesome.github.com/Font-Awesome/">icon fonts</a>.</p>
<p>But the problem of radical increases in terms of resolution isn’t a new one. Old <a href="http://en.wikipedia.org/wiki/Video_game_arcade_cabinet#Parts_of_an_arcade_cabinet">arcade games</a> rarely exceeded 260x315, and the <a href="http://en.wikipedia.org/wiki/Game_Boy_Color#Specifications">Game Boy Color</a> had a paltry 160x144. While a few people still nostalgically lug around game cabinets and dig out their dust-covered childhood handheld consoles for nostalgic sneezing fits, most of the old games are now played with emulators running on systems several orders of magnitude more sophisticated in every imaginable aspect. So that arcade monitor that once could engross a childhood (and maybe early manhood) now appears nothing more than a two inch square on a twenty inch monitor. But luckily there is a surprisingly good solution to all of this in the form of algorithms designed in particular for <a href="http://en.wikipedia.org/wiki/Image_scaling#Pixel_art_scaling_algorithms">scaling pixel art</a>.</p>
<p>The most basic form of image scaling that exists is called <strong>nearest-neighbor interpolation</strong>, which is extra simple for retina devices because it means simply growing the size of each pixel by a factor of two along each axis. That leads to things which are blocky, and unless you’re part of an 8-bit retro-art project with a chiptune soundtrack looks&nbsp;ugly.</p>
<p>The most common form of image scaling borrows a lot from the math and signal processing fields, with names like <strong>bilinear, bicubic, and lanzcos</strong> essentially they treat an image as some kind of composition of sinusoidal parts and try to ideally extrapolate and interpolate such that visible artifacts are marginalized. It’s all very mathy, but the result is kind of the opposite of nearest-neighbor because it has the tendency to make things blurry and&nbsp;fuzzy.</p>
<p>The thing is that the latter tries to reach some kind of mathematical ideal, because images taken by your friendly neighborhood <span class="caps">DSLR</span>-toting amateur (spider-powers optional) are actually samples of real world points of data— so this mathematical pursuit of purity works out very well. There’s still the factor-of-four information-theoretic gap that needs to be filled in with best-guesstimates, but there isn’t really any way to improve the way a photograph is scaled without using a higher-resolution version of said photograph. But most photographs that are taken already are sixteen-megapixel monsters and they usually still look acceptable when&nbsp;upscaled.</p>
<p>The problem arises with pixel art, little icons or buttons which someone painstakingly drew in Photoshop one lazy summer afternoon in the late 90s. They’re everywhere and each pixel isn’t captured and encoded by a sampling algorithm of some analog natural phenomona— each pixel was lovingly crafted and planted by some meticulous artist. There is no underlying analog signal to interpret, it’s a direct perceptual hookup to the mind of the creator— and that’s why bicubic sampling looks especially bad&nbsp;here.</p>
<p>Video games, before 3d graphics engines and math-aware anti-aliasing concerned with murdering <a href="http://en.wikipedia.org/wiki/Jaggies">jaggies</a>, in the old civilized age of <a href="http://en.wikipedia.org/wiki/Bit_blit">bit-blitting</a>, were mostly constructed out of pixel art. Each color in that limited palette was placed there for a reason and could be exploited by specialized algorithms to construct higher-quality upscaled versions which remained sharp. These come with the names <strong><span class="caps">EPX</span>, Scale2x, AdvMAME2x, Eagle, 2×Sal, Super <strong>2×Sal,</strong></strong> <strong>hqx, </strong>and most recently, <strong>Kopf-Lischinksi</strong>. These algorithms could be applied in real time to emulator windows to acceptably scale a game to new sizes while eschewing jagged corners and blurry edges. <em>
</em></p>
<p>Anyway the cool thing is that you can probably apply these algorithms in lieu of the nearest-neighbor or bilinear scaling algorithms used by browsers on retina platforms to effortlessly upgrade old sites to shiny and smooth. With a few rough heuristics (detect if an image appears to be a sprite by testing for a limited palette, see if the image is small or a perfect square, detect if it has transparent pixels) this could be packed into a simple script include that website makers could easily inject into their pages to <strong>automagically upconvert old graphics</strong> to new shiny high-resolution ones without having to go through the actual effort of drawing new high resolution graphics and uploading them online. And this could also be packaged as a browser extension so that, once and forever after, <strong>this first-world nuisance shall be no more</strong>.</p>
<p><em>Before setting out to port <a href="https://github.com/Arcnor/hqx-java">hqx-java</a> to <a href="https://github.com/antimatter15/hqx.js">javascript</a>, I actually did some cursory googling to see if it actually had been done before. Midway through writing this post, I found out that it actually had <a href="http://phoboslab.org/log/2010/12/hqx-scaling-in-javascript">been done before</a>, in a better way, so I won’t even bother linking to my inferior version. But either way the actual goal of this project was the part which was detailed in the last paragraph, that of an embeddable script or browser extension which could heuristically apply pixel-scaling algorithms— something I probably won’t bother trying to do until at least after I get my college laptop (which I anticipate will be a Retina Macbook Pro 15”). Nonetheless, I haven’t written an actual blog post in almost three months and it’s the last day of this month, and I guess it’s better than having you all (though nobody’s probably going to read this now that Google Reader has died) assume that I’ve died. Anyway, now I’m probably going to retroactively publish old blog posts in previous months to fraud&nbsp;continuity.</em></p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2012/08/whammy-a-real-time-javascript-webm-encoder/">Whammy: A Real Time Javascript WebM Encoder</a> <span class="subtitle">19 August 2012</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2012/Whammy%20A%20Real%20Time%20Javascript%20WebM%20Encoder/screenshot.png"><div class="pic md" style="" ><img src="/articles/2012/Whammy%20A%20Real%20Time%20Javascript%20WebM%20Encoder/screenshot.png" alt="" ><div class="caption">screenshot</div></div></a></p>
<p>This is sort of a conceptual reversal (or not, this might just be making the description needlessly confusing) of one of my older projects,<a href="https://github.com/antimatter15/weppy">Weppy</a>. First, what Weppy did was it added support for WebP in browsers which didn’t support it by converting it into a single-frame video. This is instead predicated on the assumption that the browser already has support for WebP (at this point, it means it only works on Chrome since it’s the only browser which actually supports WebP), not only decoding WebP but encoding it as&nbsp;well.</p>
<p>The cool thing about WebP which was exploited in Weppy is that it’s actually based on the same codec as WebM, On2’s <span class="caps">VP8</span>. That means the actual image data, when the container formats are ignored, are virtually interchangable. With a catch: it’s intraframe&nbsp;only.</p>
<p>So it’s a video encoder in that it generates <code>.webm</code> files which should play in just about any program or device which supports the WebM format. But interframe compression is actually a fairly important thing which could reduce the file size by an order of magnitude or&nbsp;more.</p>
<p>But, there isn’t too much you can do on the client side in the ways of encoding stuff. And whatever you do, you basically can’t do interframe compression (aside from some really rudimentary delta encoding). More or less, when your only alternative is to maintain an array of DataURL encoded frames or encoding it (rather slowly) as a <a href="https://github.com/antimatter15/jsgif"><span class="caps">GIF</span></a>, a fast but inefficient WebM encoder stops looking too&nbsp;bad.</p>
<p>This was actually <a href="https://github.com/gengkev">Kevin Geng</a>‘s idea, and he contributed some code too, but in the end most of the code was just leftovers from&nbsp;Weppy.</p>
<h2 id="demo">Demo</h2>
<p><a href="http://antimatter15.github.com/whammy/clock.html">http://antimatter15.github.com/whammy/clock.html</a></p>
<h2 id="basic-usage">Basic&nbsp;Usage</h2>
<p>First, let’s include the <span class="caps">JS</span> file. It’s self contained and basically namespaced, which is pretty good I guess. And it’s not too big, minified it’s only about 4KB and gzipped, it’s under 2KB. That’s like really really&nbsp;tiny.</p>
<pre><code><span style='display:none' detected-language='handlebars'></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"whammy.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span></span>
</code></pre><p>The <span class="caps">API</span> isn’t terrible either (at least, that’s what I’d like to&nbsp;hope)</p>
<pre><code><span style='display:none' detected-language='coffeescript'></span><span class="hljs-reserved">var</span> encoder = <span class="hljs-keyword">new</span> Whammy.Video(<span class="hljs-number">15</span>); 
</code></pre><p>That <code>15</code> over there is the frame rate. There’s a way to set the individual duration of each frame manually, but you can look in the code for&nbsp;that.</p>
<pre><code><span style='display:none' detected-language='vhdl'></span>encoder.add(<span class="hljs-keyword">context</span> <span class="hljs-keyword">or</span> canvas <span class="hljs-keyword">or</span> dataURL); 
</code></pre><p>Here, you can add a frame, this happens fairly quickly because basically all it’s doing is running <code>.toDataURL()</code> on the canvas (which isn’t exactly a speed-demon either, but it’s acceptable enough most of the time) and plopping the result onto an array (no computation or anything). The actual encoding only happens when you call <code>.compile()</code></p>
<pre><code><span style='display:none' detected-language='coffeescript'></span><span class="hljs-reserved">var</span> output = encoder.compile(); 
</code></pre><p>Here, output is set to a Blob. In order to get a nice <span class="caps">URL</span> which you can use to stick in a <code>&amp;lt;video&amp;gt;</code> element, you need to send it over to<code>createObjectURL</code></p>
<pre><code><span style='display:none' detected-language='coffeescript'></span><span class="hljs-reserved">var</span> url = (<span class="hljs-built_in">window</span>.webkitURL || <span class="hljs-built_in">window</span>.<span class="caps">URL</span>).createObjectURL(output); 
</code></pre><p>And you’re done.&nbsp;Awesome.</p>
<h2 id="documentation">Documentation</h2>
<p><code>Weppy.fromImageArray(image[], fps)</code> this is a simple function that takes a list of DataURL encoded frames and returns a WebM video. Note that the images have to all be encoded with&nbsp;WebP.</p>
<p><code>new Weppy.Video(optional fps, optional quality)</code> this is the constructor for the main <span class="caps">API</span>. quality only applies if you’re sending in contexts or canvas objects and doesn’t matter if you’re sending in encoded&nbsp;stuff</p>
<p><code>.add(canvas or context or dataURL, optional duration)</code> if fps isn’t specified in the constructor, you can stick a duration (in milliseconds)&nbsp;here.</p>
<h2 id="todo">Todo</h2>
<p>This pretty much works as well as it possibly could at this point. Maybe one day it should support WebWorkers or something, but unlike the <span class="caps">GIF</span> Encoder, it doesn’t actually require much real computation. So doing that probably wouldn’t net any performance benefits, especially since it can stitch together a 120-frame animation in like 20 milliseconds&nbsp;already.</p>
<p>But one of the sad things about it is that now it uses Blobs instead of strings, which is great and all except that blobs are actually slower than strings because it still has to do the DataURL conversion from string to Blob. That’s pretty lame. Firefox supports the canvas toBlob thing, but for some reason Chrome doesn’t, but eventually it probably might, and that might be useful to&nbsp;add.</p>
<p>Also, if someone ever makes a Javascript Vorbis encoder, it would be nice to integrate that in, since this currently only does the video part, but audio’s also a pretty big&nbsp;part.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2012/08/distributed-pi-revisited/">Distributed Pi Revisited</a> <span class="subtitle">11 August 2012</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2012/Distributed%20Pi%20Revisited/Screenshot-from-2012-08-11-223733.png"><div class="pic md" style="" ><img src="/articles/2012/Distributed%20Pi%20Revisited/Screenshot-from-2012-08-11-223733-150x150.png" alt="" ><div class="caption">Screenshot from 2012-08-11 22:37:33</div></div></a></p>
<p>So I’ve been interested in distributed computing for some time, since 2007, basically around the time I started doing web development. I’ve always sort of romanticized the notion of distributed computing because of its vast theoretical potential. Projects like <a href="http://boinc.berkeley.edu/"><span class="caps">BOINC</span></a>, <a href="http://setiathome.berkeley.edu/"><span class="caps">SETI</span>@Home</a> and <a href="http://folding.stanford.edu/English/HomePage">Folding@Home</a> have always given me some kind of idealized notion of “computing for good”, inspiring some kind of useful social, scientific or otherwise beneficial change to humanity. But those projects never got the kind of adoption which could truly change the world, together they form networks which are specialized but can, in the end, only eke relatively minute&nbsp;performance.</p>
<p>Part of the problem lies in their intrinsic forbidding voluntary nature. It takes too much effort to install and amplifies the problems intrinsic to any “democratic” system: why bother? Voter apathy often stems from a feeling that an individual contribution regresses towards nothing, which is statistically certainly true, but never helpful if it plays a part in the participation of one of these collective&nbsp;entities.</p>
<p>In a broader sense, I’ve always suspected that part of what is necessary for technological progress is the loss of control. Certainly something which appears true from a human experience, that the vast arrays of neurons bound by a cranium are uninviting and wholly unwilling to expose their inner raw computation power to the emergent conscience within them. No doubt the human brain is good at computing, just not (as it appears) math, but intuition (especially of the physical kind) can only arise when a system internalizes some very complex math. We just can’t access it, because evolution or some other process has determined that it was something that had to be done away with on the climb to higher cognitive&nbsp;powers.</p>
<p>Likewise, I think computers are convergent in that sort of way. There’s a great ladder of abstraction which is growing taller and taller, a tower of babel of sorts, and at the end, perhaps we’ll find a similar goal, maybe not of god per se, but an equally sought target of consciousness or some other high level intellectual faculties contemporaneously denied to&nbsp;computers.</p>
<p>Part of this is losing control, which is inevitable and politically dangerous. Computing terminals are powerful and capable of much more than they’re being used for. In fact, most computers spend most time idling, the processors get ever faster not for the handling of the idle time but in order to smooth out the few bursts that actually require fast&nbsp;computation.</p>
<p>It’s impractical for operating systems to build into them some kind of distributed computing platform, however ideal that would be. It’s too contentious to ever get adopted, conceptually a short step away from the ability for a mega-corp to pilfer your precious information as&nbsp;well.</p>
<p>But the browser, specifically the web, provides us with an interesting opportunity. Here, we have significantly less fear of personal privacy, since it comes with an expectation of sorts for information sharing. The existence of client side scripting and its prevalence gives an implicit permission to exploit system resources during the site’s&nbsp;tenure.</p>
<p>Now, of these granted permissions, we have the freedom now to exploit in order to create something truly remarkable. Because it’s not so much voluntary on the part of the user, so much as voluntary on the part of the site maintainer who now has the responsibility of allocating and managing the system resources of his visitors, for their brief but additive virtual encounters. The users lose control, and that’s a good&nbsp;thing.</p>
<h2 id="old-stuff">Old&nbsp;Stuff</h2>
<p>When I first wrote that introduction, I mentioned that I was interested in distributed computing for <a href="http://antimatter15.com/wp/2007/10/ajax-distributed-computing/">quite a while</a>, and that’s true. 2007 was, at time of writing five years ago. A bit less than a third of my life, which is fairly significant. It doesn’t even quite belong to recent memory, and perhaps has escaped living memory into something quasi-zomboid. Part of the reason why this section is relatively short compared to the other ones is because I really don’t have a very good memory of what that was like, and it’s rather sad that my previous attempts never had long writeups regarding their potential and process (however, there do tend to be more little updates about the&nbsp;process).</p>
<p>Anyway, as it’s been such a long time, I’m trying to dig through old stuff to pick out exactly what I did back then. The first things I can find are somewhat easier and simpler problems, finding palindromes, or at least words which spell different words when reversed (I believe this was based on a program I had written a few years prior in Visual Basic). Another was for cracking hashes in a distributed&nbsp;manner.</p>
<p>Back then, I think those were one of the first explorations into the concept, of distributed computing in the browser. It was the days before WebWorkers and Cross-Origin Resource Sharing was in its infancy. The pool of possible computation was however, still large but most of it was forbidden. Take note, however that distributed and parallel computing have existed for far longer, perhaps even longer than the idea of a&nbsp;computer.</p>
<p>Computers get faster each year, thanks to <a href="http://en.wikipedia.org/wiki/Moore%27s_law">Moore’s Law</a> and more and more people get connected to the Internet each year. Perhaps in addition to <a href="http://en.wikipedia.org/wiki/Metcalfe%27s_law">Metcalfe’s law</a> with regard to the value of a telecommunication’s network, is the ability to harness idle computation power in order to increase the vale of its participants linearly as the network grows. There are almost a billion people who are connected to the Internet, and however insignificant of a contribution each of those terminals brings to the network would add up into something truly&nbsp;remarkable.</p>
<p>However, hash cracking and palindrome finding are fairly trivial. They have little real world practicality and don’t seem in any way representative of the greater problems facing humanity. While it’s a little impractical to aim for some kind of project which has immediate applications to the value of humanity, it’s certainly a worthy target which is worth approximating. They’re isolated examples which are easy to parallelize and hardly count as real ventures into the&nbsp;field.</p>
<p>Calculating digits of pi is marginally less useless and represents something which is significantly harder and tasks which may be closer to the kinds of computations which are performed in the real world. There have been other projects with similar goals, most notably, <a href="http://en.wikipedia.org/wiki/PiHex">PiHex</a>, which acts as a sort of vindication of this as a possible legitimate attempt. At this point, I have no idea if the algorithm works with digits in the order of trillions, and that’s one of the big reasons I’m not actually trying to succeed&nbsp;PiHex.</p>
<h2 id="revisting">Revisting</h2>
<p>Okay, so I decided to dig this up&nbsp;again.</p>
<p>Why? Because I really want to play around with server-side <span class="caps">JS</span> a little more (just in case getting a node vps has anything to do with merit). The sort of funny thing is that’s exactly what it used to be, back in the ancient past, before NodeJS existed (it was before Google Chrome was released, and V8 wasn’t open source). I used to have an application which would schedule jobs for computation on the client and provide them in a more useful&nbsp;format.</p>
<p>However, I never bothered saving the files outside of the <a href="http://en.wikipedia.org/wiki/AppJet">AppJet</a> web <span class="caps">IDE</span> and the code was lost when the service was discontinued. I tried porting to Google App Engine, but that version was plagued with strange bugs which ended up printing out the wrong digits after a few thousand were&nbsp;computed.</p>
<p>Right now, revisiting the idea, I’ve added a few things which are somewhat more characteristic of the change in web browsers since my first attempt. The old version tried to mock threading by the liberal application of <code>setTimeout</code>, which meant that most interface interaction wouldn’t be terribly affected. However, it did incur a noticeable slowdown. Now, it uses WebWorkers, which provides numerous interesting possibilities. First and perhaps most important is context isolation and lightweight, asynchronous embedding in multiple domains (origins). Since WebWorkers can work (see what I did there?) across multiple origins and still have access to <code>XMLHttpRequest</code>, and the advent of Cross-Origin Resource Sharing (<span class="caps">CORS</span>), it’s easy to embed this in a page. The low embedding overhead and the true multi-threading abilities bring a lot in the way of making this more than an intriguing concept and into something much more&nbsp;practical.</p>
<p>The code, which is now on the <a href="https://github.com/antimatter15/distributed-pi">Github repository</a> in a new folder named <code>node</code> has a very basic interface. Rather than manipulating the widths of divs for progress indicators, now it uses <code>&amp;lt;progress&amp;gt;</code> (it’s actually really cool to see how far the state of web platform’s state of affairs has changed over the past few years). One cool thing about the progress bar is that it guesses progress by dividing the current prime number by the end point, which has an interesting effect of making the progress bar faster towards the end (this happens because the <a href="http://en.wikipedia.org/wiki/Prime_number_theorem#History_of_the_asymptotic_law_of_distribution_of_prime_numbers_and_its_proof">distribution of prime numbers asymptotically declines</a>). While I could possibly invert the effect in order to create a more linear progression fairly trivially, behavioral studies indicate that people who stare at progress bars all day feel less irritated (i.e. more satisfied) when the bar speeds up in the beginning and end (then again, the progress indicator isn’t really meant to be shown to people and if it is, the user experience is hardly something which is being optimized for, and this does nothing in the way of speeding up the beginning, in fact it’s quite the opposite by slowing down the beginning, so perhaps it should first linearize the progress and then map it to some function which as accelerated starts and ends, perhaps some trigonometric&nbsp;function).</p>
<p>Part of what is cool about the project is the underlying algorithm, a port of <a href="http://en.wikipedia.org/wiki/Bellard%27s_formula">Fabrice Bellard’s</a> optimized version of the <a href="http://en.wikipedia.org/wiki/Bailey%E2%80%93Borwein%E2%80%93Plouffe_formula">Bailey–Borwein–Plouffe algorithm</a>. Unique to the algorithm is that it uses up comparably little memory and as such it’s uniquely suited to distributed computing, especially in the browser environment which demands relatively thin clients (however, browser caching means that the download would only necessarily need to be completed once, and embedding the computation in an <code>iframe</code> with certain storage permissions and appCache could allow persistence). It’s a relatively short algorithm and fairly easy to&nbsp;port.</p>
<p>However, as it’s a digit extraction algorithm, it’s not very efficient for calculating digits sequentially. That actually is something of a feature which I neglected in the so-called modern incarnation. Older versions had the prime number (sub-job) allocation done on the server, which meant using up a lot of memory in keeping track of the jobs. The current one has a server which is entirely unaware of the actual computational process, which leads to being lighter persistence-wise but comes at the obvious cost of losing granularity in&nbsp;scheduling.</p>
<p>One optimization about this strategy is that a client doesn’t have to wait for a server to respond with another job request in order to continue. Instead, it operates in an almost completely asynchronous manner. On the client’s first request, the server gives it a job which is given by a starting point (a prime number to continue from) and a digit number. From that point, the client begins computing until that digit is complete, sending its progress back to the server once in every specified interval (a couple of&nbsp;seconds).</p>
<p>If the client was to disconnect in the middle of a computation (which can take quite some time, especially in later digits, so its more than certain to happen), the server will be able to resume the calculation by sending the request to another client after a certain expiration date has passed. So future refinements to the server (and possibly the client) could make it more efficient with processing digits of less significance by allocating jobs and taking into account certain checkpoints. For instance, all the prime numbers between 3 and some integer N have to be iterated through (where N is approximately 3 times the number of digits from the radix). Rather than maintaining a “single-threaded” system (as it currently does, the parallel processing power comes from sending out multiple digit segments to be processed), it could instead send out simultaneous requests for different segments. The client may have to be modified in order to stop at certain designated checkpoints to prevent clients from&nbsp;overlapping.</p>
<p>This sort of scheme would be more efficient than storing jobs used in previous versions, first of all by retaining the sort of “dumb” server which doesn’t do any real computation that contributes to the process. Instead it only acts as a mediator and persistence layer (as perhaps is the best role to give to any server). Rather than keeping track of every single prime number as a different row in some database, the server would only need to keep track of as many sections as clients&nbsp;exist.</p>
<p>The new version also has some interesting changes. First is the switch to <a href="http://nodejs.org/">NodeJS</a>, which was hinted at before, since it acts as a persistent server rather than something which is called and disposed like a <span class="caps">CGI</span> process, the queuing system is now entirely in-memory. However, as soon as its possible, it writes out the completed digits into a file (<code>pi.txt</code>), and if the server is ever interrupted the computations resume from the last saved version of the digits (only the jobs which were processing during the shutdown are lost). However, this would need to be changed if it were to be some more ideal use of the digit extraction method, since in such a situation, the vast majority of jobs would be for a single span of digits (and it would really suck to lose all of&nbsp;those).</p>
<p>So in a sense, this update constitutes a regression, a step in the wrong direction in that it’s using the algorithm wrong. However, in another sense, it paves the way to a set up which has a few more ideal properties, a lighter weight server end and a more efficient use of computation time on the part of the clients. In essence, the shift from fixed sized discrete computational tasks (or jobs) to mere ranges. The obvious benefit to the latter is the reduced memory demand and the ability to operate continuously, i.e. without pausing for acquiring tasks and behaving truly asynchronously (in a very Node.<span class="caps">JS</span> style). Perhaps taking it further along this direction (since WebWorkers are allowed to access applicationCache), clients could be given a starting point and are just let to rip through a few hundred cycles, synchronizing less frequently. Some specialized data structures might be employed to keep track of individual contributions so that the ranges are doled out optimally. Maybe this should instead evolve into some kind of successor to the PiHex project rather than some incredibly slow and inefficient sequential pi calculation&nbsp;platform.</p>
<p>One thing which I didn’t explore was the concept of having a persistent socket to the server. For this set of circumstances, the benefits of maintaining a persistent bidirectional socket weren’t large enough to warrant that kind of development. Right now, it’s communicating through a few small <span class="caps">GET</span> requests to a server. Part of the reason GET was used rather than POST was that it was designed with the idea that it could theoretically run in a cross-domain manner, and sending a POST request requires preflighting with CORS headers. Since it’s only ever really sending 30 or so bytes at a time, any additional overhead should be avoided. But this itself is also perhaps an argument for using WebSockets (though certainly not long-polling, since that incurs even more overhead). Quite often the synchronization requests don’t require the server to give anything back, but HTTP-wise, the server’s always going to have to send about a hundred bytes of headers to fulfill the HTTP requirements. Also, whenever the server sends a request, it wastes about a third of a kilobyte with header information like the User-Agent. Network-wise it might in the end be more efficient just to have a low-overhead persistent socket&nbsp;connection.</p>
<p>Having a persistent socket would make synchronization interesting as well. While the changes wouldn’t be terribly drastic since there’s still the goal of minimizing transmission overhead, a few changes to the scheduling could be conveyed without necessarily waiting to the next checkpoint. And of course, there’s the trade-off which comes with the question of how long the checkpoints should be spaced. Right now, it’s something fairly low in the range of 10 seconds since the duration of a single page visit usually isn’t much more than a few seconds. However, if a client-side persistence layer is added, the checkpoints could be spaced out much wider. Perhaps instead of every few seconds, one could be made for every minute, hour, day or even week. Where a single computational task allocation could span multiple domains, multiple days and while the user is online and offline. However, having wider-spaced checkpoints does incur a cost in terms of synchronization. It reduces the operator’s sense of intimate awareness of what’s actually happening and increases the chance of&nbsp;overlaps.</p>
<p>Another possible step is some kind of framework which handles all of these problems automatically. Instead of having to manually manage variables and the synchronization of tasks between clients and servers, one could construct a domain specific language for distributed computing (a superset or subset of javascript which automatically manages the state of variables in loops and such to compile into some kind of client for generic parallelized algorithms). Maybe it’ll do something cool and look at which loop is the optimal one to split up based on the amount of data which needs to be sent across so that it could be&nbsp;minimized.</p>
<p>One of the things I played with while revisiting this project was playing with <span class="caps">LLJS</span>, another kind of specialized language which builds upon Javascript. As it’s marketed, the “bastard child of Javascript and C”, which manually manages memory. I was hoping that using a typed language might bring some speed improvements (not really, in this situation). However, LLJS might be a good basis for this auto-magical compiler for synchronous routines into largely parallelized code. However, maybe there are in fact limits to parallel computing, and it’s better to search for specific algorithms which have the right properties. And maybe in the end, the problem of porting it to Javascript and managing the client-server communication fades into a relative&nbsp;triviality.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2012/06/pinball/">Pinball</a> <span class="subtitle">19 June 2012</span></h2>
            </header>
            <section class="content"><p><a href="http://antimatter15.github.com/pinball/prototype.html"><div class="pic md" style="" ><img src="/articles/2012/Pinball/Screenshot-from-2012-06-19-152428-300x291.png" alt="" ><div class="caption">Screenshot from 2012-06-19 15:24:28</div></div></a></p>
<p>Last year, for Computer Science 1, I built a pinball game in Java. Yes, Java, as in sans-script. I wrote it in Eclipse and it was pretty functional. Of course, the biggest part of the game was the collision detection, collision detection which, mind you, I built with only the slightest knowledge of how it’s actually done. So yeah, I made up a scheme. It sucks, but at least it sort of works. I was actually fairly proud of it since it was basically the only thing which was mildly interesting and non teacher directed (that is, it took more than one hundred ninety two seconds to write after the teacher gave a cue to attempt the task). I thought it was so cool in fact, that I decided to port it over to both Javascript and Coffeescript, the latter being a language which was uber-hip and awesome (I believe these events transpired approximately at the time of Coffeescript’s big one-oh&nbsp;release).</p>
<p>In essence, the collision detection scheme I devised was pretty simple. The ball experienced gravity in the form of a constant downward acceleration. It would move up and down. That was maintained by a variable (actually an array to mimic a vector), named position, and another one named velocity, where the y-coordinate for the latter was incremented by some term every time a frame was rendered. The collision detection system deals with the intersection between lines. First it takes the current position of the ball, and envisions that the current velocity is a line extending infinitely in that direction. All the other attributes of the environment are also lines, and the algorithm treats them all as unbounded (rather than segments). It quite trivially computes the intersection between the lines and calculates (with euclidean distance) how far that intersection is from the ball’s current point. If it detects a collision (the distance is less than the specified radius of the ball), then the ball’s direction is altered based on its current position and the tangent of the line it intersected&nbsp;with.</p>
<p>Fast forward a few months, and it’s July of 2011. Since then, I’ve basically forgotten about the pinball game, because it really isn’t cool enough to be worth revisiting. But I was in Virginia’s Summer Residential Governor’s School for Science/Math/Technology (hardly wholly unexpected). It was some dark night and I was in the back row of a white shuttle bus en route to an observatory where artificial light is verboten. Well, it started raining and the trip was cancelled and we were going back and I was bored. So I pulled out my iPad, which I had for some reason, and decided to look at what I had on my Dropbox which I could play around with offline. Lo and behold, there’s a pretty crappy Javascript pinball implementation (which notably, never having been finished is just a ball bouncing between a few lines). I changed the parameters and made weird shapes the ball hopelessly bouncing around in awkward trajectories, and I thought it was&nbsp;cool.</p>
<p>A friend, sitting next to me noticed that the balls were speeding up. He inquired whether or not I was using the euler method, and I didn’t know what that was. Either way, inadvertently, I was in fact using that. But the point was that here he was, making a fuss about the fact that my simulation in two dimensions blatantly ignores the conservation of momentum. And as such, I was compelled to finding a solution. I studied the code for a bit longer, trying to expose the nasty snippet which might have made it evade the laws of physics, albeit to no avail. In the midst of my struggle, he noticed at some point that since the trajectory paths are simple parabolas, it should be possible to find a closed form solution to the collision problem (rather than my iterative approach. In the end, I nobly gave up on my epic quest to fix the universe, and worked on some other&nbsp;crap.</p>
<p>A week ago, I finished my first formal (that is, in school) calculus class, where I learned what euler’s method was and how I inadvertently implemented it. But I still had to take the class final, which the teacher rather kindly decided to make extremely easy. And since I also had a huge math portfolio (which I decided to typeset with LaTeX, as I have for nearly every paper this year, for no real reason whatsoever) due that day, he made it take home, with the only caveat that we aren’t to collaborate on the final in his presence (eg. after school in his room), a subtle nod of assent to all other forms of aid. Well, at home, I thought that I should probably make use of all the tools I have at my disposal. I thought of that copy of Mathematica which hopefully wasn’t collecting dust on my hard drive platter because that might lead to a head crash, but alas was figuratively gathering&nbsp;dust.</p>
<p>I decided to start playing around with the awesomeness that is a computer algebra system, named after a guy whose last name is that otherwise inexplicable W on the periodic table (purely coincidental, unless Stephen Wolfram is actually a british iron manganese tungstate mineral). In what felt to be no time (at least it seemed interesting and productive enough that I in no way thought to discern the real time which elapsed), I had completed my final exam in a somewhat minimalistically formatted Mathematica notebook. I had, figuratively, fallen in&nbsp;love.</p>
<p>Soon afterwards, as I was working on some other completely unrelated project (creating a intraframe-only WebM encoder), I needed something somewhat cool to generate a series of frames to be encoded into video. Digging through my (newly reorganized) Dropbox project folder, I found that old incomplete pinball game. And I remembered that story and that brief suggestion and decided to use my newfound Mathematica prowess (that is, my ability to use Solve[] with some degree of it not puking) to find that solution to the collision between a parabola and a line. To my dismay, Mathematica returned an ungodly mess of an equation. And it also didn’t work for vertical&nbsp;lines.</p>
<p>But eventually, I did manage to get it to work. And thankfully now it obeys the laws of physics, at least to about 10x10^-13. And I also realized that that demo isn’t actually that cool but I used the older version anyway for my video encoder demo. So that’s the happy ending, everything lived happily ever after despite the fact the algorithm is still totally buggy and breaks when things are either too fast (velocity &gt; 4000px/second) or too slow (velocity &lt; 1px/second). And with corners, it occasionally fails. But I’m long since past the threshold of caring. At least now, you can speed it up a lot because the path prediction and the collision detection are completely separate from the render cycle (which also lets the speed become independent of processor speed). It uses requestAnimationFrame and other stuff, and if you want to try it, <a href="http://antimatter15.github.com/pinball/prototype.html">here</a>.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2011/12/offline-wiki-redux/">Offline Wiki Redux</a> <span class="subtitle">30 December 2011</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2011/Offline%20Wiki%20Redux/Screenshot.png"><div class="pic md" style="" ><img src="/articles/2011/Offline%20Wiki%20Redux/Screenshot.png" alt="" ><div class="caption">Screenshot</div></div></a></p>
<p>There’s just something incredibly alluring about the concept of holding the sum of human knowledge with you at all times. While near-ubiquitous connectivity alleviates this to a certain extent, the momentary lapses of networking are incredibly corrosive to an information dependent mentality. Wikipedia never ceases to amaze me and, while I’ve tried in the past to encapsulate part of its sheer <a href="https://chrome.google.com/webstore/detail/kchecgcglnoohbdghckmcbefllnibadd?hl=en">awesomeness</a>, this marks a much more significant&nbsp;attempt.</p>
<p>The differences start even before the data gets to the application. The preprocessing toolchain was entirely rewritten for a multitude of reasons. First of all, it compresses not the entireity, but rather the most popular subset of the English Wikipedia. Two dumps are distributed at time of writing, the top 1000 articles and the top 300,000 requiring approximately <span class="caps">10MB</span> and 1GB, respectively. While ostensibly, the mere top 300k articles is far too narrow to delve deep into the long tail, the breadth of the meager 1/25th of articles consistently surprises me in its depth. The advantage is that at 1GB, it’s relatively easy to fit into any system. The algorithm which strips extraneous content has been made far more sophisticated than the original series of regular expressions. This enables greater compression and less accidentally omitted&nbsp;content.</p>
<p>On the application end, the application has switched from a <a href="https://github.com/nmrugg/LZMA-JS"><span class="caps">GWT</span>-compiled</a> <span class="caps">LZMA</span> SDK to a speedy, <a href="https://github.com/glinscott/lzmajs">pure javascript decoder</a>. This makes page loads significantly speedier and allows greater compression ratios, for individual blocks can be made larger (<span class="caps">256KB</span> instead of 100KB). It also now uses WebGL Typed Arrays to further speed things up, such as sending data to and from the WebWorker&nbsp;thread.</p>
<p>The interface was redesigned with <span class="caps">CSS</span> media queries to dynamically transition between different modes in response to different viewing environments. The interface consists of two regions: the fixed position recessed left panel which holds the page title, a search bar, controls and the page outline. This collapses down to a toolbar header automatically when the screen estate is limited. It uses an Apple-esque noise texture&nbsp;background.</p>
<p>Downloads happen in little units called chunks (they’re half a megabyte for the dump file and about four kilobytes for the index). The local file can be built up out of order. While online, all storage operations check the virtual file, indexed db, or web sql database. If it’s not there, it transparently uses an XMLHttpRequest in order to fulfill the request and caches it to disk in the respective persistence mechanism. A bitset is used to keep track of which chunks are already downloaded and which need to be&nbsp;downloaded.</p>
<p><a href="http://offline-wiki.googlecode.com/git/app.html">http://offline-wiki.googlecode.com/git/app.html</a></p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/11/simple-anti-phishing-mechanism/">Simple Anti Phishing Mechanism</a> <span class="subtitle">12 November 2010</span></h2>
            </header>
            <section class="content"><p><a href="http://antimatter15.com/misc/identicon/login.php"><div class="pic md" style="" ><img src="/articles/2010/Simple%20Anti%20Phishing%20Mechanism/Screenshot-11.png" alt="" ><div class="caption">Screenshot-11</div></div></a></p>
<p>I just prototyped the anti phishing system described on <a href="/2010/11/simple-anti-phishing-mechanism/2010/11/insanely-simple-anti-phishing-system/">the earlier post</a>. <a href="http://hackvertor.co.uk/public">Gareth Hayes</a> noted that the the page could have been wrapped in an &lt;iframe&gt; to reuse the identicon. This implementation only shows the identicon if both javascript is present and functional and <tt>top==window</tt>. Hopefully there aren’t many other huge flaws with it. So it would be awesome if you tried it&nbsp;out.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/10/weppy-updates-opera-chrome-and-firefox-support-and-simpler-usage/">Weppy Updates Opera, Chrome and Firefox support and simpler usage</a> <span class="subtitle">09 October 2010</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2010/Weppy%20Updates%20Opera,%20Chrome%20and%20Firefox%20support%20and%20simpler%20usage/Screenshot-19.png"><div class="pic md" style="" ><img src="/articles/2010/Weppy%20Updates%20Opera,%20Chrome%20and%20Firefox%20support%20and%20simpler%20usage/Screenshot-19.png" alt="" ><div class="caption">Screenshot-19</div></div></a></p>
<p>With help from <a href="http://twitter.com/Frenzie">@Frenzie</a> and <a href="http://twitter.com/#!/paul_irish/status/26829179917">@paul_irish</a>, the latest not-yet-versioned release of Weppy, my Javascript WebP to WebM conversion library, or something of a <a href="http://remysharp.com/2010/10/08/what-is-a-polyfill/">polyfill</a> for a format that is yet to be part of any specification (<a href="http://dev.w3.org/html5/spec/Overview.html#attr-img-src"><span class="caps">HTML5</span> seems to specifically reference</a> the image src attribute are examples such as <span class="caps">PNG</span>, GIF, JPEG, APNG, PDF, XML, SVG, SMIL, and MNG). The new release brings some awesome new features that really don’t change much and shouldn’t really be used in the real world because most browsers in the world still aren’t Firefox, Chrome or Opera - that is, a large portion of the browser market includes browsers like Safari and IE, either suffering from antiquity (IE6! aah!) or just liking h264 (IE9 +&nbsp;Safari).</p>
<p>The new release supports Opera. I never bothered debugging Opera, I figured it was another huge issue that would demand a rewrite (as supporting Firefox had needed, because the order of the object keys isn’t preserved and breaks the <span class="caps">EBML</span> result, or at least for Firefox’s parser which seems to be somewhat stricter than Chrome’s, is that ffmpeg?). And after premature optimization (stripping “unnecessary” EBML tags), my code didn’t work in chrome, so I had to revert to an earlier revision. All my testing code was based on file drag-drop stuff, and Opera doesn’t support that. Until I saw this <a href="http://forums.mozillazine.org/viewtopic.php?p=9991409#p9991409">mozillazine topic</a>, I didn’t care, but it was a lot easier to fix than I&nbsp;feared.</p>
<p>Part of the solution was getting rid of the canvas stage. Admittedly, the canvas stage was pretty useless once the toDataURL() stage was removed before the first public release, but I didn’t feel like deleting code, so it stayed there. Also, I noticed that the global variable that gets introduced was accidentally named “WebM”, which is wrong, it should be “WebP”, but because of the uncreative format naming and similarities, I didn’t notice. Not sure, but it seems to be more stable&nbsp;now.</p>
<p>Chrome probably will add WebP soon, and it needs to be future proof, detecting whether or not a browser supports the WebP format. To do that, it creates an Image, sets the src to a data url of a 4x4 webp image and listens to the onload and onerror events, checking if the size is correct and there were no errors loading it. The routine is expected to error and totally untested as there aren’t any browsers that support the feature yet for me to&nbsp;try.</p>
<p>Another change, is that by default, it will automatically load all the same-origin (because of the limitations of <span class="caps">XHR</span>) webp images (from &lt;img&gt; tags), on the DOMContentLoaded event, so the library is practically drop-in now. In any web page, you can pretty much add &lt;script src=”<a href="http://antimatter15.github.com/weppy/weppy.js">http://antimatter15.github.com/weppy/weppy.js</a>“&gt;&lt;/script&gt; and on the supported browsers, it should automatically load and replace all WebP images, though not something I would really&nbsp;recommended.</p>
<p>The demo is the same place it always was: <a href="http://antimatter15.github.com/weppy/demo.html">http://antimatter15.github.com/weppy/demo.html</a></p>
<p>There is also this nifty hack that uses &lt;canvas&gt; to add an alpha channel to the WebP image (adapted from the <a href="http://blog.jackadam.net/2010/alpha-jpegs/">original <span class="caps">JPEG</span></a> one): <a href="http://antimatter15.github.com/weppy/alpha/alpha.html">http://antimatter15.github.com/weppy/alpha/alpha.html</a></p>
<p>Also, please follow me<a href="http://twitter.com/antimatter15"> on twitter</a>.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/09/3d-sculpting-tool/">3D Sculpting Tool</a> <span class="subtitle">08 September 2010</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2010/3D%20Sculpting%20Tool/Death-Star-2.png"><div class="pic md" style="" ><img src="/articles/2010/3D%20Sculpting%20Tool/Death-Star-2.png" alt="" ><div class="caption">Death Star 2</div></div></a></p>
<p><a href="/articles/2010/3D%20Sculpting%20Tool/Alderaan.png"><div class="pic md" style="" ><img src="/articles/2010/3D%20Sculpting%20Tool/Alderaan.png" alt="" ><div class="caption">Alderaan</div></div></a></p>
<p>So for the  past few days, I discovered this neat app called <a href="http://www.sculptris.com/">Sculptris</a>. It’s this amazing <a href="http://en.wikipedia.org/wiki/Digital_sculpting">digital sculpting</a> app where your canvas is basically a blob of virtual clay that can be molded into any shape with any level of detail. It’s windows-only, and I thought it would be neat to have something like it that works in the browser. First I thought of using WebGL, but trying to start chromium with webgl always ends up with a GLXFBConfig error, and on Firefox, it’s stuck with using libosmesa which gives absolutely terrible framerates (<span class="caps">IDK</span> why but Fx4 <em>crawls</em> on my computer. Panorama is so slow it lags from simple dragging). Eventually, I ended up basing it off my js1k function plotter, because it’s a fairly simple 3d&nbsp;renderer.</p>
<p>The pictures on the top of the page are of <a href="http://en.wikipedia.org/wiki/Death_Star">the death star</a> and <a href="http://en.wikipedia.org/wiki/Alderaan">alderaan</a>, respectively, mostly because planets (and moons that aren’t moons) are mostly spherical and explosions and light rays are pretty much the only things that this app is suitable for at these&nbsp;stages.</p>
<p>So how does it work? It’s actually really simple, and probably too simple. At ~300 <span class="caps">LOC</span>  of pretty trivial JS, it’s not much at all (though it is hideous, I must warn you). It is based on my js1k entry, and I considered making this a 1k submission, but I gave up and said I couldn’t. It starts off simple enough, do lots of freaky trigonometric loops to generate a set of points that lie on a sphere. Then loop through every 50 milliseconds, apply a 3d transformation, get points that lie within a radius of the mouse position and reference them in the selected array. Then you segregate the selected array into the foreground and background, find the arithmetic mean of the fg and bg, respectively and find the difference. Then I convert it to spherical coordinates and get rid of the ratio to ignore the magnitude of the vector and add it to the position of foreground points. Then loop through all the points and wherever there’s a long distance, insert a new dot at the&nbsp;midpoint.</p>
<p>For no apparent reason I decided not to put many words on it. I was actually reluctant to add “points” and “undo”, but it’s fine print in faded color that doesn’t help the user at&nbsp;all.</p>
<ul>
<li>Middle Click + Drag to rotate (in&nbsp;3d)</li>
<li>Right Drag to deflate the&nbsp;shape</li>
<li>Left Drag to inflate the&nbsp;shape</li>
<li>Middle Scroll to zoom&nbsp;in/out</li>
<li>The slider bar is for controlling the size of the&nbsp;selection.</li>
<li>The checkbox enables/disables Undo/Redo (via CtrlZ/CtrlY or CtrlZ/Ctrl+Shift+Z).
App: <a href="http://antimatter15.github.com/3d-sculpt/3d.html">http://antimatter15.github.com/3d-sculpt/3d.html</a></li>
</ul>
<p>Mirrored Version: <a href="http://antimatter15.github.com/3d-sculpt/mirror.html">http://antimatter15.github.com/3d-sculpt/mirror.html</a></p>
<p>(Not as in the other meaning for mirror, but it actually reflects the X axis so that it’s symmetrical, which is a neat feature in&nbsp;sculptris)</p>
<p>Github: <a href="http://github.com/antimatter15/3d-sculpt">http://github.com/antimatter15/3d-sculpt</a></p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/08/bittorrent-in-javascript-with-node/">BitTorrent in JavaScript with Node</a> <span class="subtitle">29 August 2010</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2010/BitTorrent%20in%20JavaScript%20with%20Node/Screenshot-41.png"><div class="pic md" style="" ><img src="/articles/2010/BitTorrent%20in%20JavaScript%20with%20Node/Screenshot-41.png" alt="" ><div class="caption">Screenshot-4</div></div></a></p>
<p>A few months ago<a href="http://github.com/antimatter15/jstorrent"> I tried to make a bittorrent client in javascript</a>. But a few days after it started, I found out that there were already other projects with the same goal. The most complete of them was summerTorrent. However, though (I thought) it was so insanely close, it wasn’t finished. So anyway, I made a few changes that at least made basic torrenting functionality&nbsp;working.</p>
<p><a href="http://github.com/antimatter15/summerTorrent">summerTorrent</a></p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/08/1k-js-3d-function-plotter/">1k JS 3d Function Plotter</a> <span class="subtitle">06 August 2010</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2010/1k%20JS%203d%20Function%20Plotter/Screenshot-JS1k-1k-demo-submission-62-Chromium-1.png"><div class="pic md" style="" ><img src="/articles/2010/1k%20JS%203d%20Function%20Plotter/Screenshot-JS1k-1k-demo-submission-62-Chromium-1.png" alt="" ><div class="caption">Screenshot-JS1k, 1k demo submission [62] - Chromium-1</div></div></a></p>
<p>Interestingly, it does seem that a lot of the<a href="http://js1k.com/demos"> demos for the js1k</a> competition are a whole lot more impressive than the <a href="http://10k.aneventapart.com/">10k competition</a>. Despite that js1k started with no prizes and 10k has a collective $10,000 worth of prizes. <a href="http://js1k.com/demo/4">Though</a> <a href="http://js1k.com/demo/19">I</a> <a href="http://js1k.com/demo/47">do</a> <a href="http://js1k.com/demo/62">have</a> <a href="http://js1k.com/demo/62">several</a> <a href="http://10k.aneventapart.com/Entry/46">entries</a> on <a href="http://10k.aneventapart.com/Entry/18">both</a>. Anyway, this is the continuation of <a href="/2010/08/1k-js-3d-function-plotter/2010/05/simple-javascript-3d-function-plotter/">my old 3d function</a> plotter, but that one doesn’t work anymore because i’m evil and hotlinked the  github repo and three.js updated in an api-breaking&nbsp;way.</p>
<p>Anyway, after you vote up <a href="http://10k.aneventapart.com/Entry/46">http://10k.aneventapart.com/Entry/46</a> and <a href="http://10k.aneventapart.com/Entry/18">http://10k.aneventapart.com/Entry/18</a> you should totally try out my 3d function plotter at <a href="http://js1k.com/demo/62">http://js1k.com/demo/62</a></p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/08/dom-indexer-js-compression/">DOM Indexer JS Compression</a> <span class="subtitle">05 August 2010</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2010/DOM%20Indexer%20JS%20Compression/Screenshot.png"><div class="pic md" style="" ><img src="/articles/2010/DOM%20Indexer%20JS%20Compression/Screenshot.png" alt="" ><div class="caption">Screenshot</div></div></a></p>
<p>There’s lots of compression systems for <span class="caps">JS</span> out there. There’s the really smart JS rewriter magical rhino-based ones like Closure and YUI. There’s the string-based ones, packer base62, huffman, and lz77. But of the latter category, they all rely on a sort of dictionary coder, where the dictionary (or huffman tree) needs to be sent alongside the compressed&nbsp;content.</p>
<p>Unlike strings of bits, javascript code often refers to methods on the document object model. If we were to crawl the <span class="caps">DOM</span>, we could get a list of DOM properties and use that as the shared dictionary which doesn’t need to be changed, sent or stored.&nbsp;Ever.</p>
<p>Example:</p>
<pre><code><span style='display:none' detected-language='ruby'></span><span class="hljs-prompt">document.getElementById —&gt;</span> <span class="hljs-variable">$dgEln</span>

<span class="hljs-prompt">document.body.appendChild(s); -&gt;</span> <span class="hljs-variable">$dbaChp</span>(s);
</code></pre><p>And as the dictionary never needs to be stored, it’s dynamically computed based on the default browser <span class="caps">DOM</span>, there is a constant overhead for the indexer. The dictionary does not change size based on the size of the&nbsp;content.</p>
<p>The first prototype relied on recursively indexing properties 2-3 levels from window using the <span class="caps">ES5</span> <code>Object.getOwnPropertyNames</code>.  That feature is only supported on <span class="caps">IE9</span>, Chrome 6, probably the latest versions of Safari and Firefox 4. As such, it severely limits the applicability of the&nbsp;algorithm.</p>
<p>Version two switches it to a simple for..in loop. The problem here is that it’s no loner possible to index certain things. Properties like Math, which are marked DontEnum internally can not be iterated, and thus can not be compressed (Math.cos would have been <code>$Mac8</code>). However, it probably makes up for this by recursively indexing things substrings of the discovered objects. So document.getElementById would be interpreted as the full <code>document.getElementById</code> instead of seperately compressing document and <code>getElementById</code>. It also uses a new hash function which makes the output more readable and the length proportional to the length of the source. length becomes <code>$l6</code>, and <code>document.body.removeChild</code> becomes <code>$dbrChp</code>. However, this also removes the possibility of that nice fallback on things not supported by the browser. (<code>if(document.getElementsByClassName){}else{}</code> would have been translated as d3k2.s93k and back as <code>document.s93k</code> on browsers that dont support it and so browser detection gracefully degrades without blah is not defined&nbsp;errors).</p>
<p>Overall. What is the compression ratio? Not that great. If you do lots and lots of <span class="caps">DOM</span> access then you might get a decent ratio, but the code is slow and the ratios are relatively&nbsp;insignificant.</p>
<p>Minify: <a href="http://antimatter15.com/misc/js-minify/minify.html">http://antimatter15.com/misc/js-minify/minify.html</a></p>
<p>Maxify (decoder): <a href="http://antimatter15.com/misc/js-minify/maxify.html">http://antimatter15.com/misc/js-minify/maxify.html</a></p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/07/javascript-canvas-to-animated-gif/">JavaScript &lt;canvas&gt; to (Animated) GIF</a> <span class="subtitle">23 July 2010</span></h2>
            </header>
            <section class="content"><p><div class="pic md" style="" ><img src="/articles/2010/JavaScript%20canvas%20to%20(Animated)%20GIF/converted_animation.gif" alt="This is the GIF which was generated from the canvas." ></div></p>
<p><div class="pic md" style="" ><img src="/articles/2010/JavaScript%20canvas%20to%20(Animated)%20GIF/raw_canvas.png" alt="This is the raw canvas element saved as a non-animated PNG" ></div></p>
<p>I’ve <a href="/2010/07/javascript-canvas-to-animated-gif/2009/08/webworkers-canvas-glif-gifencoder-client-side-animated-gif-generation/">tried this before</a> but it didn’t work. <code>&lt;canvas&gt;</code> can’t do <code>toDataURL(&#39;image/gif&#39;)</code>, and the primitive <span class="caps">GLIF</span> library couldn’t do much so I never had the opportunity to test my gif-merging code that I had. But I’m at it again, this time, porting it from the AS3GIF library, an awesomely comprehensive bitmap to binary gif encoder that even supports LZW compression (and the patent has luckily expired. Yay!). AS3Gif is supposed to “play and encode animated GIFs”, but since web pages can usually natively play GIFs fine, it’s only a port of the GIFEncoder portions of the library. And it works really well. The rest of this post is copied from the<a href="http://github.com/antimatter15/jsgif"> Github readme</a>. Interesting how the w2_embed/anonybot embed post was a blog post turned into readme, this is a readme turned into blogpost. I’ll start with a link to the Github repo&nbsp;anyway:</p>
<p><a href="http://github.com/antimatter15/jsgif">http://github.com/antimatter15/jsgif</a></p>
<h3 id="basic-usage">Basic&nbsp;Usage</h3>
<p>Since it pretty much <em>is</em> GIFEncoder, you could consult the <a href="http://code.google.com/p/as3gif/wiki/How_to_use#The_GIFEncoder">as3gif how-to&nbsp;page</a></p>
<p>But there are some differences so I’ll cover it here&nbsp;anyway.!</p>
<p><a href="/articles/2010/JavaScript%20canvas%20to%20(Animated)%20GIF/clock.gif">This is the <span class="caps">GIF</span> which was generated from the&nbsp;canvas.</a></p>
<p>You first need to include the <span class="caps">JS</span> files. It’s probably best if you include it in this order, but it shouldnt’ matter too&nbsp;much.</p>
<pre><code><span style='display:none' detected-language='handlebars'></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"LZWEncoder.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"NeuQuant.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"GIFEncoder.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span></span>
</code></pre><p>If you want to render the gif through an inline <code>&lt;img&gt;</code> tag or try to save to disk or send to server or anything that requires conversion into a non-binary string form, you should probably include <code>b64.js</code> too.</p>
<pre><code><span style='display:none' detected-language='handlebars'></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"b64.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span></span>
</code></pre><p>Simple enough right? Now to convert stuff to <span class="caps">GIF</span>, you need to have a working or at least some imageData-esque&nbsp;array.</p>
<pre><code><span style='display:none' detected-language='handlebars'></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">canvas</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"bitmap"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">canvas</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript"> 
  <span class="hljs-keyword">var</span> canvas = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'bitmap'</span>); 
  <span class="hljs-keyword">var</span> context = canvas.getContext(<span class="hljs-string">'2d'</span>); 
  context.fillStyle = <span class="hljs-string">'rgb(255,255,255)'</span>; 
  context.fillRect(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,canvas.width, canvas.height); <span class="hljs-comment">//<span class="caps">GIF</span> can't do transparent so do white </span>
  context.fillStyle = <span class="hljs-string">"rgb(200,0,0)"</span>; 
  context.fillRect (<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">75</span>, <span class="hljs-number">50</span>); <span class="hljs-comment">//draw a little red box</span></span></span>
</code></pre><p>Now we need to init the&nbsp;GIFEncoder.</p>
<pre><code><span style='display:none' detected-language='coffeescript'></span><span class="hljs-reserved">var</span> encoder = <span class="hljs-keyword">new</span> GIFEncoder();
</code></pre><p><em>If</em> you are making an animated gif, you need to add the&nbsp;following</p>
<pre><code><span style='display:none' detected-language='vhdl'></span>encoder.setRepeat(<span class="hljs-number">0</span>); //<span class="hljs-number">0</span> -&gt; <span class="hljs-keyword">loop</span> forever //<span class="hljs-number">1</span>+ -&gt; <span class="hljs-keyword">loop</span> n times <span class="hljs-keyword">then</span> stop 
encoder.setDelay(<span class="hljs-number">500</span>); //go <span class="hljs-keyword">to</span> <span class="hljs-keyword">next</span> frame every n milliseconds
</code></pre><p>Now, you need to tell the magical thing that you’re gonna start inserting frames (even if it’s only&nbsp;one).</p>
<pre><code><span style='display:none' detected-language='dos'></span>encoder.<span class="hljs-built_in">start</span>();
</code></pre><p>And for the part that took the longest to port: adding a real frame.&nbsp;encoder.addFrame(context);</p>
<p>In the GIFEncoder version, it accepts a Bitmap. Well, that doesn’t exist in Javascript (natively, anyway) so instead, I use what I feel is a decent analogue: the canvas context. However, if you’re in a situation where you don’t have a real <code>&lt;canvas&gt;</code> element. That’s <em>okay</em>. You can set the second parameter to true and pass a imageData.data-esque array as your first argument. So in other words, you can do <code>encoder.addFrame(fake_imageData, true)</code>as an alternative. However, you <em>must</em> do an <code>encoder.setSize(width, height);</code> before you do any of the addFrames if you pass a imageData.data-like array. If you pass a canvas context, then that’s all okay, because it will automagically do a setSize with the canvas width/height&nbsp;stuff.</p>
<p>Now the last part is to finalize the animation and get it for&nbsp;display.</p>
<pre><code><span style='display:none' detected-language='coffeescript'></span>encoder.finish(); 
<span class="hljs-reserved">var</span> binary_gif = encoder.stream().getData() <span class="hljs-regexp">//</span>notice <span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> different from the as3gif package! 
<span class="hljs-reserved">var</span> data_url = <span class="hljs-string">'data:image/gif;base64,'</span>+encode64(binary_gif); 
</code></pre><h3 id="docs">Docs</h3>
<p>Each of the files exposes a single global (see, at least it’s considerate!). But since there’s three files, that means that there’s three globals. But two of them are more of supporting libraries that I don’t totally understand or care about enough to document. So I’m just gonna document&nbsp;GIFEncoder.</p>
<p><code>new GIFEncoder()</code> This is super parent function. You really don’t need the <code>new</code> keyword because It’s not really even using any special inheritance pattern. It’s a closure that does some <code>var blah = exports.blah = function blah(){</code> for no good reason. Anyway, it returns an object with a bunch of methods that the section will be devoted to documenting. Note that I’ve never tested more than half of these, so good&nbsp;luck.</p>
<p><code>Boolean start()</code> This writes the <span class="caps">GIF</span> Header and returns <code>false</code> if it&nbsp;fails.</p>
<p><code>Boolean addFrame(CanvasRenderingContext2D context)</code> This is the magical magic behind everything. This adds a&nbsp;frame.</p>
<p><code>Boolean addFrame(CanvasPixelArray image, true)</code> This is the magical magic behind everything. This adds a frame. This time you need
you pass <code>true</code> as the second argument and then magic strikes and it loads your canvas pixel array (which can be a real array, I dont care and I think the program has learned from my constant apathy to also not care). But note that if you do, you must first manually call
<code>setSize</code> which is happily defined just below this&nbsp;one.</p>
<p><code>void setSize(width, height)</code> Sets the canvas size. It’s supposed to be private, but I’m exposing it anyway. Gets called automagically as the size of the first frame if you don’t do that crappy hacky imageData.data&nbsp;hack.</p>
<p><code>void setDelay(int milliseconds)</code> the number of milliseconds to wait on each&nbsp;frame</p>
<p><code>void setDispose(int code)</code> Sets the <span class="caps">GIF</span> frame disposal code for the last added frame and any subsequent frames. Default is 0 if no transparent color has been set, otherwise 2. I have no clue what this means so I just copypasted
it from the actionscript&nbsp;docs.</p>
<p><code>void setFrameRate(Number fps)</code> Sets frame rate in frames per second. Equivalent to <code>setDelay(1000/fps)</code>. I think that’s&nbsp;stupid.</p>
<p><code>void setQuality(int quality)</code> Sets quality of color quantization (conversion of images to the maximum 256 colors allowed by the <span class="caps">GIF</span> specification). Lower values (minimum = 1) produce better colors, but slow processing significantly. 10 is the default, and produces good color mapping at reasonable speeds. Values greater than 20 do not yield significant improvements in speed. BLAH BLAH BLAH.&nbsp;Whatever</p>
<p><code>void setRepeat(int iter)</code> Sets the number of times the set of <span class="caps">GIF</span> frames should be played. Default is 1; 0 means play indefinitely. Must be invoked before the first image is&nbsp;added.</p>
<p><code>void setTransparent(Number color)</code> Sets the transparent color for the last added frame and any subsequent frames. Since all colors are subject to modification in the quantization process, the color in the final palette for each frame closest to the given color becomes the transparent color for that frame. May be set to null to indicate no transparent&nbsp;color.</p>
<p><code>ByteArray finish()</code> Adds final trailer to the <span class="caps">GIF</span> stream, if you don’t call the finish method the GIF stream will not be&nbsp;valid.</p>
<p><code>String stream()</code> Yay the only function that returns a non void/boolean. It’s the magical stream function which should have been a getter which <span class="caps">JS</span> does support but I didnt’ feel like making it a getter because getters are so weird and inconsistent. Like sure there’s the nice pretty <code>get</code> thing but I think <span class="caps">IE9</span>/8 doesn’t implement it because it’s non standard or something and replaced it with a hideously ugly blah blah. So Anyway, it’s a function. It returns a byteArray with three writeByte functions that you wouldn’t care about and a <code>getData()</code> function which returns a binary string with the <span class="caps">GIF</span>. There’s also a <code>.bin</code> attribute which contains an array with the binary stuff that I don’t care&nbsp;about.</p>
<h3 id="webworkers">WebWorkers</h3>
<p>The process isn’t really the fastest thing ever, so you should use WebWorkers for piecing together animations more than a few frames long. You can find the rest of the WebWorkers section on the actual readme, because the rest is just a huge block of code with&nbsp;comments.</p>
<p><a href="http://github.com/antimatter15/jsgif">http://github.com/antimatter15/jsgif</a></p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/06/gravity/">gravity</a> <span class="subtitle">10 June 2010</span></h2>
            </header>
            <section class="content"><p><a href="http://antimatter15.com/misc/gravity2.html"><div class="pic md" style="" ><img src="/articles/2010/gravity/antimatter15.com-misc-gravity2.html-Chromium_044.png" alt="" ><div class="caption">gravity2 screenshot</div></div></a></p>
<p><a href="http://antimatter15.com/misc/gravity2.html">Here’s my foray into the flash-esque html5 game arena</a>. It’s a simple game built initially in &lt;canvas&gt; but later scrapped for Raphael because I guess it’s something more suitable for svg than canvas. The interface is fairly simple, you <strong>click to start the game</strong>, where your projectile is sent off at the velocity relative to green blob in the center. Once it’s launched, the projectile is affected by the gravitational field of all the planets in some fairly pretty near-orbits. Once the projectile is in motion, <strong>clicking drops a new planet</strong> at where your cursor is, <strong>holding down makes the planet grow</strong>. The objective is to have the projectile not accelerate off the&nbsp;screen.</p>
<p>As per <a href="http://en.wikipedia.org/wiki/Kepler">Kepler’s laws</a>, getting near a planet produces the <a href="http://en.wikipedia.org/wiki/Gravity_assist">“gravitational slingshot”</a> effect. Since the projectile tends to fly toward the center of planets, a magical <a href="http://en.wikipedia.org/wiki/Divide_by_zero">divide-by-zero</a> causes the infinite acceleration toward&nbsp;doom.</p>
<p>As with several other of my  recent projects, it supports various configuration options via the url query string. If you don’t know how it works, basically, you append ?opt1=val1&amp;opt2… to the url. Example: <a href="http://antimatter15.com/misc/gravity2.html?grav=4">gravity2.html?grav=4</a> , simply <a href="http://antimatter15.com/misc/gravity2.html?fastest">gravity2.html?fastest</a> or a combo of <a href="http://antimatter15.com/misc/gravity2.html?fastest&amp;grav=4&amp;random">gravity2.html?fastest&amp;grav=4&amp;random</a>. The current options are <em>fastest</em> to prevent the targeting of 80fps (accepts no args), <em>target</em> the target fps (obviously can not be used with fastest, in the case, <em>fastest</em> takes precedence) and it accepts one numerical argument, the default is 80. <em>grav</em> accepts one numerical argument, the default is 4 and is the attraction of the planets (<a href="http://antimatter15.com/misc/gravity2.html?grav=0">zero isn’t very fun</a>). _random _makes the planets start off in random places rather than the predefined magical&nbsp;positioning.</p>
<p>Feel free to post highscores in the&nbsp;comments.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/06/mwave-updates/">μwave updates</a> <span class="subtitle">03 June 2010</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2010/μwave%20updates/microwave62.png"><div class="pic md" style="" ><img src="/articles/2010/μwave%20updates/microwave62.png" alt="" ><div class="caption">μwave June 2 Wave View</div></div></a><a href="/articles/2010/μwave%20updates/microwave62s.png"><div class="pic md" style="" ><img src="/articles/2010/μwave%20updates/microwave62s.png" alt="" ><div class="caption">Microwave June 2 Search</div></div></a></p>
<p><a href="/2010/06/mwave-updates/2010/05/%CE%BCwave-lightweight-mobile-wave-client/">Over a few days,</a> things can change fairly quickly. There have been several <strong>speed improvements</strong>, a new <strong>Forum-Style blip rendering</strong> option which arranges blip linearly by the time edited with each containing a formatted quote of the parent to establish context. <strong>Attachments</strong> are now fully supported, including thumbnails and download links. The operations engine was totally rewritten which uses asynchronous XMLHttpRequest, a new callback based system and support for a batch operations (which means fewer requests and faster responses). A wavelet header containing a list of all participants in the entire wave has been added, as well as an <strong>Add Participant </strong>button. A <strong>specialized, extremely fast gadget viewer </strong>was added, which allows for blazingly fast rendering of two popular gadgets (and more will come), it works by bypassing the entire gadget infrastructure and loading trusted code directly inline with the <span class="caps">DOM</span>. There is a “New Wave” button which allows people to <strong>create new waves directly from the client</strong>. The OAuth backend was authenticated with google, for more secure login transactions. Blips have a <strong>new context menu</strong> which allows for features such as <strong>Delete Blip, Edit Blip and Change Title</strong>. A <a href="http://antimatter15.com/misc/read/?googlewave.com!w+mrqWFs0vA">full changelog can be found here</a>.</p>
<p><a href="http://micro-wave.appspot.com">Try it&nbsp;out.</a></p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/03/2-3kb-js-library-with-ajax-animation-dom-manipulation-json-encoding/">2.3KB JS Library with ajax, animation, dom manipulation, json encoding</a> <span class="subtitle">07 March 2010</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2010/2.3KB%20JS%20Library%20with%20ajax,%20animation,%20dom%20manipulation,%20json%20encoding/Screenshot-1.png"><div class="pic md" style="" ><img src="/articles/2010/2.3KB%20JS%20Library%20with%20ajax,%20animation,%20dom%20manipulation,%20json%20encoding/Screenshot-1-300x167.png" alt="" ><div class="caption">Screenshot-1</div></div></a></p>
<p>vX was an old project which aimed to do lots of nifty things in the least code possible (<span class="caps">3KB</span> without gzip!), but among its goals, developer friendliness wasn’t present. So now, I made a new library, this one is 5KB before gzip, and supports most of what vX does, but with DOM manipulation as well, in a jquery-like manner, and animations with queuing and easing. The new library (which doesn’t yet have a name) aims to be really lightweight (which really doesn’t matter much), while being more developer&nbsp;friendly.</p>
<p>For example, I can select all elements with the class “test” using <em>.cls(“test”), and make them purple by doing </em>.cls(“test”).css(“color”,”purple”) similar to jQuery. I can do <em>.id(“yay”).load(“lib.js”) to load something using ajax. Creating elements is pretty easy too, say I want to load a random script, I can do </em>.create(“script”).attr(“src”,”url”).appendTo(<em>.tag(“body”)) and I can add events to something using </em>.tag(“button”).index(0).on(“click”,function(e){alert(“yay”)}).</p>
<p>Here’s a nice little demo of what it can do <a href="http://jsbin.com/owuge/31">http://jsbin.com/owuge/31</a></p>
<p>I intended to post this back in March 7th, but I was working on a rewrite of the library, which would be a tiny bit larger but implement <span class="caps">CSS</span>-selectors and be easier to&nbsp;maintain.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/01/wave-reader-4-6-insanely-fast-edition/">Wave Reader 4.6 - Insanely Fast Edition</a> <span class="subtitle">14 January 2010</span></h2>
            </header>
            <section class="content"><p>Loading a 500 blip wave in Google’s <span class="caps">GWT</span> Client takes 3:34 to get to a usable state (Where the scroll bar works) on a 3ghz Core2 Duo (whose extra core admittedly won’t do much). It also uses 972 MB of&nbsp;RAM.</p>
<p>Loading the same wave in my Wave Reader, take<strong>s 678 milliseconds. A 315x speed-up</strong>. Also, my client is totally unoptimized, pure <span class="caps">30KB</span> of javascript. On top of those features, <strong>anyone can view waves<span style="font-weight: normal;">, without a google account, </span>individual blips can be linked </strong>to, it supports rendering almost everything Wave can, that is <strong>gadgets, inline replies, nesting, </strong>font color/size, italics, bold, everything you could probably expect. Interestingly, when you add an attachment to Wave, and delete the parent blip, it still stores the attachment on the current wave state, and this client can display/link to them without using Playback. There is an option to <strong>generate plain simple <span class="caps">HTML</span></strong> for turning a Wave into a standalone page or Website. <strong>Private waves can be exposed read-only as a website</strong> simply by adding the gwavereader@googlewave.com&nbsp;username.</p>
<p>Using it is simple, take  a Wave <a href="https://wave.google.com/wave/#restored:wave:**googlewave.com!w%252Br5lewFqCA**">https://wave.google.com/wave/#restored:wave:**googlewave.com!w%252Br5lewFqCA**</a> and then put it after the Wave Reader <span class="caps">URL</span> <a href="http://antimatter15.com/misc/wave/read.html?**googlewave.com!w%252Br5lewFqCA**">http://antimatter15.com/misc/wave/read.html?**googlewave.com!w%252Br5lewFqCA**</a>
And magically you have a super awesome <span class="caps">URL</span> to link&nbsp;to.</p>
<p>You can learn some tricks on how to use it to do some more awesome things <a href="http://antimatter15.com/misc/wave/read.html?googlewave.com!w%252BrnG0vaFXA">http://antimatter15.com/misc/wave/read.html?googlewave.com!w%252BrnG0vaFXA</a> such as the before mentioned <span class="caps">HTML</span>&nbsp;generation.</p>
<p>Samples (Some random waves):
<a href="http://antimatter15.com/misc/wave/read.html?googlewave.com!w%252Br5lewFqCA">http://antimatter15.com/misc/wave/read.html?googlewave.com!w%252Br5lewFqCA</a> (New for 4.6 Inline reply support)
<a href="http://antimatter15.com/misc/wave/read.html?Ze3l0mj0A">http://antimatter15.com/misc/wave/read.html?Ze3l0mj0A</a>
<a href="http://antimatter15.com/misc/wave/read.html?oPg9HfEXE&amp;beta">http://antimatter15.com/misc/wave/read.html?oPg9HfEXE&amp;beta</a>
<a href="http://antimatter15.com/misc/wave/read.html?Mu9eK7j2H">http://antimatter15.com/misc/wave/read.html?Mu9eK7j2H</a>
<a href="http://antimatter15.com/misc/wave/read.html?AhbL5fooD&amp;beta">http://antimatter15.com/misc/wave/read.html?AhbL5fooD&amp;beta</a>
<a href="http://antimatter15.com/misc/wave/read.html?googlewave.com!w+UDMZOGpSG">http://antimatter15.com/misc/wave/read.html?googlewave.com!w+UDMZOGpSG</a></p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/01/pure-javascript-html5-canvas-to-animated-gif-conversion/">Pure JavaScript HTML5 &lt;canvas&gt; to (Animated) GIF Conversion</a> <span class="subtitle">03 January 2010</span></h2>
            </header>
            <section class="content"><p>Based on <a href="http://code.google.com/p/as3gif/">as3gif</a> Ported by <a href="http://antimatter15.com">antimatter15</a></p>
<p><div class="pic md" style="" ><img src="/articles/2010/jsgif/raw_canvas.png" alt="This is the raw canvas element saved as a non-animated PNG" ></div>
<div class="pic md" style="" ><img src="/articles/2010/jsgif/converted_animation.gif" alt="This is the GIF which was generated from the canvas." ></div>
<div class="pic md" style="" ><img src="/articles/2010/jsgif/clock.gif" alt="This is the GIF which was generated from the canvas." ></div></p>
<blockquote>
<p><span class="caps">AS3GIF</span> lets you play and encode animated GIF’s with ActionScript&nbsp;3</p>
</blockquote>
<p>Since web pages can usually natively play GIFs fine, it’s only a port of the GIFEncoder
portions of the&nbsp;library.</p>
<h1 id="basic-usage">Basic&nbsp;Usage</h1>
<p>Since it pretty much <em>is</em> GIFEncoder, you could consult the <a href="http://code.google.com/p/as3gif/wiki/How_to_use#The_GIFEncoder">as3gif how-to&nbsp;page</a></p>
<p>But there are some differences so I’ll cover it here&nbsp;anyway.</p>
<p>You first need to include the <span class="caps">JS</span> files. It’s probably best if you include it in this order, but it shouldn’t matter too&nbsp;much.</p>
<pre><code><span style='display:none' detected-language='handlebars'></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"LZWEncoder.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"NeuQuant.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"GIFEncoder.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span></span>
</code></pre><p>If you want to render the gif through an inline <code>&lt;img&gt;</code> tag or try to save to disk or send to server or anything that requires
conversion into a non-binary string form, you should probably include <code>b64.js</code> too.</p>
<pre><code><span style='display:none' detected-language='handlebars'></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"b64.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span></span>
</code></pre><p>Simple enough right? Now to convert stuff to <span class="caps">GIF</span>, you need to have a working &lt;canvas&gt; or at least some imageData-esque&nbsp;array.</p>
<pre><code><span style='display:none' detected-language='handlebars'></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">canvas</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"bitmap"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">var</span> canvas = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'bitmap'</span>);
  <span class="hljs-keyword">var</span> context = canvas.getContext(<span class="hljs-string">'2d'</span>);
  context.fillStyle = <span class="hljs-string">'rgb(255,255,255)'</span>;
  context.fillRect(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,canvas.width, canvas.height); <span class="hljs-comment">//<span class="caps">GIF</span> can't do transparent so do white</span>

  context.fillStyle = <span class="hljs-string">"rgb(200,0,0)"</span>;  
  context.fillRect (<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">75</span>, <span class="hljs-number">50</span>);   <span class="hljs-comment">//draw a little red box</span></span></span>
</code></pre><p>Now we need to init the&nbsp;GIFEncoder.</p>
<pre><code><span style='display:none' detected-language='coffeescript'></span>  <span class="hljs-reserved">var</span> encoder = <span class="hljs-keyword">new</span> GIFEncoder();
</code></pre><p><em>If</em> you are making an animated gif, you need to add the&nbsp;following</p>
<pre><code><span style='display:none' detected-language='vhdl'></span>  encoder.setRepeat(<span class="hljs-number">0</span>); //<span class="hljs-number">0</span>  -&gt; <span class="hljs-keyword">loop</span> forever
                        //<span class="hljs-number">1</span>+ -&gt; <span class="hljs-keyword">loop</span> n times <span class="hljs-keyword">then</span> stop
  encoder.setDelay(<span class="hljs-number">500</span>); //go <span class="hljs-keyword">to</span> <span class="hljs-keyword">next</span> frame every n milliseconds
</code></pre><p>Now, you need to tell the magical thing that you’re gonna start inserting frames (even if it’s only&nbsp;one).</p>
<pre><code><span style='display:none' detected-language='dos'></span>  encoder.<span class="hljs-built_in">start</span>();
</code></pre><p>And for the part that took the longest to port: adding a real&nbsp;frame.</p>
<pre><code><span style='display:none' detected-language='vhdl'></span>  encoder.addFrame(<span class="hljs-keyword">context</span>);
</code></pre><p>In the GIFEncoder version, it accepts a Bitmap. Well, that doesn’t exist in Javascript (natively, anyway)
so instead, I use what I feel is a decent analogue: the canvas context. However, if you’re in a situation
where you don’t have a real <code>&lt;canvas&gt;</code> element. That’s <em>okay</em>. You can set the second parameter to true and
pass a imageData.data-esque array as your first argument. So in other words, you can do <code>encoder.addFrame(fake_imageData, true)</code>
as an alternative. However, you <em>must</em> do an <code>encoder.setSize(width, height);</code> before you do any of the addFrames if you
pass a imageData.data-like array. If you pass a canvas context, then that’s all okay, because it will automagically do a 
setSize with the canvas width/height&nbsp;stuff.</p>
<p>Now the last part is to finalize the animation and get it for&nbsp;display.</p>
<pre><code><span style='display:none' detected-language='coffeescript'></span>  encoder.finish();
  <span class="hljs-reserved">var</span> binary_gif = encoder.stream().getData() <span class="hljs-regexp">//</span>notice <span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> different from the as3gif package!
  <span class="hljs-reserved">var</span> data_url = <span class="hljs-string">'data:image/gif;base64,'</span>+encode64(binary_gif);
</code></pre><h1 id="docs">Docs</h1>
<p>Each of the files exposes a single global (see, at least it’s considerate!). But since there’s three files, that means that 
there’s three globals. But two of them are more of supporting libraries that I don’t totally understand or care about enough
to document. So I’m just gonna document&nbsp;GIFEncoder.</p>
<p><code>new GIFEncoder()</code> This is super parent function. You really don’t need the <code>new</code> keyword because It’s not really even using
any special inheritance pattern. It’s a closure that does some <code>var blah = exports.blah = function blah(){</code> for no good reason.
Anyway, it returns an object with a bunch of methods that the section will be devoted to documenting. Note that I’ve never tested
more than half of these, so good&nbsp;luck.</p>
<p><code>Boolean start()</code> This writes the <span class="caps">GIF</span> Header and returns <code>false</code> if it&nbsp;fails.</p>
<p><code>Boolean addFrame(CanvasRenderingContext2D context)</code> This is the magical magic behind everything. This adds a&nbsp;frame.</p>
<p><code>Boolean addFrame(CanvasPixelArray image, true)</code> This is the magical magic behind everything. This adds a frame. This time you need 
you pass <code>true</code> as the second argument and then magic strikes and it loads your canvas pixel array (which can be a real array, I dont
care and I think the program has learned from my constant apathy to also not care). But note that if you do, you must first manually call
<code>setSize</code> which is happily defined just below this&nbsp;one.</p>
<p><code>void setSize(width, height)</code> Sets the canvas size. It’s supposed to be private, but I’m exposing it anyway. Gets called automagically
as the size of the first frame if you don’t do that crappy hacky imageData.data&nbsp;hack.</p>
<p><code>void setDelay(int milliseconds)</code> the number of milliseconds to wait on each&nbsp;frame</p>
<p><code>void setDispose(int code)</code> Sets the <span class="caps">GIF</span> frame disposal code for the last added frame and any
subsequent frames. Default is 0 if no transparent color has been set, otherwise 2. I have no clue what this means so I just copypasted
it from the actionscript&nbsp;docs.</p>
<p><code>void setFrameRate(Number fps)</code> Sets frame rate in frames per second. Equivalent to <code>setDelay(1000/fps)</code>. I think that’s&nbsp;stupid.</p>
<p><code>void setQuality(int quality)</code> Sets quality of color quantization (conversion of images to the maximum 256 colors allowed by the 
<span class="caps">GIF</span> specification). Lower values (minimum = 1) produce better colors, but slow processing significantly. 10 is the default, and produces 
good color mapping at reasonable speeds. Values greater than 20 do not yield significant improvements in speed. BLAH BLAH BLAH.&nbsp;Whatever</p>
<p><code>void setRepeat(int iter)</code> Sets the number of times the set of <span class="caps">GIF</span> frames should be played. Default is 1; 0 means play indefinitely. 
Must be invoked before the first image is&nbsp;added.</p>
<p><code>void setTransparent(Number color)</code> Sets the transparent color for the last added frame and any subsequent
frames. Since all colors are subject to modification in the quantization
process, the color in the final palette for each frame closest to the given
color becomes the transparent color for that frame. May be set to null to
indicate no transparent&nbsp;color.</p>
<p><code>ByteArray finish()</code> Adds final trailer to the <span class="caps">GIF</span> stream, if you don’t call the finish method the GIF stream will not be&nbsp;valid. </p>
<p><code>String stream()</code> Yay the only function that returns a non void/boolean. It’s the magical stream function which should have been a getter which <span class="caps">JS</span> does
support but I didnt’ feel like making it a getter because getters are so weird and inconsistent. Like sure there’s the nice pretty <code>get</code> thing
but I think <span class="caps">IE9</span>/8 doesn’t implement it because it’s non standard or something and replaced it with a hideously ugly blah blah. So Anyway, it’s a function.
It returns a byteArray with three writeByte functions that you wouldn’t care about and a <code>getData()</code> function which returns a binary string with the <span class="caps">GIF</span>.
There’s also a <code>.bin</code> attribute which contains an array with the binary stuff that I don’t care&nbsp;about.</p>
<h1 id="webworkers">WebWorkers</h1>
<p>The process isn’t really the fastest thing ever, so you should
use WebWorkers for piecing together animations more than a few frames&nbsp;long.</p>
<p>I haven’t actually tried it yet, but here’s some incomplete mock-<span class="caps">JS</span> which
should be able to do stuff once you add the boring stuff like serializing
and deserializing the content (actually, i have most of the serializing done
but you have to deserialize that and that’s really the boring&nbsp;part).</p>
<pre><code><span style='display:none' detected-language='javascript'></span><span class="hljs-keyword">var</span> frame_index,
    frame_length,
    height, 
    width,
    imageData; <span class="hljs-comment">//get it from onmessage</span>

<span class="hljs-keyword">var</span> encoder = <span class="hljs-keyword">new</span> GIFEncoder(); <span class="hljs-comment">//create a new GIFEncoder for every new job</span>
<span class="hljs-keyword">if</span>(frame_index == <span class="hljs-number">0</span>){
  encoder.start();
}<span class="hljs-keyword">else</span>{
  encoder.setProperties(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">//started, firstFrame</span>
}
encoder.setSize(height, width);
encoder.addFrame(imageData, <span class="hljs-literal">true</span>);
<span class="hljs-keyword">if</span>(frame_length == frame_index){
  encoder.finish()
}
postMessage(frame_index + encoder.stream().getData()) <span class="hljs-comment">//on the page, search for the GIF89a to see the frame_index</span>


<span class="hljs-keyword">var</span> animation_parts = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(frame_length);
<span class="hljs-comment">//on the handler side:</span>

<span class="hljs-keyword">var</span> worker = <span class="hljs-keyword">new</span> WebWorker(<span class="hljs-string">'blahblahblah.js'</span>);
worker.onmessage = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
  <span class="hljs-comment">//handle stuff, like get the frame_index</span>
  animation_parts[frame_index] = frame_data;
  <span class="hljs-comment">//check when everything else is done and then do animation_parts.join('') and have fun</span>
}
<span class="hljs-keyword">var</span> imdata = context.getImageData(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,canvas.width,canvas.height)
<span class="hljs-keyword">var</span> len = canvas.width * canvas.height * <span class="hljs-number">4</span>;
<span class="hljs-keyword">var</span> imarray = [];
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; len; i++){
  imarray.push(imdata[i]);
}

worker.postMessage(frame_index + <span class="hljs-string">';'</span> + frame_length + <span class="hljs-string">';'</span> + canvas.height + <span class="hljs-string">';'</span> + canvas.width + <span class="hljs-string">';'</span> + imarray.join(<span class="hljs-string">','</span>))
</code></pre>
            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2009/12/wave-unread-navigator/">Wave Unread Navigator</a> <span class="subtitle">13 December 2009</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2009/Wave%20Unread%20Navigator/screenshot_050.png"><div class="pic md" style="" ><img src="/articles/2009/Wave%20Unread%20Navigator/screenshot_050.png" alt="screenshot_050" ><div class="caption">screenshot_050</div></div></a></p>
<p>I made an extension which shows a green sign (like gmail) on the side whenever there are blips outside the viewport. It allows you to quickly and effectively use keyboard navigation without blindly checking above and below, or generally scroll without needing to guess the&nbsp;position.</p>
<p>It comes as a <a href="https://chrome.google.com/extensions/detail/jncflgepcddhcejhofdojlkjgjhcfmpc">Chrome Extension</a> and also as a <a href="http://antimatter15.com/misc/wave/wavenavigation.user.js">Greasemonkey Userscript</a>.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2009/08/shinytouch-js/">ShinyTouch/JS</a> <span class="subtitle">28 August 2009</span></h2>
            </header>
            <section class="content"><p>Yay for yet another demo that strives to mix an mash almost everything <span class="caps">HTML5</span> related! ShinyTouch in JS dumps the stuff from a &lt;video&gt; tag with ogg encoded video (well, almost all video from linux is ogg encoded so it’s just whatever format i got first from cheese). It gets dumped into &lt;canvas&gt; and getImageData does it’s&nbsp;magic.</p>
<p>Interestingly, if you don’t use the video and just do data from a raw image, you get upwards of 125fps on V8. Adding the video, it ceases to work on Chromium (maybe a linux thing? <a href="http://code.google.com/p/chromium/issues/detail?id=16225">this</a> tells me it’s just linux, but you can never be so&nbsp;sure).</p>
<pre><code><span style='display:none' detected-language='coffeescript'></span><span class="hljs-regexp">//</span>At <span class="hljs-keyword">this</span> point, run away as the algorithm gets messy <span class="hljs-keyword">and</span> hackish
</code></pre><p>So the thing just searches from right to left up to down within the quad. When it finds a column of something that fits the rgb range of the finger that is larger than a certain threshold, it checks for a reflection from the point. If it detects a reflection then yay! it throws the data at the perspective warper (based on a python one which is based on a C# one and though it would probably be easier to port from C# to <span class="caps">JS</span> making long chains of derivative work is fun). If there wasnt a reflection then it logs that and if that number is larger than some othe rthreshold then it kills the scanning and goes on with it’s life. The reflection algorithm just takes the point 5 pixels to the right and assumes that would be a reflection if there was one and a point 15px above and 5px to the left (nasty stuff) and takes the hue value from their RGB values. It takes the absolute value of the difference of the hue values multiplied by 100 (or 200 in the python version) and compares it with a preset configuration&nbsp;variable.</p>
<p>So now that that horrible algorithm which was just whatever came to my little totally untrained mind first. But it works semi-decently, at least for me. But you can hopefully see how nasty it’s inner workings are and it inspires people to clean it up. It’s quite a bit more readable than the Python version and only 200 lines of <span class="caps">JS</span> so it won’t be <em>too</em> hard to&nbsp;understand.</p>
<p>But since <span class="caps">HTML5</span> has no Video capture thing for webcams, and my webcam doesn’t work with flash so I can’t use that canvas&lt;-flash webcam bridge i built, uh, almost 2 years ago. So now you just get to gaze at my finger moving for like 20&nbsp;seconds!</p>
<p><a href="http://antimatter15.com/misc/shiny/shinytouch.html">http://antimatter15.com/misc/shiny/shinytouch.html</a></p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2009/08/freemovie-js-pure-javascript-swf-generator/">Freemovie/JS Pure Javascript SWF Generator</a> <span class="subtitle">17 August 2009</span></h2>
            </header>
            <section class="content"><p>I’m making a crude python script that translates <span class="caps">PHP</span> to JS rather hideously. It probably will not work on any other codebase. It was a script quickly hacked together to one&nbsp;purpose.</p>
<p><a href="http://sourceforge.net/projects/freemovie/">Freemovie </a>is</p>
<blockquote>
<p>FreeMovie is an <span class="caps">SWF</span> generator library written in PHP and ported to Ruby. FreeMovie can be used to develop Web and desktop aplications.
<span style="text-decoration: line-through;">Speaking of the Ruby port, I can’t find it. So if anyone finds it, I think it might be useful somewhere.</span> Found it in the <span class="caps">CVS</span>, it’s really incomplete compared to the PHP&nbsp;version.</p>
</blockquote>
<p>The machine translated code (Not <em>entirely</em> autogenerated, I wrote a line or two of it) is not too hideous, the tabbing is slightly off, but it’s at least mostly readable. It was a lot worse 2 hours ago (half of the lines had indentation, other without any, debugging comments everywhere saying useless and distracting&nbsp;things).</p>
<p>The translator is only 107 lines of (hideous code, though the language is beautiful, I guess if you loved <span class="caps">JS</span> enough, you could try running the program though <a href="http://www.skulpt.org/">skulpt</a>) python (+ 20 or so in another file to change chr() to String.fromCharCode, etc). After that, it uses 6 <span class="caps">PHP</span> compatibility functions and 5 from the PHP.js project to cover the features that I’m too lazy to  put in the compiler or are just not features in&nbsp;JS.</p>
<p><a href="http://antimatter15.com/misc/freemovie/js/demo/fm-demo-0.htm">http://antimatter15.com/misc/freemovie/js/demo/fm-demo-0.htm</a></p>
<p>The above demo generates a flash image entirely client-side, though the resulting base64 encoded data is sent to be decoded on the server since you can’t load a <span class="caps">SWF</span> from a data-url. If someone finds out how, it would be cool to tell&nbsp;me.</p>
<p>A big issue though, is that for some odd reason half the shapes don’t work. The ones in the demo work, but all filled shapes, and the circles/arcs do not&nbsp;work.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2008/12/distributed-computing-take-iii/">Distributed Computing Take III</a> <span class="subtitle">31 December 2008</span></h2>
            </header>
            <section class="content"><p>I donno why, but i’m revisiting this. I was trawling across Wikipedia one day, and I got to the article about Pi. I tried distributing Pi a while ago, actually, before I did the hashes. But I never ended up implementing it because it didn’t seem feasable, as all the algorithims I encountered (or tried porting) required lots of memory, something very hard to distribute for this scenario. But this time, I found <a href="http://en.wikipedia.org/wiki/Computing_%C3%8F%C2%80#Digit_extraction_methods">these</a>. Looking through them, and googling in the process, I found <a href="http://www.omegacoder.com/?p=91">http://www.omegacoder.com/?p=91</a>, and ported it over to Javascript. It was relatively slow compared to the SuperPi implementation in Javascript, but it was easily&nbsp;distributed.</p>
<p>One problem though, is that it gets slower every iteration (to find the net block of digits). Finding .<span style="font-size: small;">141592653 will be roughly 20ms faster than the next 9 digits (it processes in blocks of 9). Not only would it take longer, but it occupied 100% of the <span class="caps">CPU</span>, and it would pop up that ever-annoying “This script may make your computer non responsive” window. So I implemented <a href="http://www.julienlecomte.net/blog/2007/10/28/">this</a> pattern to make it not lock up any browser other than Chrome (and possibly WebKit&nbsp;Nightly).</span></p>
<p><span style="font-size: small;">Still, it would take up 100% of the <span class="caps">CPU</span>. I ran it overnight and got to digit&nbsp;17,000.</span></p>
<p><span style="font-size: small;">Eventually, it would take about half an hour for a single iteration (at the 20000th digit). With web-based distributed computing, I can’t rely much more time than what Google Analytics reports to be 00:02:24 (my Average Time on Site). And that’s half an hour with a 3ghz Intel Core 2 Duo (it’s dual core, but the script, is single&nbsp;threaded). </span></p>
<p><span style="font-size: small;">I then split the function into smaller parts. the main function was split up, and the loops were divided across users. Now, it can scale easily. It uses virtually no visible <span class="caps">CPU</span>. and fits well into that 2 minute&nbsp;timeframe.</span></p>
<p><span style="font-size: small;">Try it out <a href="http://www.antimatter15.com/misc/pisect/test.htm">here</a>, but don’t stay too long, because i only set there to be 500&nbsp;“jobs”.
</span></p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2008/08/controlling-a-native-app-from-a-javascript-desktop/">Controlling A Native App from a Javascript Desktop</a> <span class="subtitle">29 August 2008</span></h2>
            </header>
            <section class="content"><p>Well, I worked on a sort of <span class="caps">VNC</span>-like solution to controlling native desktop applications from a remote PC. It’s an interesting concept, I settled with something less than easy to use, and less than really feasable. It’s a Proof of concept, and it’s likely I won’t work on it again (Like&nbsp;ForkSwif).</p>
<p>It is an application (module) on a hacked Ext 2.0 Desktop example that uses Ajax (Polling) to query a local <span class="caps">PHP</span> proxy to query a remote desktop. The remote desktop is running some software (powered by .NET sadly…) that captures the window’s contents, does a diff to see if there are modifications and where (only sends updates to changed parts of the screen, sorta like VNC). It base64 encodes it and sends it along HTTP to the proxy, which sends it to the javascript&nbsp;client.</p>
<p>The client can send events to be repeated on the remote desktop, currently only left mousedown and mouseup (so, basically only clicking), but using the Keyboard should be easy&nbsp;enough.</p>
<p>I imagine that a more feasable option is to create a javascript X11 client, taking proxied connections to a X session under <span class="caps">SSH</span> so it is better with window-specificness, and an overall more stable platform, so you could also run multiple applications simultaneously on the&nbsp;desktop.</p>
<p>here’s an early&nbsp;screenshot:</p>
<p><div class="pic md" style="" ><img src="/articles/2008/Controlling%20A%20Native%20App%20from%20a%20Javascript%20Desktop/jsvnc.png" alt="Controlling A native desktop app from a javascript desktop" ><div class="caption">Controlling A native desktop app from a javascript desktop</div></div> Controlling A native desktop app from a javascript desktop (early&nbsp;build)</p>
<p>Files&nbsp;here:</p>
<p><a href="/2008/misc/coolstuff.zip">http://antimatter15.110mb.com/misc/coolstuff.zip</a></p>
<p>Extract desktop2 to your Apache server, start Windows Calculator (or another app of your choosing). Run Screen.exe, type the app title, press “Get Handle” and check the “Run Server” box. Navigate to the desktop.html (on your <span class="caps">PHP</span>-enabled apache), and start the “NV Window”&nbsp;app.</p>
<p>To be able to control the app, you have to set it to your network ip (not localhost) on a <span class="caps">VM</span> or a different computer. and configure sample.js at line&nbsp;191.</p>
<pre><code><span style='display:none' detected-language='groovy'></span><span class="hljs-string">proxy:</span> <span class="hljs-string">"gdat.php?url="</span>,
<span class="hljs-string">updateurl :</span> <span class="hljs-string">"[http://localhost:12345](http://localhost:12345/)"</span>,
<span class="hljs-string">baseurl :</span> <span class="hljs-string">"[http://localhost:12345/base](http://localhost:12345/base)"</span>,
<span class="hljs-string">showimg :</span> <span class="hljs-literal">false</span>,
<span class="hljs-string">uinterval:</span> <span class="hljs-number">1000</span>,
<span class="hljs-string">updater:</span> <span class="hljs-literal">null</span>,
<span class="hljs-string">xoffset:</span> -<span class="hljs-number">8</span>,
<span class="hljs-string">yoffset:</span> -<span class="hljs-number">28</span>,
</code></pre><p>change localhost to the server’s <span class="caps">IP</span>. And tick “Control&nbsp;Desktop”</p>
<p>Note that you need&nbsp;firebug.</p>
<p>If i can think of a name for the app, i’ll be sure to creakte a google code project for it. so if anyone want’s the source, think of a name for&nbsp;it.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2007/11/new-file-format/">New File Format</a> <span class="subtitle">17 November 2007</span></h2>
            </header>
            <section class="content"><p>I’m working on a better save/preview file format, even merging the save/preview formats into&nbsp;one.</p>
<p>it’s just a string seperated by “;;” before it, is a standard <span class="caps">JSON</span> Array. After, is the standard XML compiler stuff. the json has info like framerate,height,width,current frame, tweens, keyframes, animation length, comments?, rating?, size?&nbsp;etc.</p>
<p>the javascript save/load implementation is so far&nbsp;done.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2007/11/to-self-fixed-timeline2-js/">To Self Fixed Timeline2.js</a> <span class="subtitle">12 November 2007</span></h2>
            </header>
            <section class="content"><p>To Self: Fixed Timeline2.js to make keyframe stuph&nbsp;work</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2007/10/md5-sha1-pure-javascript-hash-cracking/">MD5/SHA1 Pure Javascript Hash Cracking</a> <span class="subtitle">10 October 2007</span></h2>
            </header>
            <section class="content"><p>All client side sha1/md5 hash cracking using a rainbow table type system. capable of cracking all lowercase alphanumberic hashes under 3 letters in&nbsp;length.</p>
<p><a href="/2007/misc/md5.htm">http://antimatter15.110mb.com/misc/md5.htm</a>
<a href="/2007/misc/sha1.htm">http://antimatter15.110mb.com/misc/sha1.htm</a></p>

            </section>
          </article>
          <hr>
          <div class="nav"><a href="/archive" class="newer">« Archives</a><a href="/page/1" class="next">Latest Posts »</a>
          </div>
        </div>
      </div>
    </div>
    <script>
      function squish(){
        document.getElementById("squishfoot").className += "squish"
      }
    </script>
    <style>
      .squish { font-size: 9px }
      .squishsquish { font-size: 8px }
      .squishsquishsquish { font-size: 7px }
      .squishsquishsquishsquish { font-size: 6px }
      .squishsquishsquishsquishsquish { font-size: 5px }
      .squishsquishsquishsquishsquishsquish { font-size: 4px }
      .squishsquishsquishsquishsquishsquishsquish { visibility: hidden }
    </style>
    <div class="graybar bottom">
      <footer>
        <div id="squishfoot">I'm a tiny footer, please don't <a href="javascript:squish()">squish</a> me</div>
      </footer>
    </div>
  </body>
</html>