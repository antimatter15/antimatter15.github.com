<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" href="http://antimatter15.com/feed.xml" type="application/rss+xml" title="somewhere to talk about ideas and projects and stuff like everyone else">
    <link rel="stylesheet" href="/style/main.css">
    <title>#image</title>
  </head>
  <body>
    <div class="whitebox">
      <div class="graybar top">
        <header class="top">
          <div class="slogan">somewhere to talk about random ideas and projects like everyone else</div><a href="/">
            <h1 class="logo">
              stuff
               <span class="byline">by antimatter15</span>
            </h1></a>
        </header>
      </div>
      <div id="main">
        <div class="sidebar">
          <div class="about">
            <p class="emph">
              Hi. I’m <b>Kevin Kwok</b>, and I’m currently a junior at <b>MIT</b>, 
              and this is my obligatory online presence or whatever.  
            </p>
            <p>This is my little corner of the internet, where I talk about random projects and ideas and stuff. </p>
            <p>If you want to contact me or read obnoxiously nostalgic autobiographical trivia, check out the <a href="/about"> about </a>section.</p>
          </div><br>
          <section class="archive"><a href="/archive">
              <h2>Archive</h2></a>
            <ul>
              <li>
                <ul>
                  <li><a href="/2015/12"><span class="month">December</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/08"><span class="month">August</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/06"><span class="month">June</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/05"><span class="month">May</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/04"><span class="month">April</span> <span class="year">2015</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2014/12"><span class="month">December</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/07"><span class="month">July</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/06"><span class="month">June</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/05"><span class="month">May</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/04"><span class="month">April</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/03"><span class="month">March</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/02"><span class="month">February</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/01"><span class="month">January</span> <span class="year">2014</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2013/12"><span class="month">December</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/11"><span class="month">November</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/10"><span class="month">October</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/09"><span class="month">September</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/08"><span class="month">August</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/07"><span class="month">July</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/06"><span class="month">June</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/05"><span class="month">May</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/04"><span class="month">April</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/03"><span class="month">March</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/02"><span class="month">February</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/01"><span class="month">January</span> <span class="year">2013</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2012/12"><span class="month">December</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/11"><span class="month">November</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/10"><span class="month">October</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/09"><span class="month">September</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/08"><span class="month">August</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/07"><span class="month">July</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/06"><span class="month">June</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/05"><span class="month">May</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/04"><span class="month">April</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/03"><span class="month">March</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/02"><span class="month">February</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/01"><span class="month">January</span> <span class="year">2012</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2011/12"><span class="month">December</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/11"><span class="month">November</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/10"><span class="month">October</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/09"><span class="month">September</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/08"><span class="month">August</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/07"><span class="month">July</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/06"><span class="month">June</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/05"><span class="month">May</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/04"><span class="month">April</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/03"><span class="month">March</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/02"><span class="month">February</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/01"><span class="month">January</span> <span class="year">2011</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2010/12"><span class="month">December</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/11"><span class="month">November</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/10"><span class="month">October</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/09"><span class="month">September</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/08"><span class="month">August</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/07"><span class="month">July</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/06"><span class="month">June</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/05"><span class="month">May</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/04"><span class="month">April</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/03"><span class="month">March</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/02"><span class="month">February</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/01"><span class="month">January</span> <span class="year">2010</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2009/12"><span class="month">December</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/11"><span class="month">November</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/10"><span class="month">October</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/09"><span class="month">September</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/08"><span class="month">August</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/07"><span class="month">July</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/06"><span class="month">June</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/05"><span class="month">May</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/04"><span class="month">April</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/03"><span class="month">March</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/01"><span class="month">January</span> <span class="year">2009</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2008/12"><span class="month">December</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/11"><span class="month">November</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/10"><span class="month">October</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/09"><span class="month">September</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/08"><span class="month">August</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/07"><span class="month">July</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/06"><span class="month">June</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/05"><span class="month">May</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/04"><span class="month">April</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/01"><span class="month">January</span> <span class="year">2008</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2007/12"><span class="month">December</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/11"><span class="month">November</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/10"><span class="month">October</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/09"><span class="month">September</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/08"><span class="month">August</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/05"><span class="month">May</span> <span class="year">2007</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2006/09"><span class="month">September</span> <span class="year">2006</span></a></li>
                  <li><a href="/2006/08"><span class="month">August</span> <span class="year">2006</span></a></li>
                </ul><br>
              </li>
            </ul>
          </section>
          <div class="tags">
            <h2>Tags</h2><a href="/tag/3D" style="font-size: 13px">3D </a><a href="/tag/actionscript" style="font-size: 11px">actionscript </a><a href="/tag/ajax" style="font-size: 20px">ajax </a><a href="/tag/ajax animator" style="font-size: 20px">ajax animator </a><a href="/tag/animation" style="font-size: 11px">animation </a><a href="/tag/api" style="font-size: 13px">api </a><a href="/tag/apple" style="font-size: 20px">apple </a><a href="/tag/arduino" style="font-size: 11px">arduino </a><a href="/tag/art" style="font-size: 13px">art </a><a href="/tag/awesome" style="font-size: 13px">awesome </a><a href="/tag/blog" style="font-size: 19px">blog </a><a href="/tag/browser" style="font-size: 20px">browser </a><a href="/tag/bugfix" style="font-size: 15px">bugfix </a><a href="/tag/canvas" style="font-size: 15px">canvas </a><a href="/tag/change" style="font-size: 15px">change </a><a href="/tag/chrome" style="font-size: 20px">chrome </a><a href="/tag/chrome os" style="font-size: 11px">chrome os </a><a href="/tag/chromebook" style="font-size: 11px">chromebook </a><a href="/tag/code" style="font-size: 13px">code </a><a href="/tag/colors" style="font-size: 11px">colors </a><a href="/tag/css" style="font-size: 11px">css </a><a href="/tag/demo" style="font-size: 11px">demo </a><a href="/tag/design" style="font-size: 20px">design </a><a href="/tag/elitist" style="font-size: 20px">elitist </a><a href="/tag/evil" style="font-size: 19px">evil </a><a href="/tag/experiment" style="font-size: 15px">experiment </a><a href="/tag/extension" style="font-size: 20px">extension </a><a href="/tag/ExtJS" style="font-size: 20px">ExtJS </a><a href="/tag/fast" style="font-size: 20px">fast </a><a href="/tag/features" style="font-size: 15px">features </a><a href="/tag/firefox" style="font-size: 20px">firefox </a><a href="/tag/flash" style="font-size: 17px">flash </a><a href="/tag/format" style="font-size: 11px">format </a><a href="/tag/function" style="font-size: 13px">function </a><a href="/tag/future" style="font-size: 15px">future </a><a href="/tag/GAE" style="font-size: 13px">GAE </a><a href="/tag/github" style="font-size: 15px">github </a><a href="/tag/google" style="font-size: 20px">google </a><a href="/tag/google wave" style="font-size: 20px">google wave </a><a href="/tag/graphics" style="font-size: 17px">graphics </a><a href="/tag/hacking" style="font-size: 11px">hacking </a><a href="/tag/hardware" style="font-size: 11px">hardware </a><a href="/tag/history" style="font-size: 11px">history </a><a href="/tag/hosting" style="font-size: 19px">hosting </a><a href="/tag/html5" style="font-size: 19px">html5 </a><a href="/tag/idea" style="font-size: 13px">idea </a><a href="/tag/internet exploder" style="font-size: 20px">internet exploder </a><a href="/tag/ipad" style="font-size: 17px">ipad </a><a href="/tag/javascript" style="font-size: 20px">javascript </a><a href="/tag/json" style="font-size: 15px">json </a><a href="/tag/library" style="font-size: 11px">library </a><a href="/tag/lines" style="font-size: 13px">lines </a><a href="/tag/linux" style="font-size: 17px">linux </a><a href="/tag/login" style="font-size: 15px">login </a><a href="/tag/mac" style="font-size: 11px">mac </a><a href="/tag/magical" style="font-size: 15px">magical </a><a href="/tag/math" style="font-size: 11px">math </a><a href="/tag/meta" style="font-size: 13px">meta </a><a href="/tag/microsoft" style="font-size: 15px">microsoft </a><a href="/tag/microwave" style="font-size: 15px">microwave </a><a href="/tag/mp3" style="font-size: 11px">mp3 </a><a href="/tag/multitouch" style="font-size: 13px">multitouch </a><a href="/tag/new" style="font-size: 19px">new </a><a href="/tag/nostalgia" style="font-size: 11px">nostalgia </a><a href="/tag/ocr" style="font-size: 13px">ocr </a><a href="/tag/offline" style="font-size: 17px">offline </a><a href="/tag/old" style="font-size: 17px">old </a><a href="/tag/onlypaths" style="font-size: 17px">onlypaths </a><a href="/tag/pi" style="font-size: 19px">pi </a><a href="/tag/player" style="font-size: 11px">player </a><a href="/tag/progress" style="font-size: 11px">progress </a><a href="/tag/prototype" style="font-size: 13px">prototype </a><a href="/tag/python" style="font-size: 20px">python </a><a href="/tag/raphael" style="font-size: 19px">raphael </a><a href="/tag/release" style="font-size: 13px">release </a><a href="/tag/rewrite" style="font-size: 13px">rewrite </a><a href="/tag/school" style="font-size: 15px">school </a><a href="/tag/security" style="font-size: 15px">security </a><a href="/tag/shiny" style="font-size: 20px">shiny </a><a href="/tag/ShinyTouch" style="font-size: 13px">ShinyTouch </a><a href="/tag/simple" style="font-size: 11px">simple </a><a href="/tag/site" style="font-size: 13px">site </a><a href="/tag/small" style="font-size: 20px">small </a><a href="/tag/speed" style="font-size: 11px">speed </a><a href="/tag/SVG" style="font-size: 15px">SVG </a><a href="/tag/touch" style="font-size: 13px">touch </a><a href="/tag/update" style="font-size: 20px">update </a><a href="/tag/upload" style="font-size: 17px">upload </a><a href="/tag/user interface" style="font-size: 11px">user interface </a><a href="/tag/vector" style="font-size: 13px">vector </a><a href="/tag/vectoreditor" style="font-size: 19px">vectoreditor </a><a href="/tag/version" style="font-size: 13px">version </a><a href="/tag/video" style="font-size: 15px">video </a><a href="/tag/vision" style="font-size: 11px">vision </a><a href="/tag/vp8" style="font-size: 11px">vp8 </a><a href="/tag/vX JS" style="font-size: 19px">vX JS </a><a href="/tag/wave" style="font-size: 20px">wave </a><a href="/tag/wikify" style="font-size: 20px">wikify </a><a href="/tag/wikipedia" style="font-size: 17px">wikipedia </a><a href="/tag/wordpress" style="font-size: 20px">wordpress </a>
          </div>
        </div>
        <div id="content">
          <h1>#image</h1>
          <article class="article intro">
            <header>
              <h2><a href="/2015/05/cooley-tukey-fft-dct-idct-in-under-1k-of-javascript/">Cooley-Tukey FFT + DCT + IDCT in under 1K of Javascript</a> <span class="subtitle">30 May 2015</span></h2>
            </header>
            <section class="content"><p><div class="pic md right" style="width: 300px" ><img alt=""  src="/articles/2015/MiniFFT/hough-medium.jpg" ><div class="caption">Technically this is a Hough transform and isn&#39;t at all related to the <span class="caps">FFT</span>*, but it looks a lot cooler than any of the actual FFT/DCT pictures I have, so I might as well stick it here</div></div></p>
<p>Almost a year ago, I wrote a simple script for computing perceptual hashes in Javascript (it’s going to be part of a forthcoming Naptha feature which allows it recognize source images for memes and do perfect inpainting). One step of the process is computing the 2D Discrete Cosine Transform of a shrunken version of the&nbsp;image. </p>
<p>The problem is that step was kind of ridiculously slow, and it’s not really hard to see why: there’s a series of four nested for loops— because that’s the obvious naive way for computing the&nbsp;<span class="caps">DCT</span>. </p>
<p>In practice, it’s actually not all that bad because you only have to do it once per image, and the dimensions of the source image are a fixed 32x32. But it still felt pretty bad, so when I was looking over the code again earlier this week, I tried doing some research to figure out a faster way to do the&nbsp;<span class="caps">DCT</span>. </p>
<p>Surely you’d imagine that there have to be extraordinarily efficient implements of the <span class="caps">DCT</span> out there, given that it’s the very foundation of JPEG out there. And you’d be right, but they’ve generally unrolled the butterfly into a series of bit-shifts which are quite unlikely to generalize beyond the 8x8 block&nbsp;size. </p>
<p>I’m reasonably confident that <span class="caps">FFTW3</span> has a fast DCT implementation which also is capable of generalization, but it seems buried within quite a lot of&nbsp;code. </p>
<h2 id="minifft">MiniFFT</h2>
<p>This isn’t a super performant implementation, but it’s not horrendously slow and it doesn’t use recursion. It’s probably pretty trivial to make it quite a bit faster by precomputing sine and cosine tables. This uses the standard Cooley-Tukey radix-2 decimation-in-time algorithm, which means it only works for one dimensional arrays with a length which is a power of&nbsp;two. </p>
<p>It doesn’t check that the length is a power of two, it’ll just give you the wrong answer. You should definitely check that it’s true&nbsp;beforehand.</p>
<pre><code><span style='display:none' detected-language='javascript'></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">miniFFT</span><span class="hljs-params">(re, im)</span> </span>{
    <span class="hljs-keyword">var</span> N = re.length;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; N; i++) {
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>, h = i, k = N; k &gt;&gt;= <span class="hljs-number">1</span>; h &gt;&gt;= <span class="hljs-number">1</span>)
            j = (j &lt;&lt; <span class="hljs-number">1</span>) | (h <span class="amp">&amp;</span> <span class="hljs-number">1</span>);
        <span class="hljs-keyword">if</span> (j &gt; i) {
            re[j] = [re[i], re[i] = re[j]][<span class="hljs-number">0</span>]
            im[j] = [im[i], im[i] = im[j]][<span class="hljs-number">0</span>]
        }
    }
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> hN = <span class="hljs-number">1</span>; hN * <span class="hljs-number">2</span> &lt;= N; hN *= <span class="hljs-number">2</span>)
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; N; i += hN * <span class="hljs-number">2</span>)
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = i; j &lt; i + hN; j++) {
                <span class="hljs-keyword">var</span> cos = <span class="hljs-built_in">Math</span>.cos(<span class="hljs-built_in">Math</span>.<span class="caps">PI</span> * (j - i) / hN),
                    sin = <span class="hljs-built_in">Math</span>.sin(<span class="hljs-built_in">Math</span>.<span class="caps">PI</span> * (j - i) / hN)
                <span class="hljs-keyword">var</span> tre =  re[j+hN] * cos + im[j+hN] * sin,
                    tim = -re[j+hN] * sin + im[j+hN] * cos;
                re[j + hN] = re[j] - tre; im[j + hN] = im[j] - tim;
                re[j] += tre; im[j] += tim;
            }
}
</code></pre><p>The transformation happens in place, so it’ll modify whatever arrays you pass&nbsp;in. </p>
<pre><code><span style='display:none' detected-language='javascript'></span><span class="hljs-keyword">var</span> re = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>],
    im = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>];
miniFFT(re, im);
<span class="hljs-built_in">console</span>.log(re, im); <span class="hljs-comment">// [ 10, -2, -2, -2 ] [ 0, 2, 0, -2 ]</span>
</code></pre><p>Minified, it’s only 359 bytes. Unlike this <a href="https://gist.github.com/wrayal/995571">other contender</a> for the dubious prize of smallest javascript <span class="caps">FFT</span> implementation, it doesn’t require a special complex number library three times its size (though this doesn’t fit in a tweet— I’ll be really impressed if someone manages to do&nbsp;that). </p>
<p>I haven’t really golfed the code to the smallest size possible, but I think it’s at a reasonable balance of brevity while still being somewhat&nbsp;comprehensible.</p>
<p>It’s based on an in-place <span class="caps">FFT</span> from <a href="http://introcs.cs.princeton.edu/java/97data/InplaceFFT.java.html">Princeton’s intro <span class="caps">CS</span></a> class <a href="http://www.nayuki.io/res/free-small-fft-in-multiple-languages/fft.js">Project Nayuki’s <span class="caps">FFT</span></a>.</p>
<h2 id="miniifft">MiniIFFT</h2>
<p>Turns out that you can invert the <span class="caps">FFT</span> modulo a scaling factor just by swapping the real and imaginary&nbsp;arguments.</p>
<pre><code><span style='display:none' detected-language='matlab'></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">miniIFFT</span><span class="hljs-params">(re, im)</span>{</span>
    miniFFT(im, re);
    <span class="hljs-keyword">for</span>(var <span class="hljs-built_in">i</span> = <span class="hljs-number">0</span>, N = re.<span class="hljs-built_in">length</span>; <span class="hljs-built_in">i</span> &lt; N; <span class="hljs-built_in">i</span>++)<span class="hljs-cell">{
        im[i] /= N;
        re[i] /= N;
    }</span>
}
</code></pre><h2 id="minidct">MiniDCT</h2>
<p>This is an implementation of a Type-<span class="caps">II</span> DCT using MiniFFT. For details about Makhoul’s algorithm for transforming a DCT into an FFT, see <a href="http://dsp.stackexchange.com/a/10606">this&nbsp;post</a></p>
<pre><code><span style='display:none' detected-language='matlab'></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">miniDCT</span><span class="hljs-params">(s)</span>{</span>
    var N = s.<span class="hljs-built_in">length</span>,
        K = -Math.<span class="caps">PI</span> / (<span class="hljs-number">2</span> * N),
        re = new Float64Array(N),
        im = new Float64Array(N);
    <span class="hljs-keyword">for</span>(var <span class="hljs-built_in">i</span> = <span class="hljs-number">0</span>, <span class="hljs-built_in">j</span> = N; <span class="hljs-built_in">j</span> &gt; <span class="hljs-built_in">i</span>; <span class="hljs-built_in">i</span>++)<span class="hljs-cell">{
        re[i] = s[i * <span class="hljs-number">2</span>]
        re[--j] = s[i * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>]
    }</span>
    miniFFT(re, im)
    <span class="hljs-keyword">for</span>(var <span class="hljs-built_in">i</span> = <span class="hljs-number">0</span>; <span class="hljs-built_in">i</span> &lt; N; <span class="hljs-built_in">i</span>++)
        s<span class="hljs-matrix">[i]</span> = <span class="hljs-number">2</span>*re<span class="hljs-matrix">[i]</span>*Math.<span class="hljs-built_in">cos</span>(K*<span class="hljs-built_in">i</span>)-<span class="hljs-number">2</span>*im<span class="hljs-matrix">[i]</span>*Math.<span class="hljs-built_in">sin</span>(K*<span class="hljs-built_in">i</span>);
}
</code></pre><p>Like MiniFFT, it operates in-place (well, not really, but it writes its output to the source&nbsp;array).</p>
<pre><code><span style='display:none' detected-language='javascript'></span><span class="hljs-keyword">var</span> arr = [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">7</span>];
miniDCT(arr);
<span class="hljs-built_in">console</span>.log(arr); <span class="hljs-comment">// [ 30, -5.09493566, 7.0710678118, -8.604744653 ]</span>
</code></pre><p>It produces the same output as scipy’s fftpack, but Matlab’s <span class="caps">DCT</span> uses orthogonal normalization and produces a different result. However, it’s pretty simple to do it the Matlab way— just scale everything by 1/sqrt(2 * N) and divide the first element by&nbsp;sqrt(2).</p>
<pre><code><span style='display:none' detected-language='matlab'></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">matlabDCT</span><span class="hljs-params">(arr)</span>{</span>
    miniDCT(arr)
    arr<span class="hljs-matrix">[<span class="hljs-number">0</span>]</span> /= Math.<span class="hljs-built_in">sqrt</span>(<span class="hljs-number">2</span>);   
    <span class="hljs-keyword">for</span>(var <span class="hljs-built_in">i</span> = <span class="hljs-number">0</span>, N = arr.<span class="hljs-built_in">length</span>; <span class="hljs-built_in">i</span> &lt; N; <span class="hljs-built_in">i</span>++) arr<span class="hljs-matrix">[i]</span> /= Math.<span class="hljs-built_in">sqrt</span>(<span class="hljs-number">2</span> * N);
}
</code></pre><h2 id="miniidct">MiniIDCT</h2>
<p>I really considered renaming this series of functions into TinyFFT and friends because of the predicament of MiniIDCT— yeah, exactly— the horror— repeating&nbsp;I’s. </p>
<p>This is an implementation of a Type-<span class="caps">III</span> DCT, also known as the IDCT because it happens to be the inverse of a Type II DCT (frequently refered to as “<em>The</em>&nbsp;<span class="caps">DCT</span>”).  </p>
<pre><code><span style='display:none' detected-language='javascript'></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">miniIDCT</span><span class="hljs-params">(s)</span></span>{
    <span class="hljs-keyword">var</span> N = s.length,
        K = <span class="hljs-built_in">Math</span>.<span class="caps">PI</span> / (<span class="hljs-number">2</span> * N),
        im = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float64Array</span>(N),
        re = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float64Array</span>(N);
    re[<span class="hljs-number">0</span>] = s[<span class="hljs-number">0</span>] / N / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; N; i++){
        <span class="hljs-keyword">var</span> im2 = <span class="hljs-built_in">Math</span>.sin(i*K), re2 = <span class="hljs-built_in">Math</span>.cos(i*K);
        re[i] = (s[N - i] * im2 + s[i] * re2) / N / <span class="hljs-number">2</span>;
        im[i] = (im2 * s[i] - s[N - i] * re2) / N / <span class="hljs-number">2</span>;
    }
    miniFFT(im, re)
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; N / <span class="hljs-number">2</span>; i++){
        s[<span class="hljs-number">2</span> * i] = re[i]
        s[<span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>] = re[N - i - <span class="hljs-number">1</span>]
    }
}
</code></pre><p>This is based on Tom Grydeland’s <a href="http://www.idlcoyote.com/tip_examples/idct.pro"><span class="caps">IDL</span></a> implementation of the&nbsp;<span class="caps">IDCT</span>. </p>
<p>Let’s start with a 8 element array of real numbers (<span class="caps">DCT</span>&nbsp;values).</p>
<pre><code><span style='display:none' detected-language='json'></span>[A, B, C, D, E, F, G, H]
</code></pre><p>From that it generates the corresponding complex values. Note that the real part is intact, and the complex part is the original array with its head chopped off and the rest of it flipped around and attached to a water&nbsp;balloon. </p>
<pre><code><span style='display:none' detected-language='mathematica'></span>[A, B, <span class="hljs-keyword">C</span>, <span class="hljs-keyword">D</span>, <span class="hljs-keyword">E</span>, F, G, H] - j[<span class="hljs-number">0</span>, H, G, F, <span class="hljs-keyword">E</span>, <span class="hljs-keyword">D</span>, <span class="hljs-keyword">C</span>, B]
</code></pre><p>Then the complex values are rotated by <code>exp(i * pi / (2 * N))</code> to get spectral components. After an <span class="caps">IFFT</span> that gets transformed&nbsp;into:</p>
<pre><code><span style='display:none' detected-language='json'></span>[a, h, c, f, e, d, g, b]
</code></pre><p>It took me a while to see what was going on there, but the even indices are map to the first half of the results, and the odd ones map to the second half in&nbsp;reverse</p>
<pre><code><span style='display:none' detected-language='swift'></span><span class="hljs-type">Scrambled</span>      a h <span class="hljs-built_in">c</span> f e d g b
<span class="hljs-type">Even</span> <span class="hljs-type">Indexed</span>   a   <span class="hljs-built_in">c</span>   e   g
<span class="hljs-type">Odd</span> <span class="hljs-type">Indexed</span>      h   f   d   b
<span class="hljs-type">Odd</span> <span class="hljs-type">Reversed</span>     b   d   f   h
<span class="hljs-type">Unscrabmled</span>    a b <span class="hljs-built_in">c</span> d e f g h
</code></pre>
            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2014/02/february-progress-report/">February Progress Report</a> <span class="subtitle">28 February 2014</span></h2>
            </header>
            <section class="content"><blockquote>
<p><em>Work expands so as to fill the time available for its&nbsp;completion.</em></p>
<p>— Parkinson’s&nbsp;Law</p>
</blockquote>
<p>For the past four or so months, I’ve been working on just one major project. It’s rather depressing to think that I built a reasonably impressive initial prototype over the course of about a dozen sleep-deprived hours, and that all I’ve accomplished since then is minor polish. Technically, there have been at least two rewrites, completely new capabilities and substantially improved technology, but none of that really matters when it comes to describing the project. A project is what it is, at 80% completion, at 95% and&nbsp;99%.</p>
<p>Second semester at school has started, and that means that Pass/No Record isn’t a thing anymore, and everyone else is adjusting their behavior appropriately. Problem is, <em>I</em> haven’t changed. It turns out that an entire semester of racing toward the bottom is unsustainable when suddenly the floor has been adjusted to above your current position. But the more important point is that it’s leaving less time, and in particular, less contiguous time to work on&nbsp;anything.</p>
<p>Last month, I was working on a port of the Telea inpainting algorithm. Inpainting refers to any kind of image processing operation which attempts to intelligently fill in certain regions of an image with other content. Perhaps the most famous implementation of this is Photoshop’s Content Aware Fill feature, which uses a texture-synthesis and patch-based system, which enables them to copy over things like patterns, and textures, filling in vast contiguous regions of missing content. The problem is patch-based inpainting is almost always quite slow, in spite of its high quality results. There are simpler algorithms based on the Fast Marching Method like Telea or Navier-Stokes which use diffusion models and the ilk in order to propagate the solid colors of the bordering region of some inpainting mask inwards. I’ll write an actual blog post about this once I package it up and build a nifty demo for&nbsp;it.</p>
<p>Last year, Ben Kamens of Khan Academy posted about reverse engineering the flyout menu in Amazon, which suffered from the rather odd behavior of <em>acting exactly how it should</em>. You totally should be able to navigate to a submenu without worrying about accidentally mousing over something else. I looked around for a context menu library which could actually do this, but for some reason I couldn’t find one, so I decided to make my&nbsp;own.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2013/08/august-progress-report/">August Progress Report</a> <span class="subtitle">31 August 2013</span></h2>
            </header>
            <section class="content"><p>It must be infuriating to be in a situation where there’s a clear problem, and all the obvious remedies continually fail to produce any legitimate result. That’s what this blog is like: every month rolls by with some half baked ideas partially implemented and barely documented. And in the last day of the month, there’s a kind of panicked scramble to fulfill an entirely arbitrary self-enforced quota just to convince myself that I’m doing&nbsp;stuff.</p>
<p>Anyway, it’s pretty rare for me to be doing absolutely nothing, but mustering the effort to actually complete a project to an appreciable extent is pretty hard. This might be in some way indicative of a kind of shift in the type of projects that I try to work on- they’re generally somewhat larger in scope or otherwise more experimental. And while I may have been notorious before for not leaving projects at a well documented and completed state, these new ideas often languish much earlier in the development&nbsp;process.</p>
<p>There’s always pressure to present things only when they are complete and presentable, because after all timing is key and nothing can be more detrimental to an idea than ill-timed and poor execution. But at the same time, I think the point of this blog is to create a kind of virtual paper trail of an idea and how it evolves, regardless of whether or not it falters in its&nbsp;birth.</p>
<p>With that said, I’m going to create a somewhat brief list of projects and ideas that I’m currently experimenting with or simply have yet to publish a blog post&nbsp;for.</p>
<ul>
<li>One of the earlier entries of the backlog is a <span class="caps">HTML5</span> scramble with friends clone, acting highly performant on mobile with touch events and CSS animations while supporting keyboard based interaction on desktop. I’ve always been intending to build some kind of multiplayer real time server component so that people could compete in real time. Maybe at some point it’ll be included as a kind of mini game within&nbsp;protobowl.</li>
<li>The largest project is definitely Protobowl, which has just recently passed its one year anniversary of sorts. It’s rather odd that it hasn’t formally been given a post on this blog yet, but <em>c’est la vie</em>. Protobowl is hopefully on the verge of a rather large update which will add several oft-requested features, and maybe by then I’ll have completed something which is publishable as a blog&nbsp;post.</li>
<li>Font Interpolation/Typeface Gradients. I actually have no idea how long this has been on my todo list (years, no doubt), but the concept is actually rather nifty. With attributes like object size or color, things can be smoothly interpolated in the form of something like a gradient. The analogue for this kind of transition when applied to text would be the ability to type a word whose first letter is in one font, and the last letter being another font, with all the intermediate letters some kind of hybrid. I never did get quite far in successfully implementing it, so it may be a while until this sees the light of&nbsp;day.</li>
<li>I’ve always wanted to build a chrome extension with some amount of <span class="caps">OCR</span> or text detection capabilities so that people could select text which was embedded within an image as if it weren’t just an image. At one point I narrowed down the scope of this project so that the OCR part wasn’t even that important (the goal was then just some web worker threaded implementation of the stroke width transform algorithm and cleverly drawing some rotated boxes along with mouse movements). I haven’t had too much time to work on this so it hasn’t gone too far, but I do have a somewhat working prototype somewhere. This one too is several years&nbsp;old.</li>
<li>In the next few days, I plan on publishing a blog post I’ve been working on which is something of a humorous satire on some of the more controversial issues which have arisen this&nbsp;summer.</li>
<li>And there are several projects which have actually gotten blog posts which weren’t themselves formal announcements so much as a written version of my thinking process behind them. I haven’t actually finished the Pedant, in spite of the fact that the hardware is in theoretically something of a functional state (I remember that I built it with the intent that it could be cool to wear around during <span class="caps">MIT</span>’s CPW back in April, but classes start in a few days and it hasn’t progressed at all since). Probably one of the most promising ideas is the kind of improved, vectorized and modern approach to video lectures- but that too needs&nbsp;work.</li>
<li>I’m building the website for a local charity organization which was started by a childhood friend, and maybe I’ll publish a blog post if that ever gets deployed or&nbsp;something.</li>
</ul>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2008/08/controlling-a-native-app-from-a-javascript-desktop/">Controlling A Native App from a Javascript Desktop</a> <span class="subtitle">29 August 2008</span></h2>
            </header>
            <section class="content"><p>Well, I worked on a sort of <span class="caps">VNC</span>-like solution to controlling native desktop applications from a remote PC. It’s an interesting concept, I settled with something less than easy to use, and less than really feasable. It’s a Proof of concept, and it’s likely I won’t work on it again (Like&nbsp;ForkSwif).</p>
<p>It is an application (module) on a hacked Ext 2.0 Desktop example that uses Ajax (Polling) to query a local <span class="caps">PHP</span> proxy to query a remote desktop. The remote desktop is running some software (powered by .NET sadly…) that captures the window’s contents, does a diff to see if there are modifications and where (only sends updates to changed parts of the screen, sorta like VNC). It base64 encodes it and sends it along HTTP to the proxy, which sends it to the javascript&nbsp;client.</p>
<p>The client can send events to be repeated on the remote desktop, currently only left mousedown and mouseup (so, basically only clicking), but using the Keyboard should be easy&nbsp;enough.</p>
<p>I imagine that a more feasable option is to create a javascript X11 client, taking proxied connections to a X session under <span class="caps">SSH</span> so it is better with window-specificness, and an overall more stable platform, so you could also run multiple applications simultaneously on the&nbsp;desktop.</p>
<p>here’s an early&nbsp;screenshot:</p>
<p><div class="pic md" style="" ><img alt="Controlling A native desktop app from a javascript desktop"  src="/articles/2008/Controlling%20A%20Native%20App%20from%20a%20Javascript%20Desktop/jsvnc.png" ><div class="caption">Controlling A native desktop app from a javascript desktop</div></div> Controlling A native desktop app from a javascript desktop (early&nbsp;build)</p>
<p>Files&nbsp;here:</p>
<p><a href="/2008/misc/coolstuff.zip">http://antimatter15.110mb.com/misc/coolstuff.zip</a></p>
<p>Extract desktop2 to your Apache server, start Windows Calculator (or another app of your choosing). Run Screen.exe, type the app title, press “Get Handle” and check the “Run Server” box. Navigate to the desktop.html (on your <span class="caps">PHP</span>-enabled apache), and start the “NV Window”&nbsp;app.</p>
<p>To be able to control the app, you have to set it to your network ip (not localhost) on a <span class="caps">VM</span> or a different computer. and configure sample.js at line&nbsp;191.</p>
<pre><code><span style='display:none' detected-language='groovy'></span><span class="hljs-string">proxy:</span> <span class="hljs-string">"gdat.php?url="</span>,
<span class="hljs-string">updateurl :</span> <span class="hljs-string">"[http://localhost:12345](http://localhost:12345/)"</span>,
<span class="hljs-string">baseurl :</span> <span class="hljs-string">"[http://localhost:12345/base](http://localhost:12345/base)"</span>,
<span class="hljs-string">showimg :</span> <span class="hljs-literal">false</span>,
<span class="hljs-string">uinterval:</span> <span class="hljs-number">1000</span>,
<span class="hljs-string">updater:</span> <span class="hljs-literal">null</span>,
<span class="hljs-string">xoffset:</span> -<span class="hljs-number">8</span>,
<span class="hljs-string">yoffset:</span> -<span class="hljs-number">28</span>,
</code></pre><p>change localhost to the server’s <span class="caps">IP</span>. And tick “Control&nbsp;Desktop”</p>
<p>Note that you need&nbsp;firebug.</p>
<p>If i can think of a name for the app, i’ll be sure to creakte a google code project for it. so if anyone want’s the source, think of a name for&nbsp;it.</p>

            </section>
          </article>
          <hr>
          <div class="nav"><a href="/archive" class="newer">« Archives</a><a href="/page/1" class="next">Latest Posts »</a>
          </div>
        </div>
      </div>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-1367972-3', 'auto');
      ga('send', 'pageview');
      
    </script>
    <script>
      function squish(){
        document.getElementById("squishfoot").className += "squish"
      }
    </script>
    <style>
      .squish { font-size: 9px }
      .squishsquish { font-size: 8px }
      .squishsquishsquish { font-size: 7px }
      .squishsquishsquishsquish { font-size: 6px }
      .squishsquishsquishsquishsquish { font-size: 5px }
      .squishsquishsquishsquishsquishsquish { font-size: 4px }
      .squishsquishsquishsquishsquishsquishsquish { visibility: hidden }
    </style>
    <div class="graybar bottom">
      <footer>
        <div id="squishfoot">I'm a tiny footer, please don't <a href="javascript:squish()">squish</a> me</div>
      </footer>
    </div>
  </body>
</html>