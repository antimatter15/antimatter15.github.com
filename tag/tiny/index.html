<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" href="/feed.xml" type="application/rss+xml" title="somewhere to talk about ideas and projects and stuff like everyone else">
    <link rel="stylesheet" href="/style/main.css">
    <title>#tiny</title>
  </head>
  <body>
    <div class="whitebox">
      <div class="graybar top">
        <header class="top">
          <div class="slogan">somewhere to talk about random ideas and projects like everyone else</div><a href="/">
            <h1 class="logo">
              stuff
               <span class="byline">by antimatter15</span>
            </h1></a>
        </header>
      </div>
      <div id="main">
        <div class="sidebar">
          <div class="about">
            <p class="emph">
              Hi. I’m <b>Kevin Kwok</b>, and I’m currently a junior at <b>MIT</b>, 
              and this is my obligatory online presence or whatever.  
            </p>
            <p>This is my little corner of the internet, where I talk about random projects and ideas and stuff. </p>
            <p>If you want to contact me or read obnoxiously nostalgic autobiographical trivia, check out the <a href="/about"> about </a>section.</p>
          </div><br>
          <section class="archive"><a href="/archive">
              <h2>Archive</h2></a>
            <ul>
              <li>
                <ul>
                  <li><a href="/2015/12"><span class="month">December</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/08"><span class="month">August</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/06"><span class="month">June</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/05"><span class="month">May</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/04"><span class="month">April</span> <span class="year">2015</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2014/12"><span class="month">December</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/07"><span class="month">July</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/06"><span class="month">June</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/05"><span class="month">May</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/04"><span class="month">April</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/03"><span class="month">March</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/02"><span class="month">February</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/01"><span class="month">January</span> <span class="year">2014</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2013/12"><span class="month">December</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/11"><span class="month">November</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/10"><span class="month">October</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/09"><span class="month">September</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/08"><span class="month">August</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/07"><span class="month">July</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/06"><span class="month">June</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/05"><span class="month">May</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/04"><span class="month">April</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/03"><span class="month">March</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/02"><span class="month">February</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/01"><span class="month">January</span> <span class="year">2013</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2012/12"><span class="month">December</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/11"><span class="month">November</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/10"><span class="month">October</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/09"><span class="month">September</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/08"><span class="month">August</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/07"><span class="month">July</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/06"><span class="month">June</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/05"><span class="month">May</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/04"><span class="month">April</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/03"><span class="month">March</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/02"><span class="month">February</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/01"><span class="month">January</span> <span class="year">2012</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2011/12"><span class="month">December</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/11"><span class="month">November</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/10"><span class="month">October</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/09"><span class="month">September</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/08"><span class="month">August</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/07"><span class="month">July</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/06"><span class="month">June</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/05"><span class="month">May</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/04"><span class="month">April</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/03"><span class="month">March</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/02"><span class="month">February</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/01"><span class="month">January</span> <span class="year">2011</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2010/12"><span class="month">December</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/11"><span class="month">November</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/10"><span class="month">October</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/09"><span class="month">September</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/08"><span class="month">August</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/07"><span class="month">July</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/06"><span class="month">June</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/05"><span class="month">May</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/04"><span class="month">April</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/03"><span class="month">March</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/02"><span class="month">February</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/01"><span class="month">January</span> <span class="year">2010</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2009/12"><span class="month">December</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/11"><span class="month">November</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/10"><span class="month">October</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/09"><span class="month">September</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/08"><span class="month">August</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/07"><span class="month">July</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/06"><span class="month">June</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/05"><span class="month">May</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/04"><span class="month">April</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/03"><span class="month">March</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/01"><span class="month">January</span> <span class="year">2009</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2008/12"><span class="month">December</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/11"><span class="month">November</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/10"><span class="month">October</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/09"><span class="month">September</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/08"><span class="month">August</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/07"><span class="month">July</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/06"><span class="month">June</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/05"><span class="month">May</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/04"><span class="month">April</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/01"><span class="month">January</span> <span class="year">2008</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2007/12"><span class="month">December</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/11"><span class="month">November</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/10"><span class="month">October</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/09"><span class="month">September</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/08"><span class="month">August</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/05"><span class="month">May</span> <span class="year">2007</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2006/09"><span class="month">September</span> <span class="year">2006</span></a></li>
                  <li><a href="/2006/08"><span class="month">August</span> <span class="year">2006</span></a></li>
                </ul><br>
              </li>
            </ul>
          </section>
          <div class="tags">
            <h2>Tags</h2><a href="/tag/3D" style="font-size: 13px">3D </a><a href="/tag/actionscript" style="font-size: 11px">actionscript </a><a href="/tag/ajax" style="font-size: 20px">ajax </a><a href="/tag/ajax animator" style="font-size: 20px">ajax animator </a><a href="/tag/api" style="font-size: 13px">api </a><a href="/tag/apple" style="font-size: 20px">apple </a><a href="/tag/arduino" style="font-size: 11px">arduino </a><a href="/tag/art" style="font-size: 13px">art </a><a href="/tag/awesome" style="font-size: 13px">awesome </a><a href="/tag/blog" style="font-size: 19px">blog </a><a href="/tag/browser" style="font-size: 20px">browser </a><a href="/tag/bugfix" style="font-size: 15px">bugfix </a><a href="/tag/canvas" style="font-size: 15px">canvas </a><a href="/tag/change" style="font-size: 15px">change </a><a href="/tag/chrome" style="font-size: 20px">chrome </a><a href="/tag/code" style="font-size: 13px">code </a><a href="/tag/color" style="font-size: 11px">color </a><a href="/tag/colors" style="font-size: 11px">colors </a><a href="/tag/css" style="font-size: 11px">css </a><a href="/tag/design" style="font-size: 20px">design </a><a href="/tag/doge" style="font-size: 11px">doge </a><a href="/tag/elitist" style="font-size: 20px">elitist </a><a href="/tag/evil" style="font-size: 19px">evil </a><a href="/tag/experiment" style="font-size: 15px">experiment </a><a href="/tag/export" style="font-size: 11px">export </a><a href="/tag/extension" style="font-size: 20px">extension </a><a href="/tag/ExtJS" style="font-size: 20px">ExtJS </a><a href="/tag/fast" style="font-size: 20px">fast </a><a href="/tag/features" style="font-size: 15px">features </a><a href="/tag/firefox" style="font-size: 20px">firefox </a><a href="/tag/flash" style="font-size: 17px">flash </a><a href="/tag/format" style="font-size: 11px">format </a><a href="/tag/function" style="font-size: 13px">function </a><a href="/tag/future" style="font-size: 15px">future </a><a href="/tag/GAE" style="font-size: 13px">GAE </a><a href="/tag/github" style="font-size: 15px">github </a><a href="/tag/google" style="font-size: 20px">google </a><a href="/tag/google code" style="font-size: 11px">google code </a><a href="/tag/google wave" style="font-size: 20px">google wave </a><a href="/tag/graphics" style="font-size: 17px">graphics </a><a href="/tag/hacking" style="font-size: 11px">hacking </a><a href="/tag/hardware" style="font-size: 11px">hardware </a><a href="/tag/hosting" style="font-size: 19px">hosting </a><a href="/tag/html5" style="font-size: 19px">html5 </a><a href="/tag/idea" style="font-size: 13px">idea </a><a href="/tag/image" style="font-size: 11px">image </a><a href="/tag/internet exploder" style="font-size: 20px">internet exploder </a><a href="/tag/ipad" style="font-size: 17px">ipad </a><a href="/tag/javascript" style="font-size: 20px">javascript </a><a href="/tag/json" style="font-size: 15px">json </a><a href="/tag/library" style="font-size: 11px">library </a><a href="/tag/light" style="font-size: 11px">light </a><a href="/tag/lines" style="font-size: 13px">lines </a><a href="/tag/linux" style="font-size: 17px">linux </a><a href="/tag/login" style="font-size: 15px">login </a><a href="/tag/magical" style="font-size: 15px">magical </a><a href="/tag/meta" style="font-size: 13px">meta </a><a href="/tag/microsoft" style="font-size: 15px">microsoft </a><a href="/tag/microwave" style="font-size: 15px">microwave </a><a href="/tag/mirror" style="font-size: 11px">mirror </a><a href="/tag/mit" style="font-size: 11px">mit </a><a href="/tag/multitouch" style="font-size: 13px">multitouch </a><a href="/tag/new" style="font-size: 19px">new </a><a href="/tag/nostalgia" style="font-size: 11px">nostalgia </a><a href="/tag/ocr" style="font-size: 13px">ocr </a><a href="/tag/offline" style="font-size: 17px">offline </a><a href="/tag/old" style="font-size: 17px">old </a><a href="/tag/onlypaths" style="font-size: 17px">onlypaths </a><a href="/tag/pi" style="font-size: 19px">pi </a><a href="/tag/progress" style="font-size: 11px">progress </a><a href="/tag/prototype" style="font-size: 13px">prototype </a><a href="/tag/python" style="font-size: 20px">python </a><a href="/tag/raphael" style="font-size: 19px">raphael </a><a href="/tag/release" style="font-size: 13px">release </a><a href="/tag/rewrite" style="font-size: 13px">rewrite </a><a href="/tag/school" style="font-size: 15px">school </a><a href="/tag/security" style="font-size: 15px">security </a><a href="/tag/shiny" style="font-size: 20px">shiny </a><a href="/tag/ShinyTouch" style="font-size: 13px">ShinyTouch </a><a href="/tag/simple" style="font-size: 11px">simple </a><a href="/tag/site" style="font-size: 13px">site </a><a href="/tag/small" style="font-size: 20px">small </a><a href="/tag/speed" style="font-size: 11px">speed </a><a href="/tag/SVG" style="font-size: 15px">SVG </a><a href="/tag/touch" style="font-size: 13px">touch </a><a href="/tag/update" style="font-size: 20px">update </a><a href="/tag/upload" style="font-size: 17px">upload </a><a href="/tag/user interface" style="font-size: 11px">user interface </a><a href="/tag/vector" style="font-size: 13px">vector </a><a href="/tag/vectoreditor" style="font-size: 19px">vectoreditor </a><a href="/tag/version" style="font-size: 13px">version </a><a href="/tag/video" style="font-size: 15px">video </a><a href="/tag/vision" style="font-size: 11px">vision </a><a href="/tag/vp8" style="font-size: 11px">vp8 </a><a href="/tag/vX JS" style="font-size: 19px">vX JS </a><a href="/tag/wave" style="font-size: 20px">wave </a><a href="/tag/webcam" style="font-size: 11px">webcam </a><a href="/tag/wikify" style="font-size: 20px">wikify </a><a href="/tag/wikipedia" style="font-size: 17px">wikipedia </a><a href="/tag/wordpress" style="font-size: 20px">wordpress </a>
          </div>
        </div>
        <div id="content">
          <h1>#tiny</h1>
          <article class="article intro">
            <header>
              <h2><a href="/2015/05/cooley-tukey-fft-dct-idct-in-under-1k-of-javascript/">Cooley-Tukey FFT + DCT + IDCT in under 1K of Javascript</a> <span class="subtitle">30 May 2015</span></h2>
            </header>
            <section class="content"><p><div class="pic md right" style="width: 300px" ><img alt=""  src="/articles/2015/MiniFFT/hough-medium.jpg" ><div class="caption">Technically this is a Hough transform and isn&#39;t at all related to the <span class="caps">FFT</span>*, but it looks a lot cooler than any of the actual FFT/DCT pictures I have, so I might as well stick it here</div></div></p>
<p>Almost a year ago, I wrote a simple script for computing perceptual hashes in Javascript (it’s going to be part of a forthcoming Naptha feature which allows it recognize source images for memes and do perfect inpainting). One step of the process is computing the 2D Discrete Cosine Transform of a shrunken version of the&nbsp;image. </p>
<p>The problem is that step was kind of ridiculously slow, and it’s not really hard to see why: there’s a series of four nested for loops— because that’s the obvious naive way for computing the&nbsp;<span class="caps">DCT</span>. </p>
<p>In practice, it’s actually not all that bad because you only have to do it once per image, and the dimensions of the source image are a fixed 32x32. But it still felt pretty bad, so when I was looking over the code again earlier this week, I tried doing some research to figure out a faster way to do the&nbsp;<span class="caps">DCT</span>. </p>
<p>Surely you’d imagine that there have to be extraordinarily efficient implements of the <span class="caps">DCT</span> out there, given that it’s the very foundation of JPEG out there. And you’d be right, but they’ve generally unrolled the butterfly into a series of bit-shifts which are quite unlikely to generalize beyond the 8x8 block&nbsp;size. </p>
<p>I’m reasonably confident that <span class="caps">FFTW3</span> has a fast DCT implementation which also is capable of generalization, but it seems buried within quite a lot of&nbsp;code. </p>
<h2 id="minifft">MiniFFT</h2>
<p>This isn’t a super performant implementation, but it’s not horrendously slow and it doesn’t use recursion. It’s probably pretty trivial to make it quite a bit faster by precomputing sine and cosine tables. This uses the standard Cooley-Tukey radix-2 decimation-in-time algorithm, which means it only works for one dimensional arrays with a length which is a power of&nbsp;two. </p>
<p>It doesn’t check that the length is a power of two, it’ll just give you the wrong answer. You should definitely check that it’s true&nbsp;beforehand.</p>
<pre><code><span style='display:none' detected-language='javascript'></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">miniFFT</span><span class="hljs-params">(re, im)</span> </span>{
    <span class="hljs-keyword">var</span> N = re.length;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; N; i++) {
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>, h = i, k = N; k &gt;&gt;= <span class="hljs-number">1</span>; h &gt;&gt;= <span class="hljs-number">1</span>)
            j = (j &lt;&lt; <span class="hljs-number">1</span>) | (h <span class="amp">&amp;</span> <span class="hljs-number">1</span>);
        <span class="hljs-keyword">if</span> (j &gt; i) {
            re[j] = [re[i], re[i] = re[j]][<span class="hljs-number">0</span>]
            im[j] = [im[i], im[i] = im[j]][<span class="hljs-number">0</span>]
        }
    }
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> hN = <span class="hljs-number">1</span>; hN * <span class="hljs-number">2</span> &lt;= N; hN *= <span class="hljs-number">2</span>)
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; N; i += hN * <span class="hljs-number">2</span>)
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = i; j &lt; i + hN; j++) {
                <span class="hljs-keyword">var</span> cos = <span class="hljs-built_in">Math</span>.cos(<span class="hljs-built_in">Math</span>.<span class="caps">PI</span> * (j - i) / hN),
                    sin = <span class="hljs-built_in">Math</span>.sin(<span class="hljs-built_in">Math</span>.<span class="caps">PI</span> * (j - i) / hN)
                <span class="hljs-keyword">var</span> tre =  re[j+hN] * cos + im[j+hN] * sin,
                    tim = -re[j+hN] * sin + im[j+hN] * cos;
                re[j + hN] = re[j] - tre; im[j + hN] = im[j] - tim;
                re[j] += tre; im[j] += tim;
            }
}
</code></pre><p>The transformation happens in place, so it’ll modify whatever arrays you pass&nbsp;in. </p>
<pre><code><span style='display:none' detected-language='javascript'></span><span class="hljs-keyword">var</span> re = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>],
    im = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>];
miniFFT(re, im);
<span class="hljs-built_in">console</span>.log(re, im); <span class="hljs-comment">// [ 10, -2, -2, -2 ] [ 0, 2, 0, -2 ]</span>
</code></pre><p>Minified, it’s only 359 bytes. Unlike this <a href="https://gist.github.com/wrayal/995571">other contender</a> for the dubious prize of smallest javascript <span class="caps">FFT</span> implementation, it doesn’t require a special complex number library three times its size (though this doesn’t fit in a tweet— I’ll be really impressed if someone manages to do&nbsp;that). </p>
<p>I haven’t really golfed the code to the smallest size possible, but I think it’s at a reasonable balance of brevity while still being somewhat&nbsp;comprehensible.</p>
<p>It’s based on an in-place <span class="caps">FFT</span> from <a href="http://introcs.cs.princeton.edu/java/97data/InplaceFFT.java.html">Princeton’s intro <span class="caps">CS</span></a> class <a href="http://www.nayuki.io/res/free-small-fft-in-multiple-languages/fft.js">Project Nayuki’s <span class="caps">FFT</span></a>.</p>
<h2 id="miniifft">MiniIFFT</h2>
<p>Turns out that you can invert the <span class="caps">FFT</span> modulo a scaling factor just by swapping the real and imaginary&nbsp;arguments.</p>
<pre><code><span style='display:none' detected-language='matlab'></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">miniIFFT</span><span class="hljs-params">(re, im)</span>{</span>
    miniFFT(im, re);
    <span class="hljs-keyword">for</span>(var <span class="hljs-built_in">i</span> = <span class="hljs-number">0</span>, N = re.<span class="hljs-built_in">length</span>; <span class="hljs-built_in">i</span> &lt; N; <span class="hljs-built_in">i</span>++)<span class="hljs-cell">{
        im[i] /= N;
        re[i] /= N;
    }</span>
}
</code></pre><h2 id="minidct">MiniDCT</h2>
<p>This is an implementation of a Type-<span class="caps">II</span> DCT using MiniFFT. For details about Makhoul’s algorithm for transforming a DCT into an FFT, see <a href="http://dsp.stackexchange.com/a/10606">this&nbsp;post</a></p>
<pre><code><span style='display:none' detected-language='matlab'></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">miniDCT</span><span class="hljs-params">(s)</span>{</span>
    var N = s.<span class="hljs-built_in">length</span>,
        K = -Math.<span class="caps">PI</span> / (<span class="hljs-number">2</span> * N),
        re = new Float64Array(N),
        im = new Float64Array(N);
    <span class="hljs-keyword">for</span>(var <span class="hljs-built_in">i</span> = <span class="hljs-number">0</span>, <span class="hljs-built_in">j</span> = N; <span class="hljs-built_in">j</span> &gt; <span class="hljs-built_in">i</span>; <span class="hljs-built_in">i</span>++)<span class="hljs-cell">{
        re[i] = s[i * <span class="hljs-number">2</span>]
        re[--j] = s[i * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>]
    }</span>
    miniFFT(re, im)
    <span class="hljs-keyword">for</span>(var <span class="hljs-built_in">i</span> = <span class="hljs-number">0</span>; <span class="hljs-built_in">i</span> &lt; N; <span class="hljs-built_in">i</span>++)
        s<span class="hljs-matrix">[i]</span> = <span class="hljs-number">2</span>*re<span class="hljs-matrix">[i]</span>*Math.<span class="hljs-built_in">cos</span>(K*<span class="hljs-built_in">i</span>)-<span class="hljs-number">2</span>*im<span class="hljs-matrix">[i]</span>*Math.<span class="hljs-built_in">sin</span>(K*<span class="hljs-built_in">i</span>);
}
</code></pre><p>Like MiniFFT, it operates in-place (well, not really, but it writes its output to the source&nbsp;array).</p>
<pre><code><span style='display:none' detected-language='javascript'></span><span class="hljs-keyword">var</span> arr = [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">7</span>];
miniDCT(arr);
<span class="hljs-built_in">console</span>.log(arr); <span class="hljs-comment">// [ 30, -5.09493566, 7.0710678118, -8.604744653 ]</span>
</code></pre><p>It produces the same output as scipy’s fftpack, but Matlab’s <span class="caps">DCT</span> uses orthogonal normalization and produces a different result. However, it’s pretty simple to do it the Matlab way— just scale everything by 1/sqrt(2 * N) and divide the first element by&nbsp;sqrt(2).</p>
<pre><code><span style='display:none' detected-language='matlab'></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">matlabDCT</span><span class="hljs-params">(arr)</span>{</span>
    miniDCT(arr)
    arr<span class="hljs-matrix">[<span class="hljs-number">0</span>]</span> /= Math.<span class="hljs-built_in">sqrt</span>(<span class="hljs-number">2</span>);   
    <span class="hljs-keyword">for</span>(var <span class="hljs-built_in">i</span> = <span class="hljs-number">0</span>, N = arr.<span class="hljs-built_in">length</span>; <span class="hljs-built_in">i</span> &lt; N; <span class="hljs-built_in">i</span>++) arr<span class="hljs-matrix">[i]</span> /= Math.<span class="hljs-built_in">sqrt</span>(<span class="hljs-number">2</span> * N);
}
</code></pre><h2 id="miniidct">MiniIDCT</h2>
<p>I really considered renaming this series of functions into TinyFFT and friends because of the predicament of MiniIDCT— yeah, exactly— the horror— repeating&nbsp;I’s. </p>
<p>This is an implementation of a Type-<span class="caps">III</span> DCT, also known as the IDCT because it happens to be the inverse of a Type II DCT (frequently refered to as “<em>The</em>&nbsp;<span class="caps">DCT</span>”).  </p>
<pre><code><span style='display:none' detected-language='javascript'></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">miniIDCT</span><span class="hljs-params">(s)</span></span>{
    <span class="hljs-keyword">var</span> N = s.length,
        K = <span class="hljs-built_in">Math</span>.<span class="caps">PI</span> / (<span class="hljs-number">2</span> * N),
        im = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float64Array</span>(N),
        re = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float64Array</span>(N);
    re[<span class="hljs-number">0</span>] = s[<span class="hljs-number">0</span>] / N / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; N; i++){
        <span class="hljs-keyword">var</span> im2 = <span class="hljs-built_in">Math</span>.sin(i*K), re2 = <span class="hljs-built_in">Math</span>.cos(i*K);
        re[i] = (s[N - i] * im2 + s[i] * re2) / N / <span class="hljs-number">2</span>;
        im[i] = (im2 * s[i] - s[N - i] * re2) / N / <span class="hljs-number">2</span>;
    }
    miniFFT(im, re)
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; N / <span class="hljs-number">2</span>; i++){
        s[<span class="hljs-number">2</span> * i] = re[i]
        s[<span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>] = re[N - i - <span class="hljs-number">1</span>]
    }
}
</code></pre><p>This is based on Tom Grydeland’s <a href="http://www.idlcoyote.com/tip_examples/idct.pro"><span class="caps">IDL</span></a> implementation of the&nbsp;<span class="caps">IDCT</span>. </p>
<p>Let’s start with a 8 element array of real numbers (<span class="caps">DCT</span>&nbsp;values).</p>
<pre><code><span style='display:none' detected-language='json'></span>[A, B, C, D, E, F, G, H]
</code></pre><p>From that it generates the corresponding complex values. Note that the real part is intact, and the complex part is the original array with its head chopped off and the rest of it flipped around and attached to a water&nbsp;balloon. </p>
<pre><code><span style='display:none' detected-language='mathematica'></span>[A, B, <span class="hljs-keyword">C</span>, <span class="hljs-keyword">D</span>, <span class="hljs-keyword">E</span>, F, G, H] - j[<span class="hljs-number">0</span>, H, G, F, <span class="hljs-keyword">E</span>, <span class="hljs-keyword">D</span>, <span class="hljs-keyword">C</span>, B]
</code></pre><p>Then the complex values are rotated by <code>exp(i * pi / (2 * N))</code> to get spectral components. After an <span class="caps">IFFT</span> that gets transformed&nbsp;into:</p>
<pre><code><span style='display:none' detected-language='json'></span>[a, h, c, f, e, d, g, b]
</code></pre><p>It took me a while to see what was going on there, but the even indices are map to the first half of the results, and the odd ones map to the second half in&nbsp;reverse</p>
<pre><code><span style='display:none' detected-language='swift'></span><span class="hljs-type">Scrambled</span>      a h <span class="hljs-built_in">c</span> f e d g b
<span class="hljs-type">Even</span> <span class="hljs-type">Indexed</span>   a   <span class="hljs-built_in">c</span>   e   g
<span class="hljs-type">Odd</span> <span class="hljs-type">Indexed</span>      h   f   d   b
<span class="hljs-type">Odd</span> <span class="hljs-type">Reversed</span>     b   d   f   h
<span class="hljs-type">Unscrabmled</span>    a b <span class="hljs-built_in">c</span> d e f g h
</code></pre>
            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2008/10/can-anyone-beat-this/">Can Anyone Beat This?</a> <span class="subtitle">14 October 2008</span></h2>
            </header>
            <section class="content"><p>The original vX function was 337b. Now, it’s been reduced down to 293 bytes, while adding a new feature (callback is now&nbsp;optional).</p>
<tt>
X=function(u,f,p,x){x=window.ActiveXObject?new ActiveXObject(‘Microsoft.<span class="caps">XMLHTTP</span>’):new XMLHttpRequest();x.open(p?’POST’:’GET’,u,!0);p?x.setRequestHeader(‘Content-type’,’application/x-www-form-urlencoded’):p;x.onreadystatechange=function(){x.readyState==4?f?f(x.responseText,x):f:0};x.send(p)}</tt>

<p>Apparently, the above stuff doesn’t work&nbsp;(Wordpress?)</p>
<p>It’s really quite amazing. The big things that reduced size were using lots of condititional things, really obfuscated unreadable stuff, and using !0 instead of true, and !1 instead of&nbsp;false.</p>
<p>If you want to use it, try building your own copy&nbsp;from.</p>
<p><a href="http://vxjs.googlecode.com/svn/trunk/build.htm">http://vxjs.googlecode.com/svn/trunk/build.htm</a></p>
<p>The usage has signifigantly changed though, there, everything’s namespaced under an underscore, so it’s&nbsp;_.X(“url”)</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2008/04/today-s-tiny-updates/">Today's (Tiny) Updates</a> <span class="subtitle">30 April 2008</span></h2>
            </header>
            <section class="content"><p>Really, nothing much. There are some corrections to the About page, and some more icons. There is also a non-working Bug-Reporting&nbsp;tool.</p>
<p>I will try adding OnlyPaths soon, but it still needs much work. (and it’s Build 40&nbsp;now!!!)</p>

            </section>
          </article>
          <hr>
          <div class="nav"><a href="/archive" class="newer">« Archives</a><a href="/page/1" class="next">Latest Posts »</a>
          </div>
        </div>
      </div>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-1367972-3', 'auto');
      ga('send', 'pageview');
      
    </script>
    <script>
      function squish(){
        document.getElementById("squishfoot").className += "squish"
      }
    </script>
    <style>
      .squish { font-size: 9px }
      .squishsquish { font-size: 8px }
      .squishsquishsquish { font-size: 7px }
      .squishsquishsquishsquish { font-size: 6px }
      .squishsquishsquishsquishsquish { font-size: 5px }
      .squishsquishsquishsquishsquishsquish { font-size: 4px }
      .squishsquishsquishsquishsquishsquishsquish { visibility: hidden }
      .squishsquishsquishsquishsquishsquishsquish-with-some-good-css-by-omrelliug { }
    </style>
    <div class="graybar bottom">
      <footer>
        <div id="squishfoot">I'm a tiny footer, please don't <a href="javascript:squish()">squish</a> me</div>
      </footer>
    </div>
  </body>
</html>