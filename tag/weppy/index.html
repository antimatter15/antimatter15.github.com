<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" href="http://localhost:8080/feed.xml" type="application/rss+xml" title="somewhere to talk about ideas and projects and stuff like everyone else">
    <link rel="stylesheet" href="/style/main.css">
    <title>#weppy</title>
  </head>
  <body>
    <div class="whitebox">
      <div class="graybar top">
        <header class="top">
          <div class="slogan">somewhere to talk about random ideas and projects like everyone else</div><a href="/">
            <h1 class="logo">
              stuff
               <span class="byline">by antimatter15</span>
            </h1></a>
        </header>
      </div>
      <div id="main">
        <div class="sidebar">
          <div class="about">
            <p class="emph">
              Hi. I’m <b>Kevin Kwok</b>, and I’m currently a sophomore at <b>MIT</b>, 
              and this is my obligatory online presence or whatever.  
            </p>
            <p>
              I regularly updated this site from 2007, when I started it in elementary school, 
              to summer 2014, when it was unwittingly absorbed into an international phishing ring.
            </p>
            <p>
              But like a phoenix, hydra or the national deficit, the site is back 
              again bigger than ever (after a rather long gestation period).
            </p>
            <p>
              For more obnoxious autobiographical content 
              blended with bits of nostalgia for the old PHP-on-sketchy-free-webhosting days, click here.
            </p>
          </div><br>
          <section class="archive"><a href="/archive">
              <h2>Archive</h2></a>
            <ul>
              <li>
                <ul>
                  <li><a href="/2015/04"><span class="month">April</span> <span class="year">2015</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2014/05"><span class="month">May</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/04"><span class="month">April</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/03"><span class="month">March</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/02"><span class="month">February</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/01"><span class="month">January</span> <span class="year">2014</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2013/12"><span class="month">December</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/11"><span class="month">November</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/10"><span class="month">October</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/09"><span class="month">September</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/08"><span class="month">August</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/07"><span class="month">July</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/06"><span class="month">June</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/05"><span class="month">May</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/04"><span class="month">April</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/03"><span class="month">March</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/02"><span class="month">February</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/01"><span class="month">January</span> <span class="year">2013</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2012/12"><span class="month">December</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/11"><span class="month">November</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/10"><span class="month">October</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/09"><span class="month">September</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/08"><span class="month">August</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/07"><span class="month">July</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/06"><span class="month">June</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/05"><span class="month">May</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/04"><span class="month">April</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/03"><span class="month">March</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/02"><span class="month">February</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/01"><span class="month">January</span> <span class="year">2012</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2011/12"><span class="month">December</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/11"><span class="month">November</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/10"><span class="month">October</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/09"><span class="month">September</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/08"><span class="month">August</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/07"><span class="month">July</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/06"><span class="month">June</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/05"><span class="month">May</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/04"><span class="month">April</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/03"><span class="month">March</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/02"><span class="month">February</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/01"><span class="month">January</span> <span class="year">2011</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2010/12"><span class="month">December</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/11"><span class="month">November</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/10"><span class="month">October</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/09"><span class="month">September</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/08"><span class="month">August</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/07"><span class="month">July</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/06"><span class="month">June</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/05"><span class="month">May</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/04"><span class="month">April</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/03"><span class="month">March</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/02"><span class="month">February</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/01"><span class="month">January</span> <span class="year">2010</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2009/12"><span class="month">December</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/11"><span class="month">November</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/10"><span class="month">October</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/09"><span class="month">September</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/08"><span class="month">August</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/07"><span class="month">July</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/06"><span class="month">June</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/05"><span class="month">May</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/04"><span class="month">April</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/03"><span class="month">March</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/01"><span class="month">January</span> <span class="year">2009</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2008/12"><span class="month">December</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/11"><span class="month">November</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/10"><span class="month">October</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/09"><span class="month">September</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/08"><span class="month">August</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/07"><span class="month">July</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/06"><span class="month">June</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/05"><span class="month">May</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/04"><span class="month">April</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/01"><span class="month">January</span> <span class="year">2008</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2007/12"><span class="month">December</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/11"><span class="month">November</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/10"><span class="month">October</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/09"><span class="month">September</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/08"><span class="month">August</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/05"><span class="month">May</span> <span class="year">2007</span></a></li>
                </ul><br>
              </li>
            </ul>
          </section>
          <div class="tags">
            <h2>Tags</h2><a href="/tag/3D" style="font-size: 15px">3D </a><a href="/tag/ajax" style="font-size: 19.998766054240136px">ajax </a><a href="/tag/ajax animator" style="font-size: 19.99983298578152px">ajax animator </a><a href="/tag/api" style="font-size: 15px">api </a><a href="/tag/apple" style="font-size: 19.93307149075715px">apple </a><a href="/tag/art" style="font-size: 12.689414213699951px">art </a><a href="/tag/awesome" style="font-size: 15px">awesome </a><a href="/tag/blog" style="font-size: 17.31058578630005px">blog </a><a href="/tag/browser" style="font-size: 19.93307149075715px">browser </a><a href="/tag/bugfix" style="font-size: 17.31058578630005px">bugfix </a><a href="/tag/canvas" style="font-size: 15px">canvas </a><a href="/tag/change" style="font-size: 17.31058578630005px">change </a><a href="/tag/chrome" style="font-size: 19.999999998973813px">chrome </a><a href="/tag/chrome extension" style="font-size: 12.689414213699951px">chrome extension </a><a href="/tag/chrome os" style="font-size: 12.689414213699951px">chrome os </a><a href="/tag/chromebook" style="font-size: 12.689414213699951px">chromebook </a><a href="/tag/code" style="font-size: 15px">code </a><a href="/tag/color" style="font-size: 12.689414213699951px">color </a><a href="/tag/colors" style="font-size: 12.689414213699951px">colors </a><a href="/tag/css" style="font-size: 12.689414213699951px">css </a><a href="/tag/demo" style="font-size: 12.689414213699951px">demo </a><a href="/tag/design" style="font-size: 19.52574126822433px">design </a><a href="/tag/elitist" style="font-size: 19.820137900379084px">elitist </a><a href="/tag/evil" style="font-size: 19.52574126822433px">evil </a><a href="/tag/experiment" style="font-size: 15px">experiment </a><a href="/tag/extension" style="font-size: 19.820137900379084px">extension </a><a href="/tag/ExtJS" style="font-size: 19.820137900379084px">ExtJS </a><a href="/tag/facebook" style="font-size: 12.689414213699951px">facebook </a><a href="/tag/fast" style="font-size: 19.820137900379084px">fast </a><a href="/tag/features" style="font-size: 17.31058578630005px">features </a><a href="/tag/firefox" style="font-size: 19.975273768433652px">firefox </a><a href="/tag/flash" style="font-size: 18.807970779778824px">flash </a><a href="/tag/free" style="font-size: 12.689414213699951px">free </a><a href="/tag/function" style="font-size: 15px">function </a><a href="/tag/future" style="font-size: 17.31058578630005px">future </a><a href="/tag/GAE" style="font-size: 15px">GAE </a><a href="/tag/github" style="font-size: 17.31058578630005px">github </a><a href="/tag/google" style="font-size: 19.999999999999872px">google </a><a href="/tag/google code" style="font-size: 12.689414213699951px">google code </a><a href="/tag/google wave" style="font-size: 19.998766054240136px">google wave </a><a href="/tag/graphics" style="font-size: 15px">graphics </a><a href="/tag/hacking" style="font-size: 12.689414213699951px">hacking </a><a href="/tag/hosting" style="font-size: 19.52574126822433px">hosting </a><a href="/tag/html5" style="font-size: 19.52574126822433px">html5 </a><a href="/tag/idea" style="font-size: 15px">idea </a><a href="/tag/images" style="font-size: 12.689414213699951px">images </a><a href="/tag/interface" style="font-size: 12.689414213699951px">interface </a><a href="/tag/internet exploder" style="font-size: 19.820137900379084px">internet exploder </a><a href="/tag/ipad" style="font-size: 18.807970779778824px">ipad </a><a href="/tag/javascript" style="font-size: 19.99999999721053px">javascript </a><a href="/tag/json" style="font-size: 17.31058578630005px">json </a><a href="/tag/library" style="font-size: 12.689414213699951px">library </a><a href="/tag/lines" style="font-size: 15px">lines </a><a href="/tag/linux" style="font-size: 18.807970779778824px">linux </a><a href="/tag/login" style="font-size: 17.31058578630005px">login </a><a href="/tag/mac" style="font-size: 12.689414213699951px">mac </a><a href="/tag/magical" style="font-size: 17.31058578630005px">magical </a><a href="/tag/math" style="font-size: 12.689414213699951px">math </a><a href="/tag/meta" style="font-size: 12.689414213699951px">meta </a><a href="/tag/microsoft" style="font-size: 15px">microsoft </a><a href="/tag/microwave" style="font-size: 17.31058578630005px">microwave </a><a href="/tag/mirror" style="font-size: 12.689414213699951px">mirror </a><a href="/tag/mp3" style="font-size: 12.689414213699951px">mp3 </a><a href="/tag/multitouch" style="font-size: 15px">multitouch </a><a href="/tag/new" style="font-size: 19.52574126822433px">new </a><a href="/tag/nostalgia" style="font-size: 12.689414213699951px">nostalgia </a><a href="/tag/ocr" style="font-size: 12.689414213699951px">ocr </a><a href="/tag/offline" style="font-size: 18.807970779778824px">offline </a><a href="/tag/old" style="font-size: 18.807970779778824px">old </a><a href="/tag/onlypaths" style="font-size: 18.807970779778824px">onlypaths </a><a href="/tag/pi" style="font-size: 19.52574126822433px">pi </a><a href="/tag/player" style="font-size: 12.689414213699951px">player </a><a href="/tag/processing" style="font-size: 12.689414213699951px">processing </a><a href="/tag/prototype" style="font-size: 15px">prototype </a><a href="/tag/python" style="font-size: 19.93307149075715px">python </a><a href="/tag/raphael" style="font-size: 19.52574126822433px">raphael </a><a href="/tag/release" style="font-size: 15px">release </a><a href="/tag/rewrite" style="font-size: 15px">rewrite </a><a href="/tag/security" style="font-size: 15px">security </a><a href="/tag/shiny" style="font-size: 19.975273768433652px">shiny </a><a href="/tag/ShinyTouch" style="font-size: 15px">ShinyTouch </a><a href="/tag/site" style="font-size: 15px">site </a><a href="/tag/small" style="font-size: 19.52574126822433px">small </a><a href="/tag/speed" style="font-size: 12.689414213699951px">speed </a><a href="/tag/SVG" style="font-size: 17.31058578630005px">SVG </a><a href="/tag/touch" style="font-size: 15px">touch </a><a href="/tag/update" style="font-size: 19.999999943972036px">update </a><a href="/tag/upload" style="font-size: 18.807970779778824px">upload </a><a href="/tag/user interface" style="font-size: 12.689414213699951px">user interface </a><a href="/tag/vector" style="font-size: 15px">vector </a><a href="/tag/vectoreditor" style="font-size: 19.52574126822433px">vectoreditor </a><a href="/tag/version" style="font-size: 15px">version </a><a href="/tag/video" style="font-size: 17.31058578630005px">video </a><a href="/tag/vp8" style="font-size: 12.689414213699951px">vp8 </a><a href="/tag/vX JS" style="font-size: 19.52574126822433px">vX JS </a><a href="/tag/wave" style="font-size: 19.99999694097773px">wave </a><a href="/tag/webcam" style="font-size: 12.689414213699951px">webcam </a><a href="/tag/wikify" style="font-size: 19.820137900379084px">wikify </a><a href="/tag/wikipedia" style="font-size: 18.807970779778824px">wikipedia </a><a href="/tag/wordpress" style="font-size: 19.820137900379084px">wordpress </a>
          </div>
        </div>
        <div id="content">
          <h1>#weppy</h1>
          <article class="article intro">
            <header>
              <h2><a href="/2012/08/whammy-a-real-time-javascript-webm-encoder/">Whammy A Real Time Javascript WebM Encoder</a> <span class="subtitle">19 August 2012</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2012/Whammy%20A%20Real%20Time%20Javascript%20WebM%20Encoder/screenshot.png"><img src="/articles/2012/Whammy%20A%20Real%20Time%20Javascript%20WebM%20Encoder/screenshot.png" alt="" title="screenshot"></a></p>
<p>This is sort of a conceptual reversal (or not, this might just be making the description needlessly confusing) of one of my older projects,<a href="https://github.com/antimatter15/weppy">Weppy</a>. First, what Weppy did was it added support for WebP in browsers which didn’t support it by converting it into a single-frame video. This is instead predicated on the assumption that the browser already has support for WebP (at this point, it means it only works on Chrome since it’s the only browser which actually supports WebP), not only decoding WebP but encoding it as&nbsp;well.</p>
<p>The cool thing about WebP which was exploited in Weppy is that it’s actually based on the same codec as WebM, On2’s <span class="caps">VP8</span>. That means the actual image data, when the container formats are ignored, are virtually interchangable. With a catch: it’s intraframe&nbsp;only.</p>
<p>So it’s a video encoder in that it generates <code>.webm</code> files which should play in just about any program or device which supports the WebM format. But interframe compression is actually a fairly important thing which could reduce the file size by an order of magnitude or&nbsp;more.</p>
<p>But, there isn’t too much you can do on the client side in the ways of encoding stuff. And whatever you do, you basically can’t do interframe compression (aside from some really rudimentary delta encoding). More or less, when your only alternative is to maintain an array of DataURL encoded frames or encoding it (rather slowly) as a <a href="https://github.com/antimatter15/jsgif"><span class="caps">GIF</span></a>, a fast but inefficient WebM encoder stops looking too&nbsp;bad.</p>
<p>This was actually <a href="https://github.com/gengkev">Kevin Geng</a>‘s idea, and he contributed some code too, but in the end most of the code was just leftovers from&nbsp;Weppy.</p>
<h2 id="demo">Demo</h2>
<p><a href="http://antimatter15.github.com/whammy/clock.html">http://antimatter15.github.com/whammy/clock.html</a></p>
<h2 id="basic-usage">Basic&nbsp;Usage</h2>
<p>First, let’s include the <span class="caps">JS</span> file. It’s self contained and basically namespaced, which is pretty good I guess. And it’s not too big, minified it’s only about 4KB and gzipped, it’s under 2KB. That’s like really really&nbsp;tiny.</p>
<pre><code><span style='display:none' detected-language='vhdl'></span>&amp;lt;script src=<span class="hljs-string">"whammy.js"</span>&amp;gt;&amp;lt;/script&amp;gt; `&lt;/pre&gt;
The <span class="caps">API</span> isn<span class="hljs-attribute">'t</span> terrible either (at least, that<span class="hljs-attribute">'s</span> what I<span class="hljs-attribute">'d</span> like <span class="hljs-keyword">to</span> hope)
&lt;pre&gt;`var encoder = <span class="hljs-keyword">new</span> Whammy.Video(<span class="hljs-number">15</span>); `&lt;/pre&gt;
That `<span class="hljs-number">15</span>` over there <span class="hljs-keyword">is</span> the frame rate. There<span class="hljs-attribute">'s</span> a way <span class="hljs-keyword">to</span> set the individual duration <span class="hljs-keyword">of</span> each frame manually, but you can look <span class="hljs-keyword">in</span> the code <span class="hljs-keyword">for</span> that.
&lt;pre&gt;`encoder.add(<span class="hljs-keyword">context</span> <span class="hljs-keyword">or</span> canvas <span class="hljs-keyword">or</span> dataURL); `&lt;/pre&gt;
Here, you can add a frame, this happens fairly quickly because basically <span class="hljs-keyword">all</span> it<span class="hljs-attribute">'s</span> doing <span class="hljs-keyword">is</span> running `.toDataURL()` <span class="hljs-keyword">on</span> the canvas (which isn<span class="hljs-attribute">'t</span> exactly a speed-demon either, but it<span class="hljs-attribute">'s</span> acceptable enough most <span class="hljs-keyword">of</span> the <span class="hljs-typename">time</span>) <span class="hljs-keyword">and</span> plopping the result onto an <span class="hljs-keyword">array</span> (no computation <span class="hljs-keyword">or</span> anything). The actual encoding only happens <span class="hljs-keyword">when</span> you call `.compile()`
&lt;pre&gt;`var output = encoder.compile(); `&lt;/pre&gt;
Here, output <span class="hljs-keyword">is</span> set <span class="hljs-keyword">to</span> a Blob. <span class="hljs-keyword">In</span> order <span class="hljs-keyword">to</span> get a nice <span class="caps">URL</span> which you can <span class="hljs-keyword">use</span> <span class="hljs-keyword">to</span> stick <span class="hljs-keyword">in</span> a `&amp;lt;video&amp;gt;` element, you need <span class="hljs-keyword">to</span> send it over <span class="hljs-keyword">to</span>`createObjectURL`
&lt;pre&gt;`var url = (window.webkitURL || window.<span class="caps">URL</span>).createObjectURL(output); 
</code></pre><p>And you’re done.&nbsp;Awesome.</p>
<h2 id="documentation">Documentation</h2>
<p><code>Weppy.fromImageArray(image[], fps)</code> this is a simple function that takes a list of DataURL encoded frames and returns a WebM video. Note that the images have to all be encoded with&nbsp;WebP.</p>
<p><code>new Weppy.Video(optional fps, optional quality)</code> this is the constructor for the main <span class="caps">API</span>. quality only applies if you’re sending in contexts or canvas objects and doesn’t matter if you’re sending in encoded&nbsp;stuff</p>
<p><code>.add(canvas or context or dataURL, optional duration)</code> if fps isn’t specified in the constructor, you can stick a duration (in milliseconds)&nbsp;here.</p>
<h2 id="todo">Todo</h2>
<p>This pretty much works as well as it possibly could at this point. Maybe one day it should support WebWorkers or something, but unlike the <span class="caps">GIF</span> Encoder, it doesn’t actually require much real computation. So doing that probably wouldn’t net any performance benefits, especially since it can stitch together a 120-frame animation in like 20 milliseconds&nbsp;already.</p>
<p>But one of the sad things about it is that now it uses Blobs instead of strings, which is great and all except that blobs are actually slower than strings because it still has to do the DataURL conversion from string to Blob. That’s pretty lame. Firefox supports the canvas toBlob thing, but for some reason Chrome doesn’t, but eventually it probably might, and that might be useful to&nbsp;add.</p>
<p>Also, if someone ever makes a Javascript Vorbis encoder, it would be nice to integrate that in, since this currently only does the video part, but audio’s also a pretty big&nbsp;part.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/10/weppy-updates-opera-chrome-and-firefox-support-and-simpler-usage/">Weppy Updates Opera, Chrome and Firefox support and simpler usage</a> <span class="subtitle">09 October 2010</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2010/Weppy%20Updates%20Opera,%20Chrome%20and%20Firefox%20support%20and%20simpler%20usage/Screenshot-19.png"><img src="/articles/2010/Weppy%20Updates%20Opera,%20Chrome%20and%20Firefox%20support%20and%20simpler%20usage/Screenshot-19.png" alt="" title="Screenshot-19"></a></p>
<p>With help from <a href="http://twitter.com/Frenzie">@Frenzie</a> and <a href="http://twitter.com/#!/paul_irish/status/26829179917">@paul_irish</a>, the latest not-yet-versioned release of Weppy, my Javascript WebP to WebM conversion library, or something of a <a href="http://remysharp.com/2010/10/08/what-is-a-polyfill/">polyfill</a> for a format that is yet to be part of any specification (<a href="http://dev.w3.org/html5/spec/Overview.html#attr-img-src"><span class="caps">HTML5</span> seems to specifically reference</a> the image src attribute are examples such as <span class="caps">PNG</span>, GIF, JPEG, APNG, PDF, XML, SVG, SMIL, and MNG). The new release brings some awesome new features that really don’t change much and shouldn’t really be used in the real world because most browsers in the world still aren’t Firefox, Chrome or Opera - that is, a large portion of the browser market includes browsers like Safari and IE, either suffering from antiquity (IE6! aah!) or just liking h264 (IE9 +&nbsp;Safari).</p>
<p>The new release supports Opera. I never bothered debugging Opera, I figured it was another huge issue that would demand a rewrite (as supporting Firefox had needed, because the order of the object keys isn’t preserved and breaks the <span class="caps">EBML</span> result, or at least for Firefox’s parser which seems to be somewhat stricter than Chrome’s, is that ffmpeg?). And after premature optimization (stripping “unnecessary” EBML tags), my code didn’t work in chrome, so I had to revert to an earlier revision. All my testing code was based on file drag-drop stuff, and Opera doesn’t support that. Until I saw this <a href="http://forums.mozillazine.org/viewtopic.php?p=9991409#p9991409">mozillazine topic</a>, I didn’t care, but it was a lot easier to fix than I&nbsp;feared.</p>
<p>Part of the solution was getting rid of the canvas stage. Admittedly, the canvas stage was pretty useless once the toDataURL() stage was removed before the first public release, but I didn’t feel like deleting code, so it stayed there. Also, I noticed that the global variable that gets introduced was accidentally named “WebM”, which is wrong, it should be “WebP”, but because of the uncreative format naming and similarities, I didn’t notice. Not sure, but it seems to be more stable&nbsp;now.</p>
<p>Chrome probably will add WebP soon, and it needs to be future proof, detecting whether or not a browser supports the WebP format. To do that, it creates an Image, sets the src to a data url of a 4x4 webp image and listens to the onload and onerror events, checking if the size is correct and there were no errors loading it. The routine is expected to error and totally untested as there aren’t any browsers that support the feature yet for me to&nbsp;try.</p>
<p>Another change, is that by default, it will automatically load all the same-origin (because of the limitations of <span class="caps">XHR</span>) webp images (from &lt;img&gt; tags), on the DOMContentLoaded event, so the library is practically drop-in now. In any web page, you can pretty much add &lt;script src=”<a href="http://antimatter15.github.com/weppy/weppy.js">http://antimatter15.github.com/weppy/weppy.js</a>“&gt;&lt;/script&gt; and on the supported browsers, it should automatically load and replace all WebP images, though not something I would really&nbsp;recommended.</p>
<p>The demo is the same place it always was: <a href="http://antimatter15.github.com/weppy/demo.html">http://antimatter15.github.com/weppy/demo.html</a></p>
<p>There is also this nifty hack that uses &lt;canvas&gt; to add an alpha channel to the WebP image (adapted from the <a href="http://blog.jackadam.net/2010/alpha-jpegs/">original <span class="caps">JPEG</span></a> one): <a href="http://antimatter15.github.com/weppy/alpha/alpha.html">http://antimatter15.github.com/weppy/alpha/alpha.html</a></p>
<p>Also, please follow me<a href="http://twitter.com/antimatter15"> on twitter</a>.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/10/weppy-javascript-shim-for-webp-on-chrome-6-and-firefox-4-0/">Weppy Javascript Shim for WebP on Chrome 6 and Firefox 4.0</a> <span class="subtitle">03 October 2010</span></h2>
            </header>
            <section class="content"><p><a href="http://antimatter15.github.com/weppy/demo.html"><img src="/articles/2010/Weppy%20Javascript%20Shim%20for%20WebP%20on%20Chrome%206%20and%20Firefox%204.0/Screenshot-14.png" alt="" title="Screenshot-14"></a></p>
<p><strong>WebP </strong><a href="http://code.google.com/speed/webp/">http://code.google.com/speed/webp/</a></p>
<p>Recently, Google announced a new lossy image compression codec, named WebP, intended to supersede <span class="caps">JPEG</span>. It is based on VP8’s intraframe compression algorithm. It’s not natively supported in any browsers yet. Weppy is a compatibility layer that changes WebP files into WebM files that can be loaded on several modern&nbsp;browsers.</p>
<p><strong>How does it&nbsp;work?</strong></p>
<p>WebP is actually a lightweight container for a single <span class="caps">VP8</span> frame (whereas WebM is a container based off Matroska meant for video). WebM support exists already in Chrome, Firefox and Opera, so all that’s needed to render it is to do a little magic to convert the RIFF encoded WebP image into a EBML/Matroska encoded single frame WebM video, loading it in a , using drawImage() on a  and replacing the .webp image with the data URL extracted from the  using toDataURL().
<strong>&nbsp;Issues</strong></p>
<ul>
<li>Chrome (on linux anyway) tends to crash a&nbsp;lot.</li>
<li>Firefox throws a security exception when doing toDataURL() on a canvas after drawImage() of a video loaded from a data url. The hack being used it to replace the image node with the actual canvas&nbsp;instance.</li>
<li>Opera doesn’t work. I don’t really have the time to investigate.
<strong> What&nbsp;Browsers?</strong></li>
</ul>
<p>Chrome 7.0 and Firefox 4.0 were both tested. Opera doesn’t work for reasons that I’m not sure about. I would appreciate it if someone fixes it and submits a patch&nbsp;:)</p>
<p><strong>Demo</strong></p>
<p><a href="http://antimatter15.github.com/weppy/demo.html">http://antimatter15.github.com/weppy/demo.html</a></p>

            </section>
          </article>
          <hr>
          <div class="nav"><a href="/archive" class="newer">« Archives</a><a href="/page/1" class="next">Latest Posts »</a>
          </div>
        </div>
      </div>
    </div>
    <script>
      function squish(){
        document.getElementById("squishfoot").className += "squish"
      }
    </script>
    <style>
      .squish { font-size: 9px }
      .squishsquish { font-size: 8px }
      .squishsquishsquish { font-size: 7px }
      .squishsquishsquishsquish { font-size: 6px }
      .squishsquishsquishsquishsquish { font-size: 5px }
      .squishsquishsquishsquishsquishsquish { font-size: 4px }
      .squishsquishsquishsquishsquishsquishsquish { visibility: hidden }
    </style>
    <div class="graybar bottom">
      <footer>
        <div id="squishfoot">I'm a tiny footer, please don't <a href="javascript:squish()">squish</a> me</div>
      </footer>
    </div>
  </body>
</html>