<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" href="/feed.xml" type="application/rss+xml" title="somewhere to talk about ideas and projects and stuff like everyone else">
    <link rel="stylesheet" href="/style/main.css">
    <title>#api</title>
  </head>
  <body>
    <div class="whitebox">
      <div class="graybar top">
        <header class="top">
          <div class="slogan">somewhere to talk about random ideas and projects like everyone else</div><a href="/">
            <h1 class="logo">
              stuff
               <span class="byline">by antimatter15</span>
            </h1></a>
        </header>
      </div>
      <div id="main">
        <div class="sidebar">
          <div class="about">
            <p class="emph">
              Hi. I’m <b>Kevin Kwok</b>, and I’m currently a junior at <b>MIT</b>, 
              and this is my obligatory online presence or whatever.  
            </p>
            <p>This is my little corner of the internet, where I talk about random projects and ideas and stuff. </p>
            <p>If you want to contact me or read obnoxiously nostalgic autobiographical trivia, check out the <a href="/about"> about </a>section.</p>
          </div><br>
          <section class="archive"><a href="/archive">
              <h2>Archive</h2></a>
            <ul>
              <li>
                <ul>
                  <li><a href="/2015/12"><span class="month">December</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/08"><span class="month">August</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/06"><span class="month">June</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/05"><span class="month">May</span> <span class="year">2015</span></a></li>
                  <li><a href="/2015/04"><span class="month">April</span> <span class="year">2015</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2014/12"><span class="month">December</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/07"><span class="month">July</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/06"><span class="month">June</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/05"><span class="month">May</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/04"><span class="month">April</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/03"><span class="month">March</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/02"><span class="month">February</span> <span class="year">2014</span></a></li>
                  <li><a href="/2014/01"><span class="month">January</span> <span class="year">2014</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2013/12"><span class="month">December</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/11"><span class="month">November</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/10"><span class="month">October</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/09"><span class="month">September</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/08"><span class="month">August</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/07"><span class="month">July</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/06"><span class="month">June</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/05"><span class="month">May</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/04"><span class="month">April</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/03"><span class="month">March</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/02"><span class="month">February</span> <span class="year">2013</span></a></li>
                  <li><a href="/2013/01"><span class="month">January</span> <span class="year">2013</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2012/12"><span class="month">December</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/11"><span class="month">November</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/10"><span class="month">October</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/09"><span class="month">September</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/08"><span class="month">August</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/07"><span class="month">July</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/06"><span class="month">June</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/05"><span class="month">May</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/04"><span class="month">April</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/03"><span class="month">March</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/02"><span class="month">February</span> <span class="year">2012</span></a></li>
                  <li><a href="/2012/01"><span class="month">January</span> <span class="year">2012</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2011/12"><span class="month">December</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/11"><span class="month">November</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/10"><span class="month">October</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/09"><span class="month">September</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/08"><span class="month">August</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/07"><span class="month">July</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/06"><span class="month">June</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/05"><span class="month">May</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/04"><span class="month">April</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/03"><span class="month">March</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/02"><span class="month">February</span> <span class="year">2011</span></a></li>
                  <li><a href="/2011/01"><span class="month">January</span> <span class="year">2011</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2010/12"><span class="month">December</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/11"><span class="month">November</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/10"><span class="month">October</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/09"><span class="month">September</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/08"><span class="month">August</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/07"><span class="month">July</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/06"><span class="month">June</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/05"><span class="month">May</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/04"><span class="month">April</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/03"><span class="month">March</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/02"><span class="month">February</span> <span class="year">2010</span></a></li>
                  <li><a href="/2010/01"><span class="month">January</span> <span class="year">2010</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2009/12"><span class="month">December</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/11"><span class="month">November</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/10"><span class="month">October</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/09"><span class="month">September</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/08"><span class="month">August</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/07"><span class="month">July</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/06"><span class="month">June</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/05"><span class="month">May</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/04"><span class="month">April</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/03"><span class="month">March</span> <span class="year">2009</span></a></li>
                  <li><a href="/2009/01"><span class="month">January</span> <span class="year">2009</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2008/12"><span class="month">December</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/11"><span class="month">November</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/10"><span class="month">October</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/09"><span class="month">September</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/08"><span class="month">August</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/07"><span class="month">July</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/06"><span class="month">June</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/05"><span class="month">May</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/04"><span class="month">April</span> <span class="year">2008</span></a></li>
                  <li><a href="/2008/01"><span class="month">January</span> <span class="year">2008</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2007/12"><span class="month">December</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/11"><span class="month">November</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/10"><span class="month">October</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/09"><span class="month">September</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/08"><span class="month">August</span> <span class="year">2007</span></a></li>
                  <li><a href="/2007/05"><span class="month">May</span> <span class="year">2007</span></a></li>
                </ul><br>
              </li>
              <li>
                <ul>
                  <li><a href="/2006/09"><span class="month">September</span> <span class="year">2006</span></a></li>
                  <li><a href="/2006/08"><span class="month">August</span> <span class="year">2006</span></a></li>
                </ul><br>
              </li>
            </ul>
          </section>
          <div class="tags">
            <h2>Tags</h2><a href="/tag/3D" style="font-size: 13px">3D </a><a href="/tag/actionscript" style="font-size: 11px">actionscript </a><a href="/tag/ajax" style="font-size: 20px">ajax </a><a href="/tag/ajax animator" style="font-size: 20px">ajax animator </a><a href="/tag/api" style="font-size: 13px">api </a><a href="/tag/apple" style="font-size: 20px">apple </a><a href="/tag/arduino" style="font-size: 11px">arduino </a><a href="/tag/art" style="font-size: 13px">art </a><a href="/tag/awesome" style="font-size: 13px">awesome </a><a href="/tag/blog" style="font-size: 19px">blog </a><a href="/tag/browser" style="font-size: 20px">browser </a><a href="/tag/bugfix" style="font-size: 15px">bugfix </a><a href="/tag/canvas" style="font-size: 15px">canvas </a><a href="/tag/change" style="font-size: 15px">change </a><a href="/tag/chrome" style="font-size: 20px">chrome </a><a href="/tag/code" style="font-size: 13px">code </a><a href="/tag/color" style="font-size: 11px">color </a><a href="/tag/colors" style="font-size: 11px">colors </a><a href="/tag/css" style="font-size: 11px">css </a><a href="/tag/design" style="font-size: 20px">design </a><a href="/tag/doge" style="font-size: 11px">doge </a><a href="/tag/elitist" style="font-size: 20px">elitist </a><a href="/tag/evil" style="font-size: 19px">evil </a><a href="/tag/experiment" style="font-size: 15px">experiment </a><a href="/tag/export" style="font-size: 11px">export </a><a href="/tag/extension" style="font-size: 20px">extension </a><a href="/tag/ExtJS" style="font-size: 20px">ExtJS </a><a href="/tag/fast" style="font-size: 20px">fast </a><a href="/tag/features" style="font-size: 15px">features </a><a href="/tag/firefox" style="font-size: 20px">firefox </a><a href="/tag/flash" style="font-size: 17px">flash </a><a href="/tag/format" style="font-size: 11px">format </a><a href="/tag/function" style="font-size: 13px">function </a><a href="/tag/future" style="font-size: 15px">future </a><a href="/tag/GAE" style="font-size: 13px">GAE </a><a href="/tag/github" style="font-size: 15px">github </a><a href="/tag/google" style="font-size: 20px">google </a><a href="/tag/google code" style="font-size: 11px">google code </a><a href="/tag/google wave" style="font-size: 20px">google wave </a><a href="/tag/graphics" style="font-size: 17px">graphics </a><a href="/tag/hacking" style="font-size: 11px">hacking </a><a href="/tag/hardware" style="font-size: 11px">hardware </a><a href="/tag/hosting" style="font-size: 19px">hosting </a><a href="/tag/html5" style="font-size: 19px">html5 </a><a href="/tag/idea" style="font-size: 13px">idea </a><a href="/tag/image" style="font-size: 11px">image </a><a href="/tag/internet exploder" style="font-size: 20px">internet exploder </a><a href="/tag/ipad" style="font-size: 17px">ipad </a><a href="/tag/javascript" style="font-size: 20px">javascript </a><a href="/tag/json" style="font-size: 15px">json </a><a href="/tag/library" style="font-size: 11px">library </a><a href="/tag/light" style="font-size: 11px">light </a><a href="/tag/lines" style="font-size: 13px">lines </a><a href="/tag/linux" style="font-size: 17px">linux </a><a href="/tag/login" style="font-size: 15px">login </a><a href="/tag/magical" style="font-size: 15px">magical </a><a href="/tag/meta" style="font-size: 13px">meta </a><a href="/tag/microsoft" style="font-size: 15px">microsoft </a><a href="/tag/microwave" style="font-size: 15px">microwave </a><a href="/tag/mirror" style="font-size: 11px">mirror </a><a href="/tag/mit" style="font-size: 11px">mit </a><a href="/tag/multitouch" style="font-size: 13px">multitouch </a><a href="/tag/new" style="font-size: 19px">new </a><a href="/tag/nostalgia" style="font-size: 11px">nostalgia </a><a href="/tag/ocr" style="font-size: 13px">ocr </a><a href="/tag/offline" style="font-size: 17px">offline </a><a href="/tag/old" style="font-size: 17px">old </a><a href="/tag/onlypaths" style="font-size: 17px">onlypaths </a><a href="/tag/pi" style="font-size: 19px">pi </a><a href="/tag/progress" style="font-size: 11px">progress </a><a href="/tag/prototype" style="font-size: 13px">prototype </a><a href="/tag/python" style="font-size: 20px">python </a><a href="/tag/raphael" style="font-size: 19px">raphael </a><a href="/tag/release" style="font-size: 13px">release </a><a href="/tag/rewrite" style="font-size: 13px">rewrite </a><a href="/tag/school" style="font-size: 15px">school </a><a href="/tag/security" style="font-size: 15px">security </a><a href="/tag/shiny" style="font-size: 20px">shiny </a><a href="/tag/ShinyTouch" style="font-size: 13px">ShinyTouch </a><a href="/tag/simple" style="font-size: 11px">simple </a><a href="/tag/site" style="font-size: 13px">site </a><a href="/tag/small" style="font-size: 20px">small </a><a href="/tag/speed" style="font-size: 11px">speed </a><a href="/tag/SVG" style="font-size: 15px">SVG </a><a href="/tag/touch" style="font-size: 13px">touch </a><a href="/tag/update" style="font-size: 20px">update </a><a href="/tag/upload" style="font-size: 17px">upload </a><a href="/tag/user interface" style="font-size: 11px">user interface </a><a href="/tag/vector" style="font-size: 13px">vector </a><a href="/tag/vectoreditor" style="font-size: 19px">vectoreditor </a><a href="/tag/version" style="font-size: 13px">version </a><a href="/tag/video" style="font-size: 15px">video </a><a href="/tag/vision" style="font-size: 11px">vision </a><a href="/tag/vp8" style="font-size: 11px">vp8 </a><a href="/tag/vX JS" style="font-size: 19px">vX JS </a><a href="/tag/wave" style="font-size: 20px">wave </a><a href="/tag/webcam" style="font-size: 11px">webcam </a><a href="/tag/wikify" style="font-size: 20px">wikify </a><a href="/tag/wikipedia" style="font-size: 17px">wikipedia </a><a href="/tag/wordpress" style="font-size: 20px">wordpress </a>
          </div>
        </div>
        <div id="content">
          <h1>#api</h1>
          <article class="article intro">
            <header>
              <h2><a href="/2012/05/visualizing-facebook-activity/">Visualizing Facebook Activity</a> <span class="subtitle">29 May 2012</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2012/Visualizing%20Facebook%20Activity/392722_2010404474880_380090264_n.jpg"><div class="pic md" style="" ><img alt=""  src="/articles/2012/Visualizing%20Facebook%20Activity/392722_2010404474880_380090264_n-300x300.jpg" ><div class="caption">392722_2010404474880_380090264_n</div></div></a></p>
<p>You might have noticed that I haven’t written much for this blog in the past few months. In truth, it’s because of school work, which has never really been something of an issue before. This is, quite probably the least productive stretch of time in my life thus far. I have a suspicion that this issue stems more psychologically than due to some radical increase in work load, but I haven’t looked in to testing that hypothesis (I’ve been collecting data hour-by-hour about what I’ve been doing in the past two years, so I could probably look into it if I were actually interested in that matter). But school’s nearing a close, and hopefully I can get back to a more productive lifestyle, maintaining my blog and most importantly, trying out cool things. I have a few things which I am working on at the moment which should be completed in the coming weeks (though I make no assurances). But since I have an internal goal for writing one blog post per month, I’m going to recycle a project from December of&nbsp;2011.</p>
<p>Nearly every day, I inevitably end up glancing at my Facebook “buddy list” of sorts, wondering how many people are online. It’s a figure which almost always seems to depend on the time of day, and behaves almost like clockwork, there’s always a massive swarm of people online around 10-11pm, and hardly anyone is ever online at 4 in the morning. I guess the problem with drawing any conclusions from this in particular is how specific a group this graphic represents. It constitutes my friends, and in particular, my Facebook friends. Essentially all of them are people I’ve encountered in real life, and may or may not actually find interest in. But the thing that unites just about everyone is that they’re generally high school&nbsp;aged.</p>
<p>Before going on discussing how pretty of a chart this is, I think it’s worth going through what this chart actually represents. It’s quite easy to tell that this is in fact a polar chart, and on the inner circle, you can tell that it’s a 24 hour clock. Each of the rings represents a friend, and the rings are sorted by the total amount of time spent on Facebook in the given period. So you can see that toward the middle, the graph is almost opaque at every time, whereas on the fringes, the online activity is quite erratic and&nbsp;infrequent.</p>
<p>So, where does this data come from? It’s actually quite simple to get from the Facebook <span class="caps">API</span>. I have a cron job which runs every minute to run a FQL request and save the results to a specific log&nbsp;file.</p>
<script src="https://gist.github.com/2828107.js?file=download.sh"></script>

<p>The actual <span class="caps">FQL</span> which runs in order to retrieve the list of online users&nbsp;is</p>
<blockquote>
<p><span class="caps">SELECT</span> uid, name, online_presence FROM user  WHERE online_presence IN (‘active’, ‘idle’) AND uid IN (SELECT uid2 FROM friend WHERE uid1 =&nbsp;me())</p>
</blockquote>
<p>Basically, get the User <span class="caps">ID</span>, the name, and their online presence state for friends who are either active or idle in the list of the logged-in user. Since Facebook is an OAuth2-type API, you need an access token in order to do anything cool. I just use the <a href="https://developers.facebook.com/tools/explorer/145634995501895/?method=GET&amp;path=1686802955">Facebook Graph <span class="caps">API</span> Explorer</a> to generate my access tokens. Just go press “Get Access Token”, and select (at minimum) the permissions “user_online_presence”, “friends_online_presence” and “offline_access”. Then copy and paste the revealed token into some <tt>authkey.txt</tt> and you should be&nbsp;set.</p>
<p>I have a python script to go through the log file and to render it as the polar chart which is depicted on the top of the page. The code used for that is frankly atrocious and the output is even more so. Python Imaging Library is used, which is a lovely library, except not for drawing graphics. There isn’t any smoothing or anti-aliasing on the arcs drawn by <span class="caps">PIL</span> and they all look hideous. So I render the chart at some absurdly high resolution and down-resize it in GIMP while adding layering, blurs and opacity in order to make the picture somewhat less atrocious. Also, it does’t support restricting the app to drawing a specific day of the week, even though it might be interesting to see the how the trend differs on a weekday versus&nbsp;weekend.</p>
<p>Something interesting about the appearance of the polar graph is that it almost resembles something of a digital fingerprint, and that brings up some interesting privacy considerations. Inside that graphic are the Facebook browsing habits of some two hundred people. There’s the question of how much this changes day by day for users, and to what extent this can be used to identify people. And even if a single ring doesn’t unambiguously represent a single person, the two hundred or so rings of their friends probably goes pretty far into identifying people. There’s also a striking amount of uniformity that says a lot about the type of people who I tend to associate with. Just at a glance, one can tell that there are very few people I’m friends with on Facebook who live in different timezones. Maybe what’s more dangerous than being able to identify a person is to be able to identify what kind of groups that person belongs to. And over the course of a day, just about everyone checks Facebook a few&nbsp;times. </p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2011/09/schedule-compare/">Schedule Compare</a> <span class="subtitle">02 September 2011</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2011/Schedule%20Compare/Schedule-Compare1.png"><div class="pic md" style="" ><img alt=""  src="/articles/2011/Schedule%20Compare/Schedule-Compare1.png" ><div class="caption">Schedule Compare</div></div></a></p>
<p>Posting this here is almost certainly useless. I assume very very few people who read this blog tend to be in the target <strong>13-18 year old facebook-using high school student demographic</strong>. By the unlikely chance you are (if you aren’t, you can forward this to the nearest person who fits into this demographic, as I will add later, that I’m desperately looking for&nbsp;users).</p>
<p>It’s that time of year. The brief window where summer vacation isn’t technically over yet as school hasn’t started but you still know your classes for next year. You’re frantically attempting to complete those long procrastinated summer assignments, or like me, you’re desperately trying to avoid them by giving a yourself a false sense of productivity by building random&nbsp;apps.</p>
<p>My first foray into the realm of creating Facebook applications is fairly simple. It compares class schedules. In truth, the reason I made this was probably not the fact that I enjoy making useful tools, but more likely residual bitterness of rejection by a <a href="http://tjhsst.edu/">sci/tech high school</a> over <a href="/2011/09/schedule-compare/2009/01/i-fail/">three years</a> ago which has a <a href="http://jeffsweb.net/scheduler/">school-specific</a> schedule comparing app. Nonetheless, a neat side effect of this attempt is that it does happen to be quite&nbsp;cool.</p>
<p>This is also my first published app which is written in the <a href="http://jashkenas.github.com/coffee-script/">CoffeeScript</a> language. For those of you unaware, CoffeeScript is a language which is syntactically similar to <a href="http://python.org/">Python</a> but compiles into Javascript. It’s not a nasty <a href="http://code.google.com/webtoolkit/"><span class="caps">GWT</span></a>-esque compilation, but a relatively clean one (barring the underscores that result when you try doing comprehensions and the really cool stuff). I’ve always meant to write stuff in CoffeeScript, as it has quite a few awesome features. Most importantly is probably the ability to declare a function with two characters (-&gt;) rather than a massive “function(){}” and the array&nbsp;comprehensions.</p>
<p>Compiled (or should I say Transpiled?) languages have odd a few annoying properties, especially with debugging. The biggest issue was probably setting up everything: running a script which uses inotifywait to automatically compile your CoffeeScript once you hit “Save” on your editor of choice (gedit just because it works and comes with Ubuntu). Then when errors happen, your line numbers don’t match up and that’s also&nbsp;annoying.</p>
<p>The Facebook <span class="caps">API</span> is actually pretty good. My app reads Facebook schedules from your friends’ statuses. It’s not quite as easy as it should be. I could search the user’s news feed and that would be trivial except that it only gives me a subset of the statues that I want to be able to process. When using FQL (which I ended up pronouncing Feequel which sounds a bit like Fecal because it’s a SQL derivative, even though you’re not supposed to pronounce it “sequel”) it would only return/search the most recent status. I ended up doing a FQL request for each and every friend that the current user has, which is a on average a pretty big number. Fortunately it doesn’t seem like Faecbook has any API limits.&nbsp;Awesome.</p>
<p>For the longest time I was confused because my app inexplicably only worked for me. It turns out that my queries returned blank results for everyone else because I didn’t request the right permissions. That’s terrible. Absolutely terrible. First of all, the developer shouldn’t be entitled to have those magical privileges that the end users can’t have. It’s insanely confusing. And don’t just silently return no results and make the developer question his own&nbsp;sanity.</p>
<p>But it was a permissions issue - a one line fix in the&nbsp;end.</p>
<p>It’s also quite depressing that nobody’s using it. It’s pretty server intensive at the moment and it’s running on Google App Engine, which has that new pricing which means I should have my free quota expire after something like a meager 100 users. But I haven’t really come close to that. Why? I guess I have little influence over&nbsp;friends.</p>
<p><a href="http://schedule-compare.appspot.com/">http://schedule-compare.appspot.com/</a></p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2010/06/deep-integration-wave-embed-api/">Deep Integration Wave Embed API</a> <span class="subtitle">30 June 2010</span></h2>
            </header>
            <section class="content"><p><a href="/articles/2010/Deep%20Integration%20Wave%20Embed%20API/Selection_076.png"><div class="pic md" style="" ><img alt=""  src="/articles/2010/Deep%20Integration%20Wave%20Embed%20API/Selection_076.png" ><div class="caption">Can you tell that Wave is the backend? I think not.</div></div></a><a href="/articles/2010/Deep%20Integration%20Wave%20Embed%20API/Selection_078.png"><div class="pic md" style="" ><img alt=""  src="/articles/2010/Deep%20Integration%20Wave%20Embed%20API/Selection_078.png" ><div class="caption">Just to prove that it</div></div></a></p>
<p>Can you tell that the screenshot on the left is actually an embedded wave? Probably&nbsp;not.</p>
<p>First, a little overview on what this is. A lot of people are interested in using Google Wave as a commenting system, however the <strong>official embed api at the current state suffers from several shortfalls</strong>. It’s tedious to operate a wave-integrated commenting system. As an author, you have to <strong>manually create a wave for every post</strong>, copy the content over to the wave, get the wave <span class="caps">ID</span>, and paste it into your template. Every time you change your post, you have to yet again manually sync the page with wave. Once you’ve gotten the wave into the page, the embedded wave itself has a few issues. You <strong>can’t style it using <span class="caps">CSS</span></strong>, and you can only change the background color and font. The width can’t adjust to the width of your page after the initial load. There’s no way to get rid of or change the style of the<strong> huge blue border</strong> around it. It<strong> forces it’s own scroll bar</strong> which looks nothing like anything else on the page and <strong>prevents intuitive navigation</strong> of comments using the same scrollbar as the rest of the page. Lastly, there’s no way for anonymous readers to comment on the&nbsp;post.</p>
<p>For each of these issues,<strong> the new w2_embed api offers a solution</strong>. Instead of using iframes to hack another page onto the current one, this one is built into the page, injecting elements directly onto the page’s <span class="caps">DOM</span>. These<strong> elements can be styled in nearly any imaginable way through <span class="caps">CSS</span> and HTML</strong>. The sandboxed and namespaced single-function <span class="caps">API</span> allows for multiple waves on one page with less than 10KB of JS overhead (Compare to about 1.4 megabytes). Instead of relying on a special Wave ID, the app uses a centralized and remotely stored database which associates any identifier you provide with functional wave IDs. That means, that instead of using a string like <code>googlewave.com!w+Blsm0RMW_A</code>, you have the <span class="caps">URL</span> of your blog, say <code>2010/06/wave-embed-api</code>. Not only that, but it can <strong>automatically pull the title of your wave, the authors, the permalink and tags from the post, automatically create a wave from that with the same tags and title with the content automatically set as the root blip as well as a permalink back to the blog post</strong>. When viewed from wave, the user can follow, unfollow, search and find waves using the exact same familiar interface. On your blog, you can make the wave backend entirely seamless and subtle. Since it’s built on top of Anonybot<strong>, people can reply blips without having google wave</strong> accounts right from your&nbsp;blog.</p>
<p>It’s all part of a new embed <span class="caps">API</span> built upon Anony-bot (which itself is built upon microwave, which is built on wave reader, which is built upon the prototype python desktop client… Someone should make a wordpress plugin for this to make this family history even&nbsp;longer).</p>
<p>The<a href="/2010/06/deep-integration-wave-embed-api/2010/06/anony-bot-embed-api/"> last post noted the beginning of this project,</a> and here is part two. The <span class="caps">API</span> has been cleaned up a lot. The code has been simplified. Features added and design&nbsp;changed.</p>
<p>The major change is a total decoupling of it and the mainline Anonybot codebase. There are some major implications of the change. In the original prototype of the <span class="caps">API</span>, it still had the iconic blip context menu inherited from microwave. That’s gone. So is the participants bar, link to real wave client, blip html, blip content, reply box, and everything. There are now no required or automatically added html/dom elements. Everything is specified through a <strong>simple <span class="caps">HTML</span> templating engine</strong>. Since the code isn’t shared, changes from each individual project now on probably won’t be instantly applied to both. This has advantages and disadvantages. On the plus side, is that changes to anonybot won’t break the embed api. However, bug fixes on one may not propagate to the other.  The code can be much smaller since features like search, which was previously hidden, can now be totally removed. Also, since it’s been rewritten from scratch as an embed api, it no longer exposes any extra globals and multiple embeds can be done for each&nbsp;page.</p>
<p>The biggest change is the templating engine. Before, it only worked with the blip design, but now it’s totally integral to every aspect of the interface. Lets walk through the basics of the <span class="caps">API</span>, starting with a minimal&nbsp;example.</p>
<script type="text/javascript" src="http://gist.github.com/458802.js?file=w2_embed_demo.html"></script>All the content is wrapped in a huge hidden `div`, and inside is one element with the `wavebody` class. That huge wave is the scope of the templating engine. That means that if you put `{{1+1}}` anywhere inside the `div`, it&#8217;ll show up as 2&#46; Place it anywhere outside the div, and it shows up as `{{1+1}}`. Simple, right? The `wavebody` element is where the actual blips will go. But since there aren&#8217;t any blips beforehand, `wavebody` is filled with the template for a single blip. The content gets multiplied several times and that makes the wave. The template scheme is really simple. Basically, you just wrap arbitrary <span class="caps">JS</span> code within `{{` and `}}`. The code gets executed (in the scope of the wave) and the block gets replaced with the return value of the script. When you&#8217;re inside `wavebody` there are a few additional blip-specific things that you can add. Now we have to learn the magical snippets of code you can use inside the curly brackets. One of the objects exposed to the templates is `wave`. The nice thing is that it mirrors [the wave api](http://code.google.com/apis/wave/extensions/robots/protocol.html#Wavelets). So the wave object exposes the following attributes (copied from the google page).

*   `creationTime` denotes the [Unix time](http://en.wikipedia.org/wiki/Unix_time) at which this wavelet was created.
*   `creator` denotes the address of the participant who created this wavelet.
*   `lastModifiedTime` denotes the [Unix time](http://en.wikipedia.org/wiki/Unix_time) at which the wavelet was last modified by any participant.
*   `participants` contains an array of participant IDs for all participants on the wave.
*   `rootBlipId` contains the Blip ID of the root blip.
*   `title` contains the title of the wavelet, which by default consists of the first line of text up to the first carriage return.
*   `version` contains the version of this wavelet. Each atomic operation on a wavelet increases this version number.
*   `waveId` contains the Wave ID of this wavelet.
*   `waveletId` contains the wavelet ID of this wavelet. Note that for waves which contain only one wavelet (that don&#8217;t have private conversations, in other words), this wavelet ID is usually of the form `conv+root` indicating that the wavelet is identical to the conversation root, the root wave.
*   `dataDocuments` contains a dictionary (associated array) of the IDs and data of any data documents attached to this wavelet.

In addition, there are a few non-standard components.

*   `permalink` contains a link to the waveref which points to the specific wave on the real wave client
*   `blips` contains a js object (similar to a hash or dictionary) of blipIDs associated to blip objects
*   `bliparr` contains an array of blip ids in no particular order, most frequently used for getting the number of replies in a conversation in `{{wave.bliparr.length-1}}`

There are also some functions you can call. For example, `wave.creationTime` is in the form of a unix timestamp. That probably isn&#8217;t too useful to an ordinary user, so a `format_time` function is there to format it like &#8220;6/30 10:45am&#8221;. If you want to have some other custom datetime format, get me a script to do it in javascript in less than 500 bytes and I&#8217;ll include it in the next version.

*   `format_time(int)` Format a unix-style date as a human-readable &#8220;6/30 10:45am&#8221; or if you prefer &#8220;m/d h:MMtt&#8221;
*   `render(blip)` Render a blip and return the HTML. Most of the time, it&#8217;s unnecessary as there&#8217;s a blip.html attribute

There are a few actions that you can do. Certain strings like `{{addparticipant}}` can be used in `onclick=` attributes to trigger certain actions on various events.
<script type="text/javascript" src="http://gist.github.com/458944.js?file=events.w2_embed.html"></script>

<p>Here you see a link and a button. The link has been configured to prompt the user for a participant <span class="caps">ID</span> to add when clicked, and the button was set to prompt the user for a tag to add when clicked. There are several such&nbsp;actions.</p>
<ul>
<li><code>addparticipant</code> Prompt the suer for a wave address to add to the&nbsp;wave</li>
<li><code>reload</code> Reload the current&nbsp;wave</li>
<li><code>addtag</code> Prompt the user for a tag to&nbsp;add</li>
<li><p><code>setname</code> Prompt the user to set a username for posting
There is also the user list. It comes in two flavors, <code>{{participantlist}}</code> and <code>{{contributorlist}}</code>. The latter only works when inside a blip scope (the stuff inside <code>wavebody</code>). They’re special because they’re actually interactive. When the list is long, it shortens it and creates a link to&nbsp;expand.</p>
</li>
<li><p><code>participantlist</code> A list made from&nbsp;wave.participants</p>
</li>
<li><p><code>contributorlist</code> Only works when in <code>wavebody</code>, a simple users list made from blip.contributors
Now, is finally the stuff that goes in the blip. Like <code>wave</code> it extends some wave api features, so I’ll start with<a href="http://code.google.com/apis/wave/extensions/robots/protocol.html#Blips"> pasting what google has documented</a>.</p>
</li>
<li><p><code>blipId</code> contains the <span class="caps">ID</span> of blip in which the event&nbsp;occurred.</p>
</li>
<li><code>childBlipIds</code> contains an array of blip IDs for each of the blip’s&nbsp;children.</li>
<li><code>contributors</code> denotes participants who have contributed to the state of this&nbsp;blip.</li>
<li><code>creator</code> denotes the participant who created this&nbsp;blip.</li>
<li><code>lastModifiedTime</code> denotes the <a href="http://en.wikipedia.org/wiki/Unix_time">Unix time</a> at which this blip was last modified by any&nbsp;participant.</li>
<li><code>content</code> contains the textual content of this&nbsp;blip.</li>
<li><code>version</code> contains the version of this blip. Each atomic operation on a blip increases this version&nbsp;number.</li>
<li><code>waveId</code> contains the Wave <span class="caps">ID</span> associated with this&nbsp;blip.</li>
<li><p><code>waveletId</code> contains the wavelet <span class="caps">ID</span> associated with this blip. Note that for waves which contain only one wavelet (that don’t have private conversations, in other words), this wavelet ID is usually of the form <code>conv+root</code> indicating that the wavelet is identical to the conversation root, the root wave.
There are a few additional methods which, again are&nbsp;non-standard.</p>
</li>
<li><p><code>permalink</code> contains a link to the waveref which points to the specific blip on the real wave&nbsp;client</p>
</li>
<li><p><code>html</code> contains a string of the rendered (with formatting and annotations applied) content
There are also actions, similar to the global <code>addparticipant</code>, <code>reload</code> and <code>setname</code> actions. They can still be used within <code>wavebody</code> but there are some actions which can <em>only</em> work in the blip&nbsp;template.</p>
</li>
<li><p><code>edit</code> Add an edit box immediately below the blip, pre-populated with the text content of the&nbsp;blip</p>
</li>
<li><code>remove</code> Remove the blip, it will first issue a confirmation prompt to the&nbsp;user</li>
<li><p><code>reply</code> Add a reply box immediately below the blip. If there is already a blip below, the reply box is indented.
Below is a little example showing how to use the <code>blip</code> object.
<script type="text/javascript" src="http://gist.github.com/458980.js?file=wavebody.html"></script>Lastly is the <span class="caps">JS</span> part. Without it, nothing would ever show up. You need to include the currently 6.5KB JS library from <code>http://anony-bot.appspot.com/assets/embed2.mini.js</code>. After that, you need a separate script tag anywhere after the big hidden super element. It <em>must</em> be outside the super element (unimaginable evils will happen if it isn’t). Inside that script tag needs to be a function call to <code>w2_embed</code>. The first (and only) argument has to be a <span class="caps">JS</span> object with at least the <code>element</code> key pointing to a <span class="caps">DOM</span> element which contains an element with the class <code>wavebody</code>. There are <em>lots</em> of other config options, and here they&nbsp;are.</p>
</li>
<li><p><code>element</code> (Required) a dom element which contains a div with the “wavebody”&nbsp;class</p>
</li>
<li><code>identifier</code> The identifier for the wave that the server will use to generate a wave <span class="caps">ID</span> from, default:&nbsp;location.pathname</li>
<li><code>root_title</code> If the identifier has not previously been associated with a wave <span class="caps">ID</span>, the wave will be created with the specified title. default: (no&nbsp;title)</li>
<li><code>root_content</code> If the identifier has not previously been associated with a wave <span class="caps">ID</span>, the wave will be created with the specified content as the root blip. default: (no&nbsp;content)</li>
<li><code>participants</code> The participants the wave should be created with if not previously associated with a wave <span class="caps">ID</span>, default: [], suggested:&nbsp;[‘public@a.gwave.com’]</li>
<li><code>hideroot</code> Boolean whether or not to not render the root&nbsp;blip</li>
<li><code>edit</code> A reference to a <span class="caps">DOM</span> element which can be templated into the edit box, should contain handlers for the actions {{submit}} and {{cancel}} as well as a textarea with the class&nbsp;“wavetext”</li>
<li><code>tags</code> Set of tags to be added to the wave if the identifier has not previously been associated with a wave and must be&nbsp;created.</li>
<li><code>api_root</code> The domain containing the server component (proxy and dictionary server). Default:&nbsp;anony-bot.appspot.com</li>
<li><code>gadgets</code> Enable native gadgets (does not&nbsp;work)</li>
<li><code>render_state</code> Display the user a gadget&nbsp;state</li>
<li><code>chronological</code> Render blips chronologically (see Microwave’s “Classic Forum Layout”&nbsp;option)</li>
<li><code>json_url</code> Location of <span class="caps">JSON</span> implementation to be loaded dynamically in case it’s not native to the browser default: <a href="http://anony-bot.appspot.com/assets/json2.mini.js">http://anony-bot.appspot.com/assets/json2.mini.js</a></li>
<li><code>waveid</code> Skip the identifier lookup and directly reference a wave by it’s id&nbsp;&nbsp;</li>
</ul>
<p>You can see that the function call was saved to a variable named <code>demo</code>. That’s useful because you can use that to reference later to manipulate things. The return of a w2_embed call is a <span class="caps">JS</span> object with the following&nbsp;keys.</p>
<ul>
<li><code>config</code> A reference to the initial config&nbsp;object</li>
<li><code>reply(text)</code> Create a root-level&nbsp;reply</li>
<li><code>reload()</code> Reload the wave.
So lets try putting everything&nbsp;together.</li>
</ul>
<p>&nbsp;</p>
<p>Afterthoughts: Just a little thing to add at the end. You can can create a a div with the class <code>waveedit</code> as used above. It’s not strictly necessary, but it lets you customize things a bit more. You also need a <span class="caps">CSS</span> style for .wavethread with a padding-left (or margin-left) in order for threads to show up properly. Blips are automatically given a .waveblip&nbsp;class.</p>
<p>That screenshot on the top of the post, <a href="http://anony-bot.appspot.com/assets/test2.html">if you want to try it out. It’s here</a>.</p>
<p>I’m not making any money off of this, so there’s no reason for me to hide the fallibilities of this solution from anyone. This, like any other solution is not perfect. There is no true wave-style real-time editing, it uses polling. It does however update every 10 seconds if it’s configured to do so using the <code>poll_updates: true</code> configuration option. It can’t ever really do much better, since app engine doesn’t yet support pushing out real time data to attached clients, even though they announced the neat Channel <span class="caps">API</span> (still waiting to use it!) at I/O. Either way, that probably won’t help too much as w2_embed uses JSONP for client/server communication across multiple domains, and it’s unlikely that the channel api will allow for that. Also, since there’s no way to fetch a single blip, the user must request the entire wave to check the tiny 32 bit version integer if it’s been incremented, and if it has, then the whole wave has to be fetched again. It’s by no means efficient, and so my server would be very very sad if the polling interval was significantly increased. It’s not very SEO friendly. Though it’s not always that people want the comments to be indexed by search engines, so some people may care less. Accessibility-wise, it shouldn’t be too horrible if the screen reader/browser supports javascript and hugely depends on the HTML being used in conjunction with the&nbsp;script.</p>
<p>As of date, this was my longest blog post ever, and I would be sad if nobody commented (ironically using my non-wave-based commenting system). And I’m not posting my source code unless someone comments, so, an incentive&nbsp;:P</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2009/09/wave-syncing-echo/">Wave Syncing &quot;Echo&quot;</a> <span class="subtitle">15 September 2009</span></h2>
            </header>
            <section class="content"><p>The problem with the implementation of lots of things like VectorEditor, <span class="caps">SVG</span>-edit and the Ajax Animator is that something i’m going to randomly call&nbsp;“echo”.</p>
<p>Basically, you might delete something on your client, and right after that, since the result isn’t real time, the app adds the shape back, and it gets deleted again. With multiple users, it gets more confusing, and there’s a random chance that it might not even&nbsp;delete.</p>
<p>In wave2 which is now a really complicated and massively slow library filled with tons of inelegant crap spanning almost 600 lines, the way it’s resolved (somewhat) is by not truly deleting things, but rather replacing it with&nbsp;<span class="caps">DELETED</span>/TIMESTAMP.</p>

            </section>
          </article>
          <hr>
          <article class="article intro">
            <header>
              <h2><a href="/2009/08/wave2-a-higher-level-wave-gadget-state-api/">Wave2 A higher level Wave Gadget State API</a> <span class="subtitle">17 August 2009</span></h2>
            </header>
            <section class="content"><p>I was working on a new little Wave State <span class="caps">API</span> update. It supports lists in the form of subkeys, and something very much like hierarchy and events on specific sub-nodes. This way you don’t have everything update (someone’s edits on frame 36 doesn’t matter if you’re on frame&nbsp;42).</p>
<p>Everything is namespaced under a singleton global, wave2. It includes functions&nbsp;like</p>
<ul>
<li>listen (execute a callback when something beginning with the prefix is&nbsp;changed)</li>
<li>ignore&nbsp;(un-listen),</li>
<li>keys (shortcut for&nbsp;wave.getState().getKeys()),</li>
<li>subkeys (get keys which begin with a certain prefix, important to the pseudo&nbsp;hierarchy),</li>
<li>set (submitdelta with first arg as name and second as&nbsp;value),</li>
<li>get (shortcut for&nbsp;wave.getState().get()</li>
<li>reset_gadget (a simple way to empty all the data in the store)
And since it’s quite short, I’m putting it under public domain at <a href="http://antimatter15.com/misc/wave/wave2.js">http://antimatter15.com/misc/wave/wave2.js</a></li>
</ul>

            </section>
          </article>
          <hr>
          <div class="nav"><a href="/archive" class="newer">« Archives</a><a href="/page/1" class="next">Latest Posts »</a>
          </div>
        </div>
      </div>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-1367972-3', 'auto');
      ga('send', 'pageview');
      
    </script>
    <script>
      function squish(){
        document.getElementById("squishfoot").className += "squish"
      }
    </script>
    <style>
      .squish { font-size: 9px }
      .squishsquish { font-size: 8px }
      .squishsquishsquish { font-size: 7px }
      .squishsquishsquishsquish { font-size: 6px }
      .squishsquishsquishsquishsquish { font-size: 5px }
      .squishsquishsquishsquishsquishsquish { font-size: 4px }
      .squishsquishsquishsquishsquishsquishsquish { visibility: hidden }
    </style>
    <div class="graybar bottom">
      <footer>
        <div id="squishfoot">I'm a tiny footer, please don't <a href="javascript:squish()">squish</a> me</div>
      </footer>
    </div>
  </body>
</html>